<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 R for Insurance | Financial and Actuarial Modelling in R (MATH377)</title>
  <meta name="description" content="4 R for Insurance | Financial and Actuarial Modelling in R (MATH377)" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="4 R for Insurance | Financial and Actuarial Modelling in R (MATH377)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 R for Insurance | Financial and Actuarial Modelling in R (MATH377)" />
  
  
  

<meta name="author" content="Jorge Yslas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-for-finance.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation-of-r"><i class="fa fa-check"></i><b>1.1.1</b> Installation of R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation-of-rstudio"><i class="fa fa-check"></i><b>1.1.2</b> Installation of Rstudio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.2</b> R as a simple calculator</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#logical-operators"><i class="fa fa-check"></i><b>1.2.1</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-objects"><i class="fa fa-check"></i><b>1.3</b> R objects</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#assignment"><i class="fa fa-check"></i><b>1.3.1</b> Assignment</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-types"><i class="fa fa-check"></i><b>1.3.2</b> Data types</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>1.4</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#accessing-vector-elements"><i class="fa fa-check"></i><b>1.4.1</b> Accessing vector elements</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#operations-with-vectors"><i class="fa fa-check"></i><b>1.4.2</b> Operations with vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices-data-frames-and-lists"><i class="fa fa-check"></i><b>1.5</b> Matrices, data frames, and lists</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices"><i class="fa fa-check"></i><b>1.5.1</b> Matrices</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-frames"><i class="fa fa-check"></i><b>1.5.2</b> Data frames</a></li>
<li class="chapter" data-level="1.5.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#lists"><i class="fa fa-check"></i><b>1.5.3</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>1.6</b> Functions</a></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#packages"><i class="fa fa-check"></i><b>1.7</b> Packages</a></li>
<li class="chapter" data-level="1.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#control-statements"><i class="fa fa-check"></i><b>1.8</b> Control Statements</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#conditional-statements"><i class="fa fa-check"></i><b>1.8.1</b> Conditional statements</a></li>
<li class="chapter" data-level="1.8.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#loop-statements"><i class="fa fa-check"></i><b>1.8.2</b> Loop statements</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectorized-operations"><i class="fa fa-check"></i><b>1.9</b> Vectorized operations</a></li>
<li class="chapter" data-level="1.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-and-writing-data"><i class="fa fa-check"></i><b>1.10</b> Reading and writing data</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#working-directory"><i class="fa fa-check"></i><b>1.10.1</b> Working directory</a></li>
<li class="chapter" data-level="1.10.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#writing-data"><i class="fa fa-check"></i><b>1.10.2</b> Writing data</a></li>
<li class="chapter" data-level="1.10.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data"><i class="fa fa-check"></i><b>1.10.3</b> Reading data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html"><i class="fa fa-check"></i><b>2</b> R for Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#descriptive-statistics"><i class="fa fa-check"></i><b>2.1</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#visual-tools"><i class="fa fa-check"></i><b>2.1.1</b> Visual tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#probability-distributions"><i class="fa fa-check"></i><b>2.2</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#tranformations"><i class="fa fa-check"></i><b>2.2.1</b> Tranformations</a></li>
<li class="chapter" data-level="2.2.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#law-of-large-numbers-and-central-limit-theorem"><i class="fa fa-check"></i><b>2.2.2</b> Law of large numbers and central limit theorem</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#parinf"><i class="fa fa-check"></i><b>2.3</b> Parametric inference</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>2.3.1</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="2.3.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#adequacy-of-the-fit"><i class="fa fa-check"></i><b>2.3.2</b> Adequacy of the fit</a></li>
<li class="chapter" data-level="2.3.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#other-estimation-methods"><i class="fa fa-check"></i><b>2.3.3</b> Other estimation methods</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#multivariate-distributions"><i class="fa fa-check"></i><b>2.4</b> Multivariate distributions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#multivariate-normal-distribution"><i class="fa fa-check"></i><b>2.4.1</b> Multivariate normal distribution</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#copulas"><i class="fa fa-check"></i><b>2.4.2</b> Copulas</a></li>
<li class="chapter" data-level="2.4.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#constructing-multivariate-distributions-from-copulas"><i class="fa fa-check"></i><b>2.4.3</b> Constructing multivariate distributions from copulas</a></li>
<li class="chapter" data-level="2.4.4" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#dependence-measures"><i class="fa fa-check"></i><b>2.4.4</b> Dependence measures</a></li>
<li class="chapter" data-level="2.4.5" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#fitting"><i class="fa fa-check"></i><b>2.4.5</b> Fitting</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#linear-regression"><i class="fa fa-check"></i><b>2.5</b> Linear regression</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-for-finance.html"><a href="r-for-finance.html"><i class="fa fa-check"></i><b>3</b> R for Finance</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-for-finance.html"><a href="r-for-finance.html#market-portfolio-and-capm"><i class="fa fa-check"></i><b>3.1</b> Market portfolio and CAPM</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="r-for-finance.html"><a href="r-for-finance.html#mean-variance-portfolio"><i class="fa fa-check"></i><b>3.1.1</b> Mean-variance portfolio</a></li>
<li class="chapter" data-level="3.1.2" data-path="r-for-finance.html"><a href="r-for-finance.html#capital-asset-pricing-model-capm"><i class="fa fa-check"></i><b>3.1.2</b> Capital Asset Pricing Model (CAPM)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="r-for-finance.html"><a href="r-for-finance.html#the-binomial-model"><i class="fa fa-check"></i><b>3.2</b> The binomial model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r-for-finance.html"><a href="r-for-finance.html#one-period-binomial-model"><i class="fa fa-check"></i><b>3.2.1</b> One-period binomial model</a></li>
<li class="chapter" data-level="3.2.2" data-path="r-for-finance.html"><a href="r-for-finance.html#multiperiod-binomial-model"><i class="fa fa-check"></i><b>3.2.2</b> Multiperiod binomial model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="r-for-finance.html"><a href="r-for-finance.html#the-black-and-scholes-model"><i class="fa fa-check"></i><b>3.3</b> The Black and Scholes model</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-for-finance.html"><a href="r-for-finance.html#preliminars-brownian-motion"><i class="fa fa-check"></i><b>3.3.1</b> Preliminars: Brownian motion</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-for-finance.html"><a href="r-for-finance.html#the-black-and-scholes-formula"><i class="fa fa-check"></i><b>3.3.2</b> The Black and Scholes formula</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-for-finance.html"><a href="r-for-finance.html#greeks"><i class="fa fa-check"></i><b>3.3.3</b> Greeks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-for-insurance.html"><a href="r-for-insurance.html"><i class="fa fa-check"></i><b>4</b> R for Insurance</a>
<ul>
<li class="chapter" data-level="4.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-collective-risk-model"><i class="fa fa-check"></i><b>4.1</b> The collective risk model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#discretization-of-claim-amount-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Discretization of claim amount distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#calculation-of-the-aggregate-claim-amount-distribution"><i class="fa fa-check"></i><b>4.1.2</b> Calculation of the aggregate claim amount distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#ruin-theory"><i class="fa fa-check"></i><b>4.2</b> Ruin theory</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-surplus-process"><i class="fa fa-check"></i><b>4.2.1</b> The surplus process</a></li>
<li class="chapter" data-level="4.2.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-adjustment-coefficient"><i class="fa fa-check"></i><b>4.2.2</b> The adjustment coefficient</a></li>
<li class="chapter" data-level="4.2.3" data-path="r-for-insurance.html"><a href="r-for-insurance.html#probability-of-ruin"><i class="fa fa-check"></i><b>4.2.3</b> Probability of ruin</a></li>
<li class="chapter" data-level="4.2.4" data-path="r-for-insurance.html"><a href="r-for-insurance.html#reinsurance"><i class="fa fa-check"></i><b>4.2.4</b> Reinsurance</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Financial and Actuarial Modelling in R (MATH377)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-for-insurance" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> R for Insurance<a href="r-for-insurance.html#r-for-insurance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-collective-risk-model" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> The collective risk model<a href="r-for-insurance.html#the-collective-risk-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let <span class="math inline">\(S\)</span> be a random variable representing the aggregate claim amount (or the total amount of claims) of an insurance portfolio of independent risks over a fixed period. Let <span class="math inline">\(N\)</span> be a random variable representing the number of claims (or frequency) in the portfolio over that period, and <span class="math inline">\(X_1, X_2, \dots\)</span> be a sequence of iid random variables denoting the claim sizes (or severities), with common element <span class="math inline">\(X\geq0\)</span>.
Then, <span class="math inline">\(S\)</span> is given as the random sum
<span class="math display">\[\begin{equation*}
    S=\left\{\begin{array}{ll}
        X_1+X_2+\cdots+X_N\,, &amp; N&gt;0 \,, \\
        0\,, &amp; N=0 \,.
    \end{array}\right.
\end{equation*}\]</span>
In order to derive several properties of the model above, the collective risk model assumes that the number of claims and the claim sizes are independent, that is, <span class="math inline">\(N\)</span> and <span class="math inline">\(X_1, X_2, \dots\)</span> are mutually independent.</p>
<p>In the following, the probability mass function (pf) of <span class="math inline">\(N\)</span> is denoted by <span class="math inline">\(p_n=\mathbb{P}(N=n)\)</span>, and the probability density function (pdf) and cumulative distribution function (cdf) of <span class="math inline">\(X\)</span> are denoted by <span class="math inline">\(f_X(x)\)</span> and <span class="math inline">\(F_X(x)=\mathbb{P}(X\leq x)\)</span>, respectively.</p>
<p>We now present some properties of the aggregate loss <span class="math inline">\(S\)</span>. We start with the moment generating function (mgf) <span class="math inline">\(M_S(t)\)</span>, which is given by
<span class="math display">\[
M_S(t)=\mathbb{E}[\exp(tS)]=M_N\left(\ln M_X(t)\right) \,,
\]</span>
where <span class="math inline">\(M_N(t)\)</span> and <span class="math inline">\(M_X(t)\)</span> are the mgf’s of <span class="math inline">\(N\)</span> and <span class="math inline">\(X\)</span>, respectively.</p>
<p>Next, the mean and variance of <span class="math inline">\(S\)</span> are
<span class="math display">\[
\mathbb{E}[S]=\mathbb{E}[X]\mathbb{E}[N] \,,
\]</span>
and
<span class="math display">\[
\text{Var}(S)=\mathbb{E}[N]\text{Var}(X)+\text{Var}(N)\mathbb{E}^2[X] \,.
\]</span>
Finally, the distribution function <span class="math inline">\(F_S\)</span> of <span class="math inline">\(S\)</span> is given by
<span class="math display" id="eq:sconv">\[\begin{equation}
  F_S(x)=\mathbb{P}(S\leq x)=\sum_{n=0}^{\infty}p_nF^{\star n}_X(x)\,,\quad x\geq 0 \,,
  \tag{4.1}
\end{equation}\]</span>
where <span class="math inline">\(F^{\star n}_X\)</span> is the cdf of the <span class="math inline">\(n\)</span>-fold convolution of the r.v. <span class="math inline">\(X\)</span> defined as
<span class="math display">\[\begin{equation*}
    F^{\star n}_X(x) =\left\{\begin{array}{ll}
1_{(x\geq 0)}\,, &amp; n = 0\,, \\
\mathbb{P}(X_1+X_2+\cdots+X_n\leq x)\,, &amp; n = 1,2,\dots \,,
\end{array}\right.
  \end{equation*}\]</span>
and <span class="math inline">\(1_{A}\)</span> denotes the indicator function over a set <span class="math inline">\(A\)</span>.</p>
<p>When <span class="math inline">\(X\)</span> is continuous, differentiating <span class="math inline">\(F_S\)</span> with respect to <span class="math inline">\(x\)</span> yields the following expression for the density function <span class="math inline">\(f_S\)</span> of <span class="math inline">\(S\)</span>
<span class="math display">\[
f_S(x) = \sum_{n=0}^{\infty}p_nf^{\star n}_X(x)\,, \quad x \geq 0 \,,
\]</span>
where <span class="math inline">\(f^{\star n}_X\)</span> is the pdf of the <span class="math inline">\(n\)</span>-fold convolution of the random variable <span class="math inline">\(X\)</span>. An analogous expression for the pf of <span class="math inline">\(S\)</span> can be obtained in the case of <span class="math inline">\(X\)</span> discrete.</p>
<p>Both the cdf and the pf (pdf) of the <span class="math inline">\(n\)</span>-fold convolution of <span class="math inline">\(X\)</span> can be obtained recursively as given in the following proposition.</p>
<div class="proposition">
<p><span id="prp:unlabeled-div-63" class="proposition"><strong>Proposition 4.1  </strong></span><span class="math inline">\(\,\)</span></p>
<ol style="list-style-type: lower-roman">
<li><p>If <span class="math inline">\(X\)</span> is a discrete random variable, then the cdf of the <span class="math inline">\(n\)</span>-fold convolution of <span class="math inline">\(X\)</span> can be evaluated recursively by the following formula
<span class="math display" id="eq:recconv">\[\begin{equation}
F^{\star n}_X(x)=\left\{\begin{array}{ll}
1_{(x\geq 0)}\,,  &amp; n=0 \,,\\
F_X(x)\,,  &amp; n=1 \,,\\
\sum_{y=0}^{x}f_X(y)F^{\star (n-1)}_X(x-y), &amp; n=2,3,\ldots \,,
\end{array}\right.
\tag{4.2}
  \end{equation}\]</span>
while the pf of the <span class="math inline">\(n\)</span>-fold convolution of <span class="math inline">\(X\)</span> can be evaluated recursively by
<span class="math display">\[\begin{equation*}
  f^{\star n}_X(x)=\sum_{y=0}^{x}f_X(y)f^{\star (n-1)}_X(x-y) \,.
\end{equation*}\]</span></p></li>
<li><p>If <span class="math inline">\(X\)</span> is a continuous random variable, then the cdf of the <span class="math inline">\(n\)</span>-fold convolution of <span class="math inline">\(X\)</span> can be evaluated recursively by the following formula
<span class="math display">\[\begin{equation*}
  F^{\star n}_X(x)=\int_{0}^{x}f_X(y)F^{\star (n-1)}_X(x-y)dy \,,
\end{equation*}\]</span>
while the pdf of the <span class="math inline">\(n\)</span>-fold convolution of <span class="math inline">\(X\)</span> can be evaluated recursively by
<span class="math display">\[\begin{equation*}
f^{\star n}_X(x)=\int_{0}^{x}f_X(y)f^{\star (n-1)}_X(x-y)dy \,.
\end{equation*}\]</span></p></li>
</ol>
</div>
<div id="discretization-of-claim-amount-distributions" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Discretization of claim amount distributions<a href="r-for-insurance.html#discretization-of-claim-amount-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Some numerical techniques to compute the aggregate claim amount distribution require a discrete arithmetic claim amount distribution, that is, a distribution defined on <span class="math inline">\(0, h, 2h, \dots\)</span> for some step (or span, or lag) <span class="math inline">\(h\)</span>. The <code>actuar</code> package provides the function <code>discretize()</code> to discretize continuous distributions. More specifically, given <span class="math inline">\(F(x)\)</span>, the cdf of the distribution to discretize on some interval <span class="math inline">\((a, b)\)</span>, the <code>discretize()</code> function supports the following four discretization methods (we denote by <span class="math inline">\(f_x\)</span> the pf at <span class="math inline">\(x\)</span> of the discretized distribution).</p>
<ol style="list-style-type: decimal">
<li><p>Upper discretization, or forward difference of <span class="math inline">\(F(x)\)</span>:
<span class="math display">\[
f_x =F(x+h)-F(x) \,, \quad x=a,a+h,\ldots,b-h\,.
\]</span>
The discretized cdf is always above the true cdf.</p></li>
<li><p>Lower discretization, or backward difference of <span class="math inline">\(F(x)\)</span>:
<span class="math display">\[\begin{align*}
f_x = \left\{ \begin{array}{ll}
F(a)\,, &amp; x=a \,,\\
F(x)-F(x-h)\,, &amp; x=a+h,\dots,b \,.
\end{array} \right.
\end{align*}\]</span>
The discretized cdf is always under the true cdf.</p></li>
<li><p>Rounding of the random variable, or the midpoint method:
<span class="math display">\[\begin{align*}
  f_x=\left\{ \begin{array}{ll}
  F(a+h/2)\,, &amp; x=a \,, \\
  F(x+h/2)-F(x-h/2)\,, &amp; x=a+h,\dots,b-h \,.
  \end{array} \right.
\end{align*}\]</span>
The true cdf passes exactly midway through the steps of the discretized cdf.</p></li>
<li><p>Unbiased, or local matching of the first moment method:
<span class="math display">\[\begin{align*}
  f_x=\left\{ \begin{array}{ll}
  \frac{E[X\wedge a]-E[X\wedge a +h]}{h}+1-F(a)\,, &amp; x=a \,,\\
  \frac{2E[X\wedge x]-E[X\wedge x -h]-E[X\wedge x +h]}{h}\,, &amp; a&lt;x&lt;b \,,\\
  \frac{E[X\wedge b]-E[X\wedge b-h]}{h}-1+F(b)\,, &amp; x=b\,,
  \end{array} \right.
\end{align*}\]</span>
where <span class="math inline">\(c\wedge d\)</span> denotes <span class="math inline">\(\min(c,d)\)</span>.
The discretized and the true distributions have the same total probability and expected value on <span class="math inline">\((a, b)\)</span>.</p></li>
</ol>
<div class="example">
<p><span id="exm:unlabeled-div-64" class="example"><strong>Example 4.1  </strong></span>Find the four discretizations of a <span class="math inline">\(Gamma(2,1)\)</span> distribution on <span class="math inline">\((0,10)\)</span> with a step of <span class="math inline">\(0.5\)</span> and plot their cdf against the original cdf.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-65" class="solution"><em>Solution</em>. </span><span class="math inline">\(\,\)</span></p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="r-for-insurance.html#cb984-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(actuar)</span>
<span id="cb984-2"><a href="r-for-insurance.html#cb984-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb984-3"><a href="r-for-insurance.html#cb984-3" aria-hidden="true" tabindex="-1"></a>fx_upper <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb984-4"><a href="r-for-insurance.html#cb984-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;upper&quot;</span>,</span>
<span id="cb984-5"><a href="r-for-insurance.html#cb984-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb984-6"><a href="r-for-insurance.html#cb984-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="dv">10</span>,</span>
<span id="cb984-7"><a href="r-for-insurance.html#cb984-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="fl">0.5</span></span>
<span id="cb984-8"><a href="r-for-insurance.html#cb984-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb984-9"><a href="r-for-insurance.html#cb984-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb984-10"><a href="r-for-insurance.html#cb984-10" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span> <span class="sc">-</span> <span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb984-11"><a href="r-for-insurance.html#cb984-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stepfun</span>(x, <span class="fu">diffinv</span>(fx_upper)), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Upper&quot;</span>)</span>
<span id="cb984-12"><a href="r-for-insurance.html#cb984-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-1.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="r-for-insurance.html#cb985-1" aria-hidden="true" tabindex="-1"></a>fx_lower <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb985-2"><a href="r-for-insurance.html#cb985-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;lower&quot;</span>,</span>
<span id="cb985-3"><a href="r-for-insurance.html#cb985-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb985-4"><a href="r-for-insurance.html#cb985-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="dv">10</span>,</span>
<span id="cb985-5"><a href="r-for-insurance.html#cb985-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="fl">0.5</span></span>
<span id="cb985-6"><a href="r-for-insurance.html#cb985-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb985-7"><a href="r-for-insurance.html#cb985-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-8"><a href="r-for-insurance.html#cb985-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb985-9"><a href="r-for-insurance.html#cb985-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stepfun</span>(x, <span class="fu">diffinv</span>(fx_lower)), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Lower&quot;</span>)</span>
<span id="cb985-10"><a href="r-for-insurance.html#cb985-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-2.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="r-for-insurance.html#cb986-1" aria-hidden="true" tabindex="-1"></a>fx_round <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb986-2"><a href="r-for-insurance.html#cb986-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;rounding&quot;</span>,</span>
<span id="cb986-3"><a href="r-for-insurance.html#cb986-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb986-4"><a href="r-for-insurance.html#cb986-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="dv">10</span>,</span>
<span id="cb986-5"><a href="r-for-insurance.html#cb986-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="fl">0.5</span></span>
<span id="cb986-6"><a href="r-for-insurance.html#cb986-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb986-7"><a href="r-for-insurance.html#cb986-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb986-8"><a href="r-for-insurance.html#cb986-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span> <span class="sc">-</span> <span class="fl">0.5</span>, <span class="fl">0.5</span>)</span>
<span id="cb986-9"><a href="r-for-insurance.html#cb986-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stepfun</span>(x, <span class="fu">diffinv</span>(fx_round)), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Rounding&quot;</span>)</span>
<span id="cb986-10"><a href="r-for-insurance.html#cb986-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-3.png" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="r-for-insurance.html#cb987-1" aria-hidden="true" tabindex="-1"></a>fx_unbi <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb987-2"><a href="r-for-insurance.html#cb987-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;unbiased&quot;</span>,</span>
<span id="cb987-3"><a href="r-for-insurance.html#cb987-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>,</span>
<span id="cb987-4"><a href="r-for-insurance.html#cb987-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="dv">10</span>,</span>
<span id="cb987-5"><a href="r-for-insurance.html#cb987-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="fl">0.5</span>,</span>
<span id="cb987-6"><a href="r-for-insurance.html#cb987-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lev =</span> <span class="fu">levgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>) <span class="co"># Computes E[min(X, a)]</span></span>
<span id="cb987-7"><a href="r-for-insurance.html#cb987-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb987-8"><a href="r-for-insurance.html#cb987-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.5</span>)</span>
<span id="cb987-9"><a href="r-for-insurance.html#cb987-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">stepfun</span>(x, <span class="fu">diffinv</span>(fx_unbi)), <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Unbiased&quot;</span>)</span>
<span id="cb987-10"><a href="r-for-insurance.html#cb987-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-401-4.png" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="calculation-of-the-aggregate-claim-amount-distribution" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Calculation of the aggregate claim amount distribution<a href="r-for-insurance.html#calculation-of-the-aggregate-claim-amount-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section, we present various methods to compute or approximate the cdf of the aggregate claims amount <span class="math inline">\(S\)</span>. These methods are implemented in the <code>actuar</code> package through the function <code>aggregateDist()</code>.</p>
<div id="panjers-recursion" class="section level4 unnumbered hasAnchor">
<h4>Panjer’s recursion<a href="r-for-insurance.html#panjers-recursion" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The first method that we present is the well-known Panjer’s recursion. This method requires the severity distribution to be discrete arithmetic on <span class="math inline">\(0, 1, 2, \dots, m\)</span> for some monetary unit and the frequency distribution to be in the <span class="math inline">\((a,b,0)\)</span> or <span class="math inline">\((a,b,1)\)</span> class of distributions. Recall that <span class="math inline">\(N\)</span> is in the <span class="math inline">\((a,b,0)\)</span> class (resp. in the <span class="math inline">\((a,b,1)\)</span> class) if its pf <span class="math inline">\(p_n\)</span> can be written recursively in the following form
<span class="math display">\[\begin{equation*}
  p_n=\left(a+\frac{b}{n}\right)p_{n-1}, \quad n=1,2,3,\dots\,,
\end{equation*}\]</span>
resp.
<span class="math display">\[\begin{equation*}
  p_n=\left(a+\frac{b}{n}\right)p_{n-1}, \quad n=2,3,\dots\,.
\end{equation*}\]</span>
Many known distributions belong to the <span class="math inline">\((a,b,0)\)</span> and <span class="math inline">\((a,b,1)\)</span> classes. For instance, Table <a href="r-for-insurance.html#tab:abclass">4.1</a> shows the most important examples in the <span class="math inline">\((a,b,0)\)</span> class.</p>
<table>
<caption><span id="tab:abclass">Table 4.1: </span>Distribution in the <span class="math inline">\((a,b,0)\)</span> class</caption>
<colgroup>
<col width="19%" />
<col width="33%" />
<col width="12%" />
<col width="18%" />
<col width="16%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Distribution of <span class="math inline">\(N\)</span></th>
<th align="left">Paremeters</th>
<th align="left"><span class="math inline">\(a\)</span></th>
<th align="left"><span class="math inline">\(b\)</span></th>
<th align="left"><span class="math inline">\(p_0\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Poisson</td>
<td align="left"><span class="math inline">\(\lambda &gt; 0\)</span></td>
<td align="left"><span class="math inline">\(0\)</span></td>
<td align="left"><span class="math inline">\(\lambda\)</span></td>
<td align="left"><span class="math inline">\(\exp(-\lambda)\)</span></td>
</tr>
<tr class="even">
<td align="left">Binomial</td>
<td align="left"><span class="math inline">\(n \in \mathbb{N}\)</span>, <span class="math inline">\(p \in (0,1)\)</span></td>
<td align="left"><span class="math inline">\(-p/(1 - p)\)</span></td>
<td align="left"><span class="math inline">\((n+1)p / (1 - p)\)</span></td>
<td align="left"><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td align="left">Geometric</td>
<td align="left"><span class="math inline">\(p \in (0,1)\)</span></td>
<td align="left"><span class="math inline">\(1 - p\)</span></td>
<td align="left"><span class="math inline">\(0\)</span></td>
<td align="left"><span class="math inline">\(p\)</span></td>
</tr>
<tr class="even">
<td align="left">Negative Binomial</td>
<td align="left"><span class="math inline">\(r \in \mathbb{N}\)</span> , <span class="math inline">\(p \in (0,1)\)</span></td>
<td align="left"><span class="math inline">\(1 - p\)</span></td>
<td align="left"><span class="math inline">\((r-1)(1 - p)\)</span></td>
<td align="left"><span class="math inline">\(p^r\)</span></td>
</tr>
</tbody>
</table>
<p>Under the above setting, the pf of the aggregate claims can be calculated recursively based on the following theorem.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-66" class="theorem"><strong>Theorem 4.1  </strong></span>Let <span class="math inline">\(N\)</span> be a random variable in the <span class="math inline">\((a,b,0)\)</span> (resp. <span class="math inline">\((a,b,1)\)</span>) family of distributions. Then, the pf <span class="math inline">\(f_S\)</span> of the aggregate claims is given by
<span class="math display">\[\begin{equation*}
f_S(x) = \left\{\begin{array}{ll}
  P_N(f_X(0))\,, &amp; x=0 \,, \\
  \frac{1}{1-af_X(0)}\sum_{y=1}^{x\wedge m}\left(a+\frac{by}{x}\right)f_X(y)f_S(x-y)\,,&amp;  x=1,2,\dots \,,
  \end{array}\right.
\end{equation*}\]</span>
resp.
<span class="math display">\[\begin{equation*}
f_S(x) = \left\{\begin{array}{ll}
  P_N(f_X(0)) \,, &amp; x=0 \\
  \frac{1}{1-af_X(0)} \left( (p_1-(a+b)p_0)f_X(x)+\sum_{y=1}^{x \wedge m}\left(a+\frac{by}{x}\right)f_X(y)f_S(x-y) \right)\,, &amp; x=1,2,\dots \,,
\end{array}\right.
\end{equation*}\]</span>
where <span class="math inline">\(P_N(t)=\mathbb{E}(t^N)\)</span> is the probability generating function (pgf) of <span class="math inline">\(N\)</span>.</p>
</div>
<p>To perform Panjer’s recursion in R, we can use the function <code>aggregateDist()</code> with argument <code>method = "recursive"</code>. Let us give a concrete example. We consider <span class="math inline">\(S\)</span> such that <span class="math inline">\(N\)</span> is Poisson distributed with mean <span class="math inline">\(10\)</span> and <span class="math inline">\(X \sim Gamma(2, 1)\)</span>. Then, we approximate the cdf of <span class="math inline">\(S\)</span> by first discretizing the gamma distribution on (0, 22) with the unbiased method and a step of 0.5 and then using the recursive method in <code>aggregateDist()</code>.</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="r-for-insurance.html#cb988-1" aria-hidden="true" tabindex="-1"></a>fx <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb988-2"><a href="r-for-insurance.html#cb988-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;unbiased&quot;</span>,</span>
<span id="cb988-3"><a href="r-for-insurance.html#cb988-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">22</span>, <span class="at">step =</span> <span class="fl">0.5</span>,</span>
<span id="cb988-4"><a href="r-for-insurance.html#cb988-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lev =</span> <span class="fu">levgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb988-5"><a href="r-for-insurance.html#cb988-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb988-6"><a href="r-for-insurance.html#cb988-6" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">&lt;-</span> <span class="fu">aggregateDist</span>(<span class="st">&quot;recursive&quot;</span>,</span>
<span id="cb988-7"><a href="r-for-insurance.html#cb988-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.freq =</span> <span class="st">&quot;poisson&quot;</span>,</span>
<span id="cb988-8"><a href="r-for-insurance.html#cb988-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.sev =</span> fx, <span class="at">lambda =</span> <span class="dv">10</span>,</span>
<span id="cb988-9"><a href="r-for-insurance.html#cb988-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.scale =</span> <span class="fl">0.5</span></span>
<span id="cb988-10"><a href="r-for-insurance.html#cb988-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb988-11"><a href="r-for-insurance.html#cb988-11" aria-hidden="true" tabindex="-1"></a>Fs</span></code></pre></div>
<pre><code>## 
## Aggregate Claim Amount Distribution
##   Recursive method approximation
## 
## Call:
## aggregateDist(method = &quot;recursive&quot;, model.freq = &quot;poisson&quot;, model.sev = fx, 
##     x.scale = 0.5, lambda = 10)
## 
## Data:  ( 143 obs. )
##  x[1:143] =     0,   0.5,     1,  ...,  70.5,    71</code></pre>
<p>The above code returns an object of the class <code>aggregateDist</code> from which we can obtain information regarding <span class="math inline">\(S\)</span>. Firstly, we can use directly such an object to evaluate the cdf of <span class="math inline">\(S\)</span>:</p>
<div class="sourceCode" id="cb990"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb990-1"><a href="r-for-insurance.html#cb990-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Fs</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>## [1] 0.5470771</code></pre>
<p>Note that the support can be obtained with the <code>knots()</code> function:</p>
<div class="sourceCode" id="cb992"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb992-1"><a href="r-for-insurance.html#cb992-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">knots</span>(Fs))</span></code></pre></div>
<pre><code>## [1] 0.0 0.5 1.0 1.5 2.0 2.5</code></pre>
<p>Moreover, we can apply other functions to the above object to obtain different quantities or even plots. For instance, <code>summary()</code> provides some basic information on <span class="math inline">\(S\)</span>.</p>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="r-for-insurance.html#cb994-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Fs)</span></code></pre></div>
<pre><code>## Aggregate Claim Amount Empirical CDF:
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
##  0.00000 14.50000 19.50000 19.99994 25.00000 71.00000</code></pre>
<p>To plot the approximated cdf of <span class="math inline">\(S\)</span>, we can use the <code>plot()</code> function:</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="r-for-insurance.html#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Fs, <span class="at">do.points =</span> <span class="cn">FALSE</span>, <span class="at">verticals =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-406-1.png" width="672" /></p>
<p>We will illustrate additional useful functions with the other approximation method presented next.</p>
</div>
<div id="exact-calculation-by-numerical-convolutions" class="section level4 unnumbered hasAnchor">
<h4>Exact calculation by numerical convolutions<a href="r-for-insurance.html#exact-calculation-by-numerical-convolutions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This method consists of using directly <a href="r-for-insurance.html#eq:sconv">(4.1)</a>, and it can be accessed using the argument <code>method = "convolution"</code> in the <code>aggregateDist()</code> function. However, it only works with discrete severity models and computes the distribution of the convolution using <a href="r-for-insurance.html#eq:recconv">(4.2)</a>. This method is computationally demanding, and hence, it only works well with relatively small problems. Nevertheless, an advantage is that any discrete distribution can be employed for the claim number. We now present a concrete example: As before, we consider a <span class="math inline">\(Gamma(2,1)\)</span> distribution for the severities, but now consider a <span class="math inline">\(Bin(10, 0.4)\)</span> distribution for the number of claims.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="r-for-insurance.html#cb997-1" aria-hidden="true" tabindex="-1"></a>fx <span class="ot">&lt;-</span> <span class="fu">discretize</span>(<span class="fu">pgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb997-2"><a href="r-for-insurance.html#cb997-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;unbiased&quot;</span>,</span>
<span id="cb997-3"><a href="r-for-insurance.html#cb997-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">22</span>, <span class="at">step =</span> <span class="fl">0.5</span>,</span>
<span id="cb997-4"><a href="r-for-insurance.html#cb997-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lev =</span> <span class="fu">levgamma</span>(x, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb997-5"><a href="r-for-insurance.html#cb997-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb997-6"><a href="r-for-insurance.html#cb997-6" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="fl">0.4</span>) <span class="co"># We require a vector of claim number probabilities</span></span>
<span id="cb997-7"><a href="r-for-insurance.html#cb997-7" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">&lt;-</span> <span class="fu">aggregateDist</span>(<span class="st">&quot;convolution&quot;</span>,</span>
<span id="cb997-8"><a href="r-for-insurance.html#cb997-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.freq =</span> fn,</span>
<span id="cb997-9"><a href="r-for-insurance.html#cb997-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.sev =</span> fx,</span>
<span id="cb997-10"><a href="r-for-insurance.html#cb997-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.scale =</span> <span class="fl">0.5</span></span>
<span id="cb997-11"><a href="r-for-insurance.html#cb997-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb997-12"><a href="r-for-insurance.html#cb997-12" aria-hidden="true" tabindex="-1"></a><span class="fu">Fs</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 0.7282019</code></pre>
<p>Once the object above was created, we can again find different quantities of interest. For instance, the density can be found using the <code>diff()</code> function:</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="r-for-insurance.html#cb999-1" aria-hidden="true" tabindex="-1"></a>fs <span class="ot">&lt;-</span> <span class="fu">diff</span>(Fs)</span>
<span id="cb999-2"><a href="r-for-insurance.html#cb999-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fs)</span></code></pre></div>
<pre><code>## [1] 0.007499618 0.006946915 0.011704075 0.016188003 0.020890637 0.025716230</code></pre>
</div>
<div id="normal-approximation" class="section level4 unnumbered hasAnchor">
<h4>Normal approximation<a href="r-for-insurance.html#normal-approximation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the CLT, the cdf of <span class="math inline">\(S\)</span> can be approximated as
<span class="math display">\[
F_S(x) \approx \Phi\left( \frac{x - \mu_S}{\sigma_S} \right) \,,
\]</span>
where <span class="math inline">\(\mu_S = \mathbb{E}[S]\)</span>, <span class="math inline">\(\sigma^2_S = \text{Var}(S)\)</span>, and <span class="math inline">\(\Phi\)</span> denotes the cdf of a standard normal. However, this approximation ignores the tail behavior of the distribution, which may be problematic when we are interested in the tails. Moreover, we require the existence of at least the second moment. To use this method in the <code>aggregateDist()</code> function, we need to pass the argument <code>method = "normal"</code> and a vector with the moments of <span class="math inline">\(S\)</span> in the order <span class="math inline">\((\mu_S , \sigma^2_S)\)</span>. For instance,</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="r-for-insurance.html#cb1001-1" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">&lt;-</span> <span class="fu">aggregateDist</span>(<span class="st">&quot;normal&quot;</span>, <span class="at">moments =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">2</span>))</span>
<span id="cb1001-2"><a href="r-for-insurance.html#cb1001-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Fs</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.2397501</code></pre>
<p>Note that the above cdf evaluation can also be computed simply as</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1003-1"><a href="r-for-insurance.html#cb1003-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="dv">5</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.2397501</code></pre>
</div>
<div id="normal-power-ii-approximation" class="section level4 unnumbered hasAnchor">
<h4>Normal Power II approximation<a href="r-for-insurance.html#normal-power-ii-approximation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This method approximates the cdf of <span class="math inline">\(S\)</span> by</p>
<p><span class="math display">\[
F_S(x) \approx \Phi\left( - \frac{3}{\gamma_S} + \sqrt{\frac{9}{\gamma_S^2} + 1 + \frac{6}{\gamma_S} \frac{x - \mu_S}{\sigma_S} }  \right) \,,
\]</span>
where <span class="math inline">\(\gamma_S = \mathbb{E}[(S - \mu_S)^3]/ \sigma^{3}_S\)</span>. The approximation is valid for <span class="math inline">\(x &gt; \mu_S\)</span> only
and performs reasonably well when <span class="math inline">\(\gamma_S &lt; 1\)</span>. This method is implemented in the <code>aggregateDist()</code> function and accessible through the argument <code>method = "npower"</code>. We require to give a vector with <span class="math inline">\((\mu_S , \sigma^2_S, \gamma_S)\)</span>, in that order. For example,</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="r-for-insurance.html#cb1005-1" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">&lt;-</span> <span class="fu">aggregateDist</span>(<span class="st">&quot;npower&quot;</span>, <span class="at">moments =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">2</span>, <span class="fl">0.5</span>))</span>
<span id="cb1005-2"><a href="r-for-insurance.html#cb1005-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Fs</span>(<span class="dv">7</span>) <span class="co"># Accesible only for x &gt; mu_S</span></span></code></pre></div>
<pre><code>## [1] 0.7716457</code></pre>
</div>
<div id="simulation" class="section level4 unnumbered hasAnchor">
<h4>Simulation<a href="r-for-insurance.html#simulation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The last method we introduce here consists of simulating a sample from <span class="math inline">\(S\)</span> and then approximating <span class="math inline">\(F_S\)</span> by the empirical cdf
<span class="math display">\[
F_n(x) = \frac{1}{n}\sum_{j = 1}^n 1_{(x_j \leq x)} \,.
\]</span>
The above can be performed using the <code>aggregateDist()</code> function with the argument <code>method = "simulation"</code>. For instance, for <span class="math inline">\(S\)</span> with <span class="math inline">\(N\)</span> Poisson distributed with mean <span class="math inline">\(10\)</span> and <span class="math inline">\(X \sim Gamma(2,1)\)</span>, we have</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1007-1"><a href="r-for-insurance.html#cb1007-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1007-2"><a href="r-for-insurance.html#cb1007-2" aria-hidden="true" tabindex="-1"></a>model_freq <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="at">data =</span> <span class="fu">rpois</span>(<span class="dv">10</span>))</span>
<span id="cb1007-3"><a href="r-for-insurance.html#cb1007-3" aria-hidden="true" tabindex="-1"></a>model_sev <span class="ot">&lt;-</span> <span class="fu">expression</span>(<span class="at">data =</span> <span class="fu">rgamma</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb1007-4"><a href="r-for-insurance.html#cb1007-4" aria-hidden="true" tabindex="-1"></a>Fs <span class="ot">&lt;-</span> <span class="fu">aggregateDist</span>(<span class="st">&quot;simulation&quot;</span>,</span>
<span id="cb1007-5"><a href="r-for-insurance.html#cb1007-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nb.simul =</span> <span class="dv">2500</span>,</span>
<span id="cb1007-6"><a href="r-for-insurance.html#cb1007-6" aria-hidden="true" tabindex="-1"></a>  model_freq, model_sev</span>
<span id="cb1007-7"><a href="r-for-insurance.html#cb1007-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We can then compute different quantities related to <span class="math inline">\(S\)</span>. For instance, the mean and quantiles can be computed using the <code>mean()</code> and <code>quantile()</code> functions:</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="r-for-insurance.html#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(Fs)</span></code></pre></div>
<pre><code>## [1] 20.13251</code></pre>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="r-for-insurance.html#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(Fs)</span></code></pre></div>
<pre><code>##      25%      50%      75%      90%      95%    97.5%      99%    99.5% 
## 14.38965 19.37523 25.25919 30.98962 33.85464 36.24842 39.92677 43.65289</code></pre>
<p>Other relevant quantities in insurance applications are the Value at Risk (VaR) and the Conditional Tail Expectation. Recall that the VaR of level <span class="math inline">\(\alpha \in (0,1)\)</span>, <span class="math inline">\(VaR_\alpha\)</span>, is the quantity satisfying</p>
<p><span class="math display">\[
\mathbb{P}(S \leq VaR_\alpha  ) = \alpha \,,
\]</span>
and that the conditional tail expectation of level <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(CTE_\alpha\)</span>, is given by
<span class="math display">\[
CTE_\alpha = \mathbb{E}[S \mid S&gt; VaR_\alpha  ] \,.
\]</span></p>
<p>The above quantities can be computed easily using the <code>VaR()</code> and <code>CTE()</code> functions in the <code>actuar</code> package.</p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="r-for-insurance.html#cb1012-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VaR</span>(Fs)</span></code></pre></div>
<pre><code>##      90%      95%      99% 
## 30.98962 33.85464 39.92677</code></pre>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="r-for-insurance.html#cb1014-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CTE</span>(Fs)</span></code></pre></div>
<pre><code>##      90%      95%      99% 
## 34.84512 37.52703 44.26966</code></pre>
<p>In fact, <code>aggregateDist()</code> implicitly calls the function <code>simul()</code> to perform the simulation. We can use the later directly as follows:</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="r-for-insurance.html#cb1016-1" aria-hidden="true" tabindex="-1"></a>sim_s <span class="ot">&lt;-</span> <span class="fu">simul</span>(<span class="dv">2500</span>,</span>
<span id="cb1016-2"><a href="r-for-insurance.html#cb1016-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.freq =</span> <span class="fu">expression</span>(<span class="fu">rpois</span>(<span class="dv">10</span>)),</span>
<span id="cb1016-3"><a href="r-for-insurance.html#cb1016-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model.sev =</span> <span class="fu">expression</span>(<span class="fu">rgamma</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb1016-4"><a href="r-for-insurance.html#cb1016-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>This creates an object containing the severities, frequencies, and aggregate claim amounts. The latter, representing <span class="math inline">\(S\)</span>, can be obtained using the <code>aggreate()</code> function.</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="r-for-insurance.html#cb1017-1" aria-hidden="true" tabindex="-1"></a>s_sample <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(sim_s)</span>
<span id="cb1017-2"><a href="r-for-insurance.html#cb1017-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(s_sample[<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>])</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00   14.45   19.03   19.87   24.65   52.91</code></pre>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="r-for-insurance.html#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(s_sample[<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>], <span class="at">freq =</span> F, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">&quot;Simulation of S&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-416-1.png" width="672" /></p>
<p>Alternatively, the simulation of <span class="math inline">\(S\)</span> can be performed with the following code:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="r-for-insurance.html#cb1020-1" aria-hidden="true" tabindex="-1"></a>s_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, distr, ...) {</span>
<span id="cb1020-2"><a href="r-for-insurance.html#cb1020-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">distr</span>(n, ...))</span>
<span id="cb1020-3"><a href="r-for-insurance.html#cb1020-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1020-4"><a href="r-for-insurance.html#cb1020-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1020-5"><a href="r-for-insurance.html#cb1020-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">2500</span>, <span class="dv">10</span>)</span>
<span id="cb1020-6"><a href="r-for-insurance.html#cb1020-6" aria-hidden="true" tabindex="-1"></a>s_sample <span class="ot">&lt;-</span> <span class="fu">sapply</span>(N, s_sim, <span class="at">distr =</span> rgamma, <span class="at">shape =</span> <span class="dv">2</span>, <span class="at">rate =</span> <span class="dv">1</span>)</span>
<span id="cb1020-7"><a href="r-for-insurance.html#cb1020-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(s_sample)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.8999 14.3967 19.3932 20.1325 25.2531 51.6455</code></pre>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="r-for-insurance.html#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(s_sample, <span class="at">freq =</span> F, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">&quot;Simulation of S&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-417-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="ruin-theory" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Ruin theory<a href="r-for-insurance.html#ruin-theory" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the previous section, we modeled the total claims over a fixed period in an insurance portfolio. In this section, we are interested in describing the evolution of the insurance company’s surplus over many periods. In particular, we want to find the probability that the surplus becomes negative, in other words, the probability that the ruin of the insurance company occurs. Finding this ruin probability is the main topic of <em>ruin theory</em>.</p>
<div id="the-surplus-process" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> The surplus process<a href="r-for-insurance.html#the-surplus-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In classical ruin theory, an insurer’s surplus at a fixed time <span class="math inline">\(t&gt;0\)</span> is determined by three quantities: the amount of the surplus at time <span class="math inline">\(t = 0\)</span> (also called initial surplus), the amount of premium income received up to time <span class="math inline">\(t\)</span>, and the amount paid out in claims up to time <span class="math inline">\(t\)</span>. More specifically, let <span class="math inline">\(U(t)\)</span> denote the surplus of an insurance company at time <span class="math inline">\(t\)</span>, <span class="math inline">\(c(t)\)</span> denote the premium received up to time <span class="math inline">\(t\)</span>, and <span class="math inline">\(S(t)\)</span> denote the aggregate claims paid up to time <span class="math inline">\(t\)</span>. If <span class="math inline">\(u\)</span> is the initial surplus at time <span class="math inline">\(t = 0\)</span>, then <span class="math inline">\(U(t)\)</span> is given by</p>
<p><span class="math display">\[
U(t) = u + c(t) - S(t) \,.
\]</span>
As previously mentioned, the ruin of the insurance company occurs when the surplus becomes negative. Thus, the <em>probability of ruin in infinite time</em> is defined as
<span class="math display">\[
\psi(u) = \mathbb{P}(U(t) &lt;0  \,\, \text{for some} \,\, t\geq0) \,.
\]</span>
We now make further assumptions in the surplus process that will allow us to compute (or approximate) the ruin probability.
First, we assume that the premium income is continuous over time and that the premium income in any time interval is proportional to the interval length. More specifically, <span class="math inline">\(c(t)\)</span> is given by
<span class="math display">\[
c(t) = ct \,,
\]</span>
where <span class="math inline">\(c &gt;0\)</span> is a constant rate. Next, we assume that the total amount claimed at time <span class="math inline">\(t\geq0\)</span>, <span class="math inline">\(S(t)\)</span>, is of the form
<span class="math display">\[
S(t) = \sum_{j = 1}^{N(t)} X_j \,,
\]</span></p>
<p>where <span class="math inline">\(N(t)\)</span> denotes the number of claims up to time <span class="math inline">\(t\)</span> and <span class="math inline">\(X_j\)</span> denotes the amount of claim <span class="math inline">\(j\)</span>.
Note that we follow the convention that <span class="math inline">\(S(t) = 0\)</span> if <span class="math inline">\(N(t) = 0\)</span>.
Furthermore, we assume that <span class="math inline">\(X_1, X_2, \dots\)</span> are iid random variables, which are also independent of <span class="math inline">\(N(t)\)</span>. We now require a specification for the claim number process <span class="math inline">\(N(t)\)</span>. We start by recalling the definition of a <em>counting process</em>.</p>
<div class="definition">
<p><span id="def:unlabeled-div-67" class="definition"><strong>Definition 4.1  </strong></span>A stochastic process <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> is called a counting process if it satisfies the following properties:</p>
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(N(0)=0\)</span>.</li>
<li>If <span class="math inline">\(s\leq t\)</span> then <span class="math inline">\(N(s)\leq N(t)\)</span>.</li>
<li><span class="math inline">\(N(t)\in \mathbb{N}\)</span> for all <span class="math inline">\(t&gt;0\)</span>.</li>
</ol>
</div>
<p>Intuitively, a counting process <span class="math inline">\(N(t)\)</span> counts the number of events that appear in the time interval <span class="math inline">\((0,t]\)</span>. In what follows we denote by <span class="math inline">\(T_1, T_2, \dots\)</span> the jump times of <span class="math inline">\(N(t)\)</span>, that is, <span class="math inline">\(T_k = \inf\{t\geq0 : N(t) \geq k\}\)</span> for all <span class="math inline">\(k \in \mathbb{N}\)</span>.</p>
<p>In classical ruin theory, it is common to assume that <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> is a <em>Poisson process</em>. In fact, in such a case, the model is often referred to as the Cramer-Lundberg model or classical risk model. We now present the definition of the Poisson process.</p>
<div class="definition">
<p><span id="def:unlabeled-div-68" class="definition"><strong>Definition 4.2  </strong></span>A counting process <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> is called a Poisson process with rate <span class="math inline">\(\lambda &gt; 0\)</span> if:</p>
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(\{N(t)\}\)</span> has stationary and independent increments.</li>
<li><span class="math inline">\(\mathbb{P}(N(h) = 0) = 1 - \lambda h + o(h)\)</span> as <span class="math inline">\(h \to 0\)</span>.</li>
<li><span class="math inline">\(\mathbb{P}(N(h) = 1) = \lambda h + o(h)\)</span> as <span class="math inline">\(h \to 0\)</span>.</li>
</ol>
</div>
<p>We now give some alternative definitions of the Poisson process.</p>
<div class="proposition">
<p><span id="prp:unlabeled-div-69" class="proposition"><strong>Proposition 4.2  </strong></span>Let <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> be a counting process. The following are equivalent:</p>
<ol style="list-style-type: lower-roman">
<li><span class="math inline">\(\{N(t)\}\)</span> is a Poisson process with rate <span class="math inline">\(\lambda &gt; 0\)</span>.</li>
<li><span class="math inline">\(\{N(t)\}\)</span> has independent increments and <span class="math inline">\(N(t) \sim Pois(\lambda t)\)</span> for all <span class="math inline">\(t\geq0\)</span>.</li>
<li>The interarrival times <span class="math inline">\(\{ T_k - T_{k-1} : k \geq 1 \}\)</span> are independent and exponentially distributed with mean <span class="math inline">\(1/\lambda\)</span>.</li>
</ol>
</div>
<p>In what follows, we denote the interarrival times by <span class="math inline">\(W_k = T_k - T_{k-1}\)</span>. Note that, in particular, iii. implies that a Poisson process is a particular case of a <em>renewal process</em>.</p>
<div class="definition">
<p><span id="def:unlabeled-div-70" class="definition"><strong>Definition 4.3  </strong></span>A counting process <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> is called an <em>ordinary renewal process</em> if its interarrival times <span class="math inline">\(\{ W_k : k \geq 1 \}\)</span> are iid.</p>
</div>
<p>When <span class="math inline">\(\{N(t)\}_{t\geq 0}\)</span> is a renewal process, the model is called <em>renewal risk model</em> or <em>Sparre Andersen model</em>.</p>
<p>To study the ruin probability <span class="math inline">\(\psi(u)\)</span>, we require further assumptions regarding the premium rate <span class="math inline">\(c&gt;0\)</span>. First, one can show that</p>
<p><span class="math display">\[
\psi(u) = 1 \quad \iff \mathbb{E}[c W - X ] &lt; 0 \,.
\]</span></p>
<p>Thus, in order to avoid ruin with probability one, we assume that
<span class="math display">\[
c &gt; \mathbb{E}[X ] /  \mathbb{E}[W] \,,
\]</span></p>
<p>which is known as the <em>net profit condition</em>. Note that in the classical risk model (i.e., <span class="math inline">\(W\sim Exp(\lambda)\)</span>), the net profit condition reads as
<span class="math display">\[
c &gt; \lambda \mathbb{E}[X ] \,,
\]</span>
which implies that
<span class="math display">\[
ct &gt; \mathbb{E}[S(t) ] \,,
\]</span>
that is, the premium income is above the expected value of aggregated losses for any time <span class="math inline">\(t\geq0\)</span>. In such a case, <span class="math inline">\(c\)</span> is typically described in terms of a <em>security loading</em> <span class="math inline">\(\theta\geq0\)</span> such that</p>
<p><span class="math display">\[
c = (1 + \theta )\lambda \mathbb{E}[X ] \,.
\]</span></p>
<p>Finally, one can show that under the net profit condition
<span class="math display">\[
\psi(u) \to 0 \quad \text{as} \quad u \to \infty \,.
\]</span></p>
<p>In what follows, we assume that the net profit condition is satisfied.</p>
</div>
<div id="the-adjustment-coefficient" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> The adjustment coefficient<a href="r-for-insurance.html#the-adjustment-coefficient" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The quantity known as the <em>adjustment coefficient</em> is a valuable tool in risk theory that allows us to find a bound for the ruin probability. More specifically, the adjustment coefficient <span class="math inline">\(R\)</span> is defined as the smallest strictly positive solution (if it exists) to the <em>Lundberg equation</em></p>
<p><span class="math display">\[
h(t) = \mathbb{E} \left[\exp(tX - tcW) \right] = 1 \,,
\]</span>
where <span class="math inline">\(c&gt;0\)</span> satisfies the net profit condition. Under the assumption of independence between <span class="math inline">\(X\)</span> and <span class="math inline">\(W\)</span>, as in the most common models, the equation can be rewritten as</p>
<p><span class="math display">\[
h(t) = M_X(t) M_W(-tc) = 1 \,.
\]</span></p>
<p>In general, it is not possible to explicitly solve the above equation for <span class="math inline">\(R\)</span>. Usually, one must resort to numerical methods, many of which require an initial guess about the value of <span class="math inline">\(R\)</span>. An upper bound of the adjustment coefficient in the classical risk model (there are many) is given by
<span class="math display">\[
R\leq \frac{2(c-\lambda\mathbb{E}[X])}{\lambda\mathbb{E}[X^2]}=\frac{2\theta\mathbb{E}[X]}{\mathbb{E}[X^2]}\,.
\]</span></p>
<p>In R, we can use the <code>adjCoef()</code> function from the <code>actuar</code> package to compute the adjustment coefficient. We require the following arguments: the two moment generating functions <span class="math inline">\(M_X(t)\)</span> and <span class="math inline">\(M_W(t)\)</span> (thereby assuming independence), the premium rate <span class="math inline">\(c\)</span>, and the upper bound of the support of <span class="math inline">\(M_X(t)\)</span> or any other upper bound for <span class="math inline">\(R\)</span>. For example, if <span class="math inline">\(W\sim Exp(2)\)</span>, <span class="math inline">\(X \sim Exp(1)\)</span> and the premium rate is <span class="math inline">\(c = 2.4\)</span>, then the adjustment coefficient is</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="r-for-insurance.html#cb1023-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjCoef</span>(</span>
<span id="cb1023-2"><a href="r-for-insurance.html#cb1023-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mgf.claim =</span> <span class="fu">mgfexp</span>(x), <span class="at">mgf.wait =</span> <span class="fu">mgfexp</span>(x, <span class="dv">2</span>),</span>
<span id="cb1023-3"><a href="r-for-insurance.html#cb1023-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">premium.rate =</span> <span class="fl">2.4</span>, <span class="at">upper.bound =</span> <span class="dv">1</span></span>
<span id="cb1023-4"><a href="r-for-insurance.html#cb1023-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] 0.1666667</code></pre>
<p>In the above solution, we passed the upper bound for the support of <span class="math inline">\(M_X(t)\)</span>. However, since we are in the classical risk model setup, we could have also used the upper bound of <span class="math inline">\(R\)</span> described previously</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="r-for-insurance.html#cb1025-1" aria-hidden="true" tabindex="-1"></a>exp_aux <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1025-2"><a href="r-for-insurance.html#cb1025-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">*</span> <span class="fu">dexp</span>(x, <span class="dv">1</span>)</span>
<span id="cb1025-3"><a href="r-for-insurance.html#cb1025-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1025-4"><a href="r-for-insurance.html#cb1025-4" aria-hidden="true" tabindex="-1"></a>snd_aux <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1025-5"><a href="r-for-insurance.html#cb1025-5" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dexp</span>(x, <span class="dv">1</span>)</span>
<span id="cb1025-6"><a href="r-for-insurance.html#cb1025-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1025-7"><a href="r-for-insurance.html#cb1025-7" aria-hidden="true" tabindex="-1"></a>exp_x <span class="ot">&lt;-</span> <span class="fu">integrate</span>(exp_aux, <span class="dv">0</span>, <span class="cn">Inf</span>)<span class="sc">$</span>value</span>
<span id="cb1025-8"><a href="r-for-insurance.html#cb1025-8" aria-hidden="true" tabindex="-1"></a>exp_x</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="r-for-insurance.html#cb1027-1" aria-hidden="true" tabindex="-1"></a>snd_x <span class="ot">&lt;-</span> <span class="fu">integrate</span>(snd_aux, <span class="dv">0</span>, <span class="cn">Inf</span>)<span class="sc">$</span>value</span>
<span id="cb1027-2"><a href="r-for-insurance.html#cb1027-2" aria-hidden="true" tabindex="-1"></a>snd_x</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="r-for-insurance.html#cb1029-1" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="fl">2.4</span></span>
<span id="cb1029-2"><a href="r-for-insurance.html#cb1029-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1029-3"><a href="r-for-insurance.html#cb1029-3" aria-hidden="true" tabindex="-1"></a>bound <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (c <span class="sc">-</span> lambda <span class="sc">*</span> exp_x) <span class="sc">/</span> (lambda <span class="sc">*</span> snd_x)</span>
<span id="cb1029-4"><a href="r-for-insurance.html#cb1029-4" aria-hidden="true" tabindex="-1"></a>bound</span></code></pre></div>
<pre><code>## [1] 0.2</code></pre>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="r-for-insurance.html#cb1031-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> <span class="fu">adjCoef</span>(</span>
<span id="cb1031-2"><a href="r-for-insurance.html#cb1031-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">mgf.claim =</span> <span class="fu">mgfexp</span>(x), <span class="at">mgf.wait =</span> <span class="fu">mgfexp</span>(x, <span class="dv">2</span>),</span>
<span id="cb1031-3"><a href="r-for-insurance.html#cb1031-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">premium.rate =</span> <span class="fl">2.4</span>, <span class="at">upper.bound =</span> bound</span>
<span id="cb1031-4"><a href="r-for-insurance.html#cb1031-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1031-5"><a href="r-for-insurance.html#cb1031-5" aria-hidden="true" tabindex="-1"></a>R</span></code></pre></div>
<pre><code>## [1] 0.1666667</code></pre>
<p>As previously mentioned, knowledge of the adjustment coefficient allows computing a bound for the ruin probability, as described in the following result.</p>
<div class="theorem">
<p><span id="thm:unlabeled-div-71" class="theorem"><strong>Theorem 4.2  (Lundberg's inequality) </strong></span>For <span class="math inline">\(u\geq 0\)</span>, the ruin probability, <span class="math inline">\(\psi(u)\)</span>, has an exponential upper bound, given by
<span class="math display">\[
  \psi(u)\leq \exp(-Ru) \,,
\]</span>
where <span class="math inline">\(R\)</span> is the adjustment coefficient.</p>
</div>
<p>In our last example, we can then compute a bound for the ruin probability as (assuming <span class="math inline">\(u = 3\)</span>)</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="r-for-insurance.html#cb1033-1" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb1033-2"><a href="r-for-insurance.html#cb1033-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>R <span class="sc">*</span> u)</span></code></pre></div>
<pre><code>## [1] 0.6065307</code></pre>
</div>
<div id="probability-of-ruin" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Probability of ruin<a href="r-for-insurance.html#probability-of-ruin" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Explicit calculation of the infinite time probability of ruin is a difficult task except for the most simple models. For example, if the interarrival times <span class="math inline">\(W\)</span> are <span class="math inline">\(Exp(\lambda)\)</span> distributed (i.e., the claim numbers are described using a Poisson process) and the claim amounts <span class="math inline">\(X\)</span> are <span class="math inline">\(Exp(\beta)\)</span> distributed, then</p>
<p><span class="math display">\[
\psi(u) = \frac{\lambda}{c \beta} \exp((\beta  - \lambda / c)u) \,, \quad u \geq0 \,.
\]</span>
In the model above, although the frequency assumption can be justified, the severity assumption can hardly be used to describe real-life problems making the model mainly an illustration tool. Fortunately, other generalizations of the exponential distribution, such as mixtures of exponentials and Erlang (and, more generally, phase-type distributions), also allow for a closed-form solution for the ruin probability. The function <code>ruin()</code> of the <code>actuar</code> package allows computing the ruin probability for such cases. First, one needs to specify the claim amount and interarrival times models with any combination of “exponential”, “Erlang” (and “phase-type”). Then, one passes the parameters of each model using lists with components named after the corresponding parameters of <code>dexp</code>, <code>dgamma</code> (and <code>dphtype</code>). If an argument <code>weights</code> is provided, the model is a mixture of exponential or Erlang. Let us illustrate first an exponential/exponential model with premium rate <span class="math inline">\(c = 1\)</span> (default):</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="r-for-insurance.html#cb1035-1" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">ruin</span>(</span>
<span id="cb1035-2"><a href="r-for-insurance.html#cb1035-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">claims =</span> <span class="st">&quot;e&quot;</span>, <span class="at">par.claims =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="dv">5</span>),</span>
<span id="cb1035-3"><a href="r-for-insurance.html#cb1035-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wait =</span> <span class="st">&quot;e&quot;</span>, <span class="at">par.wait =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="dv">3</span>)</span>
<span id="cb1035-4"><a href="r-for-insurance.html#cb1035-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1035-5"><a href="r-for-insurance.html#cb1035-5" aria-hidden="true" tabindex="-1"></a><span class="fu">psi</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="co"># Evaluates the ruin probability for initial surplus from 0 to 10.</span></span></code></pre></div>
<pre><code>##  [1] 6.000000e-01 8.120117e-02 1.098938e-02 1.487251e-03 2.012776e-04
##  [6] 2.723996e-05 3.686527e-06 4.989172e-07 6.752110e-08 9.137988e-09
## [11] 1.236692e-09</code></pre>
<p>Next, we consider a model with a mixture of two exponentials for the claim amounts, exponential interarrival times, and premium rate <span class="math inline">\(c = 1.5\)</span>.</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="r-for-insurance.html#cb1037-1" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">ruin</span>(</span>
<span id="cb1037-2"><a href="r-for-insurance.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">claims =</span> <span class="st">&quot;e&quot;</span>, <span class="at">par.claims =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="at">w =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)),</span>
<span id="cb1037-3"><a href="r-for-insurance.html#cb1037-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wait =</span> <span class="st">&quot;e&quot;</span>, <span class="at">par.wait =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="dv">3</span>),</span>
<span id="cb1037-4"><a href="r-for-insurance.html#cb1037-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre =</span> <span class="fl">1.5</span></span>
<span id="cb1037-5"><a href="r-for-insurance.html#cb1037-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1037-6"><a href="r-for-insurance.html#cb1037-6" aria-hidden="true" tabindex="-1"></a><span class="fu">psi</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 4.380952e-01 5.310603e-02 7.529333e-03 1.070525e-03 1.522149e-04
##  [6] 2.164303e-05 3.077365e-06 4.375623e-07 6.221582e-08 8.846302e-09
## [11] 1.257832e-09</code></pre>
<p>Moreover, we can plot the ruin probability straightforwardly as a function of the initial surplus using the <code>plot()</code> function as follows:</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="r-for-insurance.html#cb1039-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(psi, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-423-1.png" width="672" /></p>
<p>Finally, we consider a model with Erlang claim amounts and exponentials interarrival times:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="r-for-insurance.html#cb1040-1" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">ruin</span>(</span>
<span id="cb1040-2"><a href="r-for-insurance.html#cb1040-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">claims =</span> <span class="st">&quot;E&quot;</span>, <span class="at">par.claims =</span> <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">3</span>, <span class="at">rate =</span> <span class="dv">1</span>),</span>
<span id="cb1040-3"><a href="r-for-insurance.html#cb1040-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wait =</span> <span class="st">&quot;e&quot;</span>, <span class="at">par.wait =</span> <span class="fu">list</span>(<span class="at">rate =</span> <span class="dv">3</span>),</span>
<span id="cb1040-4"><a href="r-for-insurance.html#cb1040-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pre =</span> <span class="dv">10</span></span>
<span id="cb1040-5"><a href="r-for-insurance.html#cb1040-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1040-6"><a href="r-for-insurance.html#cb1040-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(psi, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-424-1.png" width="672" /></p>
</div>
<div id="reinsurance" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Reinsurance<a href="r-for-insurance.html#reinsurance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Reinsurance means that the company (the cedent) insures a part of the risk at another insurance company (the reinsurer).
In this subsection, we study how different types of reinsurance can affect the adjustment coefficient and the probability of ruin. In what follows, we consider the classical risk model unless it states otherwise.</p>
<p>Let <span class="math inline">\(X\)</span> (<span class="math inline">\(\geq 0\)</span>) denote the claim amount under a reinsurance-free environment. A reinsurance arrangement is then defined in terms of a function <span class="math inline">\(h(x)\)</span> with the property <span class="math inline">\(0\leq h(x)\leq x\)</span>. Here <span class="math inline">\(h(x)\)</span> is the amount of the claim <span class="math inline">\(x\)</span> to be paid by the cedent, and <span class="math inline">\(x - h(x)\)</span> is the amount to be paid by the reinsurer. The most common examples are the following two:</p>
<ul>
<li><strong>Proportional reinsurance</strong>. <span class="math inline">\(h(x) = ax\)</span> for some <span class="math inline">\(a \in [0, 1]\)</span>. Also called quota share reinsurance.</li>
<li><strong>Excess-of-loss reinsurance</strong>. <span class="math inline">\(h(x) = \min(x, m)\)</span> for some <span class="math inline">\(m \in (0, \infty)\)</span>, referred to as the retention limit.</li>
</ul>
<p>Next, assume that in a reinsurance-free setting, there is a security loading <span class="math inline">\(\theta\geq0\)</span>, such that the premium rate is
<span class="math display">\[
(1+\theta)\lambda \mathbb{E}(X) \,.
\]</span>
If we assume that under the reinsurance agreement <span class="math inline">\(h\)</span>, the reinsurer receives a premium rate determined by a security loading <span class="math inline">\(\theta_h \geq0\)</span>, that is,
<span class="math display">\[
(1+\theta_h)\lambda\mathbb{E}\bigl(X-h(X)\bigr) \,.
\]</span>
Then, the premium rate <span class="math inline">\(c^*\)</span> for the cedent is
<span class="math display">\[
    c^*=(1+\theta)\lambda \mathbb{E}[X]-(1+\theta_h)\lambda\mathbb{E}[X-h(X)] \,.
\]</span></p>
<p>Furthermore, we require
<span class="math display">\[
    c^*&gt;\lambda\mathbb{E}\bigl[h(X)\bigr] \,,
\]</span>
which plays the role of our new net profit condition.
Thus, the surplus process of the cedent, <span class="math inline">\(\{U^*(t)\}_{t\geq 0}\)</span>, is given by</p>
<p><span class="math display">\[
    U^*(t)=u+c^*t-\sum_{j=1}^{N(t)}h(X_j) \,,\quad t\geq 0 \,.
\]</span></p>
<p>Now, let <span class="math inline">\(R_h\)</span> denote the adjustment coefficient under the <span class="math inline">\(h\)</span> reinsurance agreement, meaning that <span class="math inline">\(R_h\)</span> is the unique positive solution to the equation
<span class="math display">\[
    1= M_{h(X)}(t) M_W(-c^* t)\,,
\]</span>
provided that <span class="math inline">\(M_{h(X)}(t)=\mathbb{E}[\exp(t h(X))]\)</span>, exists.</p>
<p>Thus, the insurer’s ultimate ruin probability upper bound is given by
<span class="math display">\[
    \psi_{*}(u)\leq \exp(-R_h u)\,, \quad u\geq 0 \,,
\]</span>
where <span class="math inline">\(\psi_{*}\)</span> is the probability of ruin corresponding to the surplus process <span class="math inline">\(\{U^*(t)\}_{t\geq 0}\)</span>.</p>
<p>We now study in more detail the proportional and excess-of-loss reinsurance agreements, which are implemented in the <code>actuar</code> package.</p>
<div id="proportional-reinsurance" class="section level4 unnumbered hasAnchor">
<h4>Proportional reinsurance<a href="r-for-insurance.html#proportional-reinsurance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Under proportional reinsurance, <span class="math inline">\(h\)</span> is given by
<span class="math display">\[
    h(X)=aX \,, \qquad 0\leq a\leq 1\,.
\]</span>
Thus, the relative security loading <span class="math inline">\(\theta_h\)</span> satisfies the equation
<span class="math display">\[
    c^*=\Bigl((1+\theta)-(1+\theta_h)(1-a)\Bigr)\lambda \mathbb{E}[X] \,.
\]</span></p>
<p>It follows from the above equation and the net profit condition that
<span class="math display">\[
  a&gt;1-\frac{\theta}{\theta_h} \,.
\]</span>
In other words, the insurer must retain at least the proportion <span class="math inline">\(1-{\theta}/{\theta_h}\)</span> to avoid ultimate ruin with probability one.</p>
<p>In this case, the adjustment coefficient <span class="math inline">\(R_h\)</span> satisfies the equation<br />
<span class="math display">\[
  1=M_{aX}(t) M_W(-c^* t) = M_{X}(at) M_W(-c^* t) \,.
\]</span></p>
<p>Moreover, an upper bound of the adjustment coefficient is given by:
<span class="math display">\[
    R_h\leq \frac{2(c^*-a\lambda\mathbb{E}[X])}{\lambda a^2\mathbb{E}[X^2]} \,,
\]</span></p>
<p>We now provide an example, which can be solved using the <code>adjCoef()</code> function.</p>
<div class="example">
<p><span id="exm:unlabeled-div-72" class="example"><strong>Example 4.2  </strong></span>Consider the following classical risk model under proportional reinsurance: The claim amounts are exponentially distributed with mean <span class="math inline">\(1\)</span>, the Poisson rate is <span class="math inline">\(\lambda=2\)</span>, and the safety loadings are <span class="math inline">\(\theta=0.2\)</span> and <span class="math inline">\(\theta_h=0.3\)</span>.</p>
<ol style="list-style-type: lower-alpha">
<li>Find the adjustment coefficient <span class="math inline">\(R_h\)</span> if <span class="math inline">\(a=0.75, 0.8, 0.9, 1\)</span>.</li>
<li>Plot the adjustment coefficient as a function of the proportion <span class="math inline">\(a\)</span>.</li>
<li>Find an upper bound for the ruin probability if <span class="math inline">\(a = 0.5\)</span> and <span class="math inline">\(u = 2\)</span>.</li>
</ol>
</div>
<div class="solution">
<p><span id="unlabeled-div-73" class="solution"><em>Solution</em>. </span><span class="math inline">\(\,\)</span></p>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="r-for-insurance.html#cb1041-1" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1041-2"><a href="r-for-insurance.html#cb1041-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb1041-3"><a href="r-for-insurance.html#cb1041-3" aria-hidden="true" tabindex="-1"></a>thetah <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb1041-4"><a href="r-for-insurance.html#cb1041-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1041-5"><a href="r-for-insurance.html#cb1041-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We require a function to compute the premium rate for different values of a</span></span>
<span id="cb1041-6"><a href="r-for-insurance.html#cb1041-6" aria-hidden="true" tabindex="-1"></a>prem <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1041-7"><a href="r-for-insurance.html#cb1041-7" aria-hidden="true" tabindex="-1"></a>  ((<span class="dv">1</span> <span class="sc">+</span> theta) <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">+</span> thetah) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> x)) <span class="sc">*</span> lambda</span>
<span id="cb1041-8"><a href="r-for-insurance.html#cb1041-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1041-9"><a href="r-for-insurance.html#cb1041-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1041-10"><a href="r-for-insurance.html#cb1041-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We require need a function to computute the mgf of aX for different values of a</span></span>
<span id="cb1041-11"><a href="r-for-insurance.html#cb1041-11" aria-hidden="true" tabindex="-1"></a>mgf_ax <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb1041-12"><a href="r-for-insurance.html#cb1041-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mgfexp</span>(x <span class="sc">*</span> y)</span>
<span id="cb1041-13"><a href="r-for-insurance.html#cb1041-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1041-14"><a href="r-for-insurance.html#cb1041-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1041-15"><a href="r-for-insurance.html#cb1041-15" aria-hidden="true" tabindex="-1"></a>adj_prop <span class="ot">&lt;-</span> <span class="fu">adjCoef</span>(mgf_ax,</span>
<span id="cb1041-16"><a href="r-for-insurance.html#cb1041-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">mgf.wait =</span> <span class="fu">mgfexp</span>(x, <span class="dv">2</span>),</span>
<span id="cb1041-17"><a href="r-for-insurance.html#cb1041-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">premium.rate =</span> prem,</span>
<span id="cb1041-18"><a href="r-for-insurance.html#cb1041-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="dv">1</span>,</span>
<span id="cb1041-19"><a href="r-for-insurance.html#cb1041-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">reins =</span> <span class="st">&quot;prop&quot;</span>, <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span></span>
<span id="cb1041-20"><a href="r-for-insurance.html#cb1041-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1041-21"><a href="r-for-insurance.html#cb1041-21" aria-hidden="true" tabindex="-1"></a><span class="fu">adj_prop</span>(<span class="fu">c</span>(<span class="fl">0.75</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] 0.1904762 0.1861702 0.1765317 0.1666667</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="r-for-insurance.html#cb1043-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(adj_prop)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-426-1.png" width="672" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="r-for-insurance.html#cb1044-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">adj_prop</span>(<span class="fl">0.5</span>) <span class="sc">*</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.6951439</code></pre>
</div>
</div>
<div id="excess-of-loss-reinsurance" class="section level4 unnumbered hasAnchor">
<h4>Excess-of-loss reinsurance<a href="r-for-insurance.html#excess-of-loss-reinsurance" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Under excess-of-loss reinsurance with retention level <span class="math inline">\(m\)</span>, <span class="math inline">\(h\)</span> is given by</p>
<p><span class="math display">\[
    h(X)=\min(X,m) \,.
\]</span>
Thus, the relative security loading, <span class="math inline">\(\theta_h\)</span>, satisfies the equation
<span class="math display">\[\begin{eqnarray*}
  c^* &amp;=&amp; (1+\theta)\lambda\mathbb{E}[X]-(1+\theta_h)\lambda\mathbb{E}[X-\min(X,m)] \\
   &amp;=&amp; (1+\theta_h)\lambda\mathbb{E}[\min(X,m)] - (\theta_h-\theta)\lambda\mathbb{E}[X]\,,
\end{eqnarray*}\]</span>
with
<span class="math display">\[
    c^*&gt;\lambda\mathbb{E}[\min(X,m)] \,.
\]</span>
Further, the adjustment coefficient, <span class="math inline">\(R_h\)</span>, is the solution to the following equation
<span class="math display">\[
    1=M_{\min(X,m)}(t)M_W(-tc^*) \,.
\]</span>
Note that
<span class="math display">\[\begin{eqnarray*}
    M_{\min(X,m)}(t)    &amp;=&amp; \mathbb{E}[\exp(t\min(X,m)] \\
    &amp;=&amp; \int_{0}^{m}\exp(t x)f_X(x)dx+\exp(t m)(1-F_X(m)) \,.
\end{eqnarray*}\]</span></p>
<div class="example">
<p><span id="exm:unlabeled-div-74" class="example"><strong>Example 4.3  </strong></span>Consider the following classical risk model under excess-of-loss reinsurance: The claim amounts are Gamma distributed with shape parameter <span class="math inline">\(2\)</span> and rate parameter <span class="math inline">\(2\)</span>, the Poisson rate is <span class="math inline">\(\lambda=1\)</span>, and the safety loadings are <span class="math inline">\(\theta=0.2\)</span> and <span class="math inline">\(\theta_h=0.3\)</span>. Plot the adjustment coefficient as a function of the retention limit <span class="math inline">\(m\)</span> varying from <span class="math inline">\(0\)</span> to <span class="math inline">\(10\)</span>.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-75" class="solution"><em>Solution</em>. </span>We first note that for <span class="math inline">\(X\sim Gamma(\alpha, \lambda)\)</span>
<span class="math display">\[
\int_{0}^{m}\exp(t x)f_X(x)dx = \left( \frac{\lambda}{\lambda - t}\right)^\alpha F_{\tilde{X}}(m) \,,
\]</span>
where <span class="math inline">\(\tilde{X} \sim Gamma(\alpha, \lambda - t)\)</span>. Thus,</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="r-for-insurance.html#cb1046-1" aria-hidden="true" tabindex="-1"></a>prem <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1046-2"><a href="r-for-insurance.html#cb1046-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.3</span> <span class="sc">*</span> <span class="fu">levgamma</span>(x, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">-</span> <span class="fl">0.1</span></span>
<span id="cb1046-3"><a href="r-for-insurance.html#cb1046-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1046-4"><a href="r-for-insurance.html#cb1046-4" aria-hidden="true" tabindex="-1"></a>mgfx <span class="ot">&lt;-</span> <span class="cf">function</span>(x, l) {</span>
<span id="cb1046-5"><a href="r-for-insurance.html#cb1046-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mgfgamma</span>(x, <span class="dv">2</span>, <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">pgamma</span>(l, <span class="dv">2</span>, <span class="dv">2</span> <span class="sc">-</span> x) <span class="sc">+</span></span>
<span id="cb1046-6"><a href="r-for-insurance.html#cb1046-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(x <span class="sc">*</span> l) <span class="sc">*</span> <span class="fu">pgamma</span>(l, <span class="dv">2</span>, <span class="dv">2</span>, <span class="at">lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1046-7"><a href="r-for-insurance.html#cb1046-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1046-8"><a href="r-for-insurance.html#cb1046-8" aria-hidden="true" tabindex="-1"></a>adj_eol <span class="ot">&lt;-</span> <span class="fu">adjCoef</span>(mgfx,</span>
<span id="cb1046-9"><a href="r-for-insurance.html#cb1046-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">premium =</span> prem,</span>
<span id="cb1046-10"><a href="r-for-insurance.html#cb1046-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="dv">1</span>,</span>
<span id="cb1046-11"><a href="r-for-insurance.html#cb1046-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">reins =</span> <span class="st">&quot;excess-of-loss&quot;</span>,</span>
<span id="cb1046-12"><a href="r-for-insurance.html#cb1046-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span></span>
<span id="cb1046-13"><a href="r-for-insurance.html#cb1046-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1046-14"><a href="r-for-insurance.html#cb1046-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(adj_eol)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-428-1.png" width="672" /></p>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-for-finance.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
