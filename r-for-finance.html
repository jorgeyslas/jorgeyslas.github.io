<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 R for Finance | Financial and Actuarial Modelling in R (MATH377)</title>
  <meta name="description" content="3 R for Finance | Financial and Actuarial Modelling in R (MATH377)" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="3 R for Finance | Financial and Actuarial Modelling in R (MATH377)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 R for Finance | Financial and Actuarial Modelling in R (MATH377)" />
  
  
  

<meta name="author" content="Jorge Yslas" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="r-for-statistical-inference.html"/>
<link rel="next" href="r-for-insurance.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation"><i class="fa fa-check"></i><b>1.1</b> Installation</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation-of-r"><i class="fa fa-check"></i><b>1.1.1</b> Installation of R</a></li>
<li class="chapter" data-level="1.1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#installation-of-rstudio"><i class="fa fa-check"></i><b>1.1.2</b> Installation of Rstudio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-as-a-simple-calculator"><i class="fa fa-check"></i><b>1.2</b> R as a simple calculator</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#logical-operators"><i class="fa fa-check"></i><b>1.2.1</b> Logical operators</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-objects"><i class="fa fa-check"></i><b>1.3</b> R objects</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#assignment"><i class="fa fa-check"></i><b>1.3.1</b> Assignment</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-types"><i class="fa fa-check"></i><b>1.3.2</b> Data types</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectors"><i class="fa fa-check"></i><b>1.4</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#accessing-vector-elements"><i class="fa fa-check"></i><b>1.4.1</b> Accessing vector elements</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#operations-with-vectors"><i class="fa fa-check"></i><b>1.4.2</b> Operations with vectors</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices-data-frames-and-lists"><i class="fa fa-check"></i><b>1.5</b> Matrices, data frames, and lists</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#matrices"><i class="fa fa-check"></i><b>1.5.1</b> Matrices</a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-frames"><i class="fa fa-check"></i><b>1.5.2</b> Data frames</a></li>
<li class="chapter" data-level="1.5.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#lists"><i class="fa fa-check"></i><b>1.5.3</b> Lists</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>1.6</b> Functions</a></li>
<li class="chapter" data-level="1.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#packages"><i class="fa fa-check"></i><b>1.7</b> Packages</a></li>
<li class="chapter" data-level="1.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#control-statements"><i class="fa fa-check"></i><b>1.8</b> Control Statements</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#conditional-statements"><i class="fa fa-check"></i><b>1.8.1</b> Conditional statements</a></li>
<li class="chapter" data-level="1.8.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#loop-statements"><i class="fa fa-check"></i><b>1.8.2</b> Loop statements</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#vectorized-operations"><i class="fa fa-check"></i><b>1.9</b> Vectorized operations</a></li>
<li class="chapter" data-level="1.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-and-writing-data"><i class="fa fa-check"></i><b>1.10</b> Reading and writing data</a>
<ul>
<li class="chapter" data-level="1.10.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#working-directory"><i class="fa fa-check"></i><b>1.10.1</b> Working directory</a></li>
<li class="chapter" data-level="1.10.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#writing-data"><i class="fa fa-check"></i><b>1.10.2</b> Writing data</a></li>
<li class="chapter" data-level="1.10.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data"><i class="fa fa-check"></i><b>1.10.3</b> Reading data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html"><i class="fa fa-check"></i><b>2</b> R for Statistical Inference</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#descriptive-statistics"><i class="fa fa-check"></i><b>2.1</b> Descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#visual-tools"><i class="fa fa-check"></i><b>2.1.1</b> Visual tools</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#probability-distributions"><i class="fa fa-check"></i><b>2.2</b> Probability distributions</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#tranformations"><i class="fa fa-check"></i><b>2.2.1</b> Tranformations</a></li>
<li class="chapter" data-level="2.2.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#law-of-large-numbers-and-central-limit-theorem"><i class="fa fa-check"></i><b>2.2.2</b> Law of large numbers and central limit theorem</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#parinf"><i class="fa fa-check"></i><b>2.3</b> Parametric inference</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>2.3.1</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="2.3.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#adequacy-of-the-fit"><i class="fa fa-check"></i><b>2.3.2</b> Adequacy of the fit</a></li>
<li class="chapter" data-level="2.3.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#other-estimation-methods"><i class="fa fa-check"></i><b>2.3.3</b> Other estimation methods</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#multivariate-distributions"><i class="fa fa-check"></i><b>2.4</b> Multivariate distributions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#multivariate-normal-distribution"><i class="fa fa-check"></i><b>2.4.1</b> Multivariate normal distribution</a></li>
<li class="chapter" data-level="2.4.2" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#copulas"><i class="fa fa-check"></i><b>2.4.2</b> Copulas</a></li>
<li class="chapter" data-level="2.4.3" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#constructing-multivariate-distributions-from-copulas"><i class="fa fa-check"></i><b>2.4.3</b> Constructing multivariate distributions from copulas</a></li>
<li class="chapter" data-level="2.4.4" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#dependence-measures"><i class="fa fa-check"></i><b>2.4.4</b> Dependence measures</a></li>
<li class="chapter" data-level="2.4.5" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#fitting"><i class="fa fa-check"></i><b>2.4.5</b> Fitting</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="r-for-statistical-inference.html"><a href="r-for-statistical-inference.html#linear-regression"><i class="fa fa-check"></i><b>2.5</b> Linear regression</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r-for-finance.html"><a href="r-for-finance.html"><i class="fa fa-check"></i><b>3</b> R for Finance</a>
<ul>
<li class="chapter" data-level="3.1" data-path="r-for-finance.html"><a href="r-for-finance.html#market-portfolio-and-capm"><i class="fa fa-check"></i><b>3.1</b> Market portfolio and CAPM</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="r-for-finance.html"><a href="r-for-finance.html#mean-variance-portfolio"><i class="fa fa-check"></i><b>3.1.1</b> Mean-variance portfolio</a></li>
<li class="chapter" data-level="3.1.2" data-path="r-for-finance.html"><a href="r-for-finance.html#capital-asset-pricing-model-capm"><i class="fa fa-check"></i><b>3.1.2</b> Capital Asset Pricing Model (CAPM)</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="r-for-finance.html"><a href="r-for-finance.html#the-binomial-model"><i class="fa fa-check"></i><b>3.2</b> The binomial model</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="r-for-finance.html"><a href="r-for-finance.html#one-period-binomial-model"><i class="fa fa-check"></i><b>3.2.1</b> One-period binomial model</a></li>
<li class="chapter" data-level="3.2.2" data-path="r-for-finance.html"><a href="r-for-finance.html#multiperiod-binomial-model"><i class="fa fa-check"></i><b>3.2.2</b> Multiperiod binomial model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="r-for-finance.html"><a href="r-for-finance.html#the-black-and-scholes-model"><i class="fa fa-check"></i><b>3.3</b> The Black and Scholes model</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="r-for-finance.html"><a href="r-for-finance.html#preliminars-brownian-motion"><i class="fa fa-check"></i><b>3.3.1</b> Preliminars: Brownian motion</a></li>
<li class="chapter" data-level="3.3.2" data-path="r-for-finance.html"><a href="r-for-finance.html#the-black-and-scholes-formula"><i class="fa fa-check"></i><b>3.3.2</b> The Black and Scholes formula</a></li>
<li class="chapter" data-level="3.3.3" data-path="r-for-finance.html"><a href="r-for-finance.html#greeks"><i class="fa fa-check"></i><b>3.3.3</b> Greeks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-for-insurance.html"><a href="r-for-insurance.html"><i class="fa fa-check"></i><b>4</b> R for Insurance</a>
<ul>
<li class="chapter" data-level="4.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-collective-risk-model"><i class="fa fa-check"></i><b>4.1</b> The collective risk model</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#discretization-of-claim-amount-distributions"><i class="fa fa-check"></i><b>4.1.1</b> Discretization of claim amount distributions</a></li>
<li class="chapter" data-level="4.1.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#calculation-of-the-aggregate-claim-amount-distribution"><i class="fa fa-check"></i><b>4.1.2</b> Calculation of the aggregate claim amount distribution</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#ruin-theory"><i class="fa fa-check"></i><b>4.2</b> Ruin theory</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-surplus-process"><i class="fa fa-check"></i><b>4.2.1</b> The surplus process</a></li>
<li class="chapter" data-level="4.2.2" data-path="r-for-insurance.html"><a href="r-for-insurance.html#the-adjustment-coefficient"><i class="fa fa-check"></i><b>4.2.2</b> The adjustment coefficient</a></li>
<li class="chapter" data-level="4.2.3" data-path="r-for-insurance.html"><a href="r-for-insurance.html#probability-of-ruin"><i class="fa fa-check"></i><b>4.2.3</b> Probability of ruin</a></li>
<li class="chapter" data-level="4.2.4" data-path="r-for-insurance.html"><a href="r-for-insurance.html#reinsurance"><i class="fa fa-check"></i><b>4.2.4</b> Reinsurance</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Financial and Actuarial Modelling in R (MATH377)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r-for-finance" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> R for Finance<a href="r-for-finance.html#r-for-finance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="market-portfolio-and-capm" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Market portfolio and CAPM<a href="r-for-finance.html#market-portfolio-and-capm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let us imagine that we have available a certain amount of money and want to invest it by buying different stocks available in the market. A combination of stocks that we can buy is what is called a <em>portfolio</em>. The main problem that we want to address here is determining the portfolio, or equivalently, the ratio of stocks that we should buy. Ideally, we would like to pick a portfolio that will return a high profit with low risk. Modern portfolio theory gives us some solutions to this problem. The main idea of modern portfolio theory is to assume that the price movements (or returns) of stocks (or risky assets) are random variables. Then, we can define the <em>risk</em> of a particular stock, as how much the individual return of that stock deviates from its mean return. This is usually quantified by the standard deviation, which is often called <em>volatility</em> in finance. Typically, a stock that might give high returns have high volatility, and stocks with low volatility often make low returns. Hence, the important problem is calculating the portfolio that generates a higher profit with less volatility than individual stocks.</p>
<div id="mean-variance-portfolio" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Mean-variance portfolio<a href="r-for-finance.html#mean-variance-portfolio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start this section by giving a simple example. Consider two stocks A and B with corresponding returns <span class="math inline">\(R_A\)</span> and <span class="math inline">\(R_B\)</span> following the joint probability mass function below:</p>
<table>
<caption><span id="tab:abjoint">Table 3.1: </span>Joint density for <span class="math inline">\(R_{A}\)</span> and <span class="math inline">\(R_{B}\)</span></caption>
<thead>
<tr class="header">
<th align="left">State</th>
<th align="left"><span class="math inline">\(R_{A}\)</span></th>
<th align="left"><span class="math inline">\(R_{B}\)</span></th>
<th align="left">Probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Depression</td>
<td align="left"><span class="math inline">\(-20\%\)</span></td>
<td align="left"><span class="math inline">\(5\%\)</span></td>
<td align="left">0.25</td>
</tr>
<tr class="even">
<td align="left">Recession</td>
<td align="left"><span class="math inline">\(10\%\)</span></td>
<td align="left"><span class="math inline">\(20\%\)</span></td>
<td align="left">0.25</td>
</tr>
<tr class="odd">
<td align="left">Normal</td>
<td align="left"><span class="math inline">\(30\%\)</span></td>
<td align="left"><span class="math inline">\(-12\%\)</span></td>
<td align="left">0.25</td>
</tr>
<tr class="even">
<td align="left">Boom</td>
<td align="left"><span class="math inline">\(50\%\)</span></td>
<td align="left"><span class="math inline">\(9\%\)</span></td>
<td align="left">0.25</td>
</tr>
</tbody>
</table>
<p>Now, suppose that we want to construct a portfolio with a weight <span class="math inline">\(w_A\)</span> on stock A and <span class="math inline">\(w_B\)</span> on stock B, with <span class="math inline">\(w_A + w_B = 1\)</span>. Then, the return of the portfolio is
<span class="math display">\[
  R_p =w_A R_A +w_B R_B \,,
\]</span>
which is also a random variable. Then, the expected value and variance of <span class="math inline">\(R\)</span> are given by
<span class="math display">\[
\mathbb{E}[R_p] = w_A \mathbb{E}[R_A]+w_B \mathbb{E}[R_B] \,,
\]</span>
and
<span class="math display">\[
Var(R_p) = w_A^2 Var(R_A) + w_B^2 Var(R_B) + 2 w_A w_B Cov(R_A, R_B) \,,
\]</span>
respectively. Consider now <span class="math inline">\(w_A = 0.6\)</span>, then we can compute expected value and variance of the portfolio as follows. First, we compute the expected value and variance of A and B, and the covariance of A and B:</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb841-1"><a href="r-for-finance.html#cb841-1" aria-hidden="true" tabindex="-1"></a>rA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>)</span>
<span id="cb841-2"><a href="r-for-finance.html#cb841-2" aria-hidden="true" tabindex="-1"></a>rB <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="sc">-</span><span class="fl">0.12</span>, <span class="fl">0.09</span>)</span>
<span id="cb841-3"><a href="r-for-finance.html#cb841-3" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.25</span>, <span class="dv">4</span>)</span>
<span id="cb841-4"><a href="r-for-finance.html#cb841-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb841-5"><a href="r-for-finance.html#cb841-5" aria-hidden="true" tabindex="-1"></a>expA <span class="ot">&lt;-</span> <span class="fu">sum</span>(rA <span class="sc">*</span> prob)</span>
<span id="cb841-6"><a href="r-for-finance.html#cb841-6" aria-hidden="true" tabindex="-1"></a>expA</span></code></pre></div>
<pre><code>## [1] 0.175</code></pre>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb843-1"><a href="r-for-finance.html#cb843-1" aria-hidden="true" tabindex="-1"></a>expB <span class="ot">&lt;-</span> <span class="fu">sum</span>(rB <span class="sc">*</span> prob)</span>
<span id="cb843-2"><a href="r-for-finance.html#cb843-2" aria-hidden="true" tabindex="-1"></a>expB</span></code></pre></div>
<pre><code>## [1] 0.055</code></pre>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb845-1"><a href="r-for-finance.html#cb845-1" aria-hidden="true" tabindex="-1"></a>varA <span class="ot">&lt;-</span> <span class="fu">sum</span>(rA<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> prob) <span class="sc">-</span> expA<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb845-2"><a href="r-for-finance.html#cb845-2" aria-hidden="true" tabindex="-1"></a>varA</span></code></pre></div>
<pre><code>## [1] 0.066875</code></pre>
<div class="sourceCode" id="cb847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb847-1"><a href="r-for-finance.html#cb847-1" aria-hidden="true" tabindex="-1"></a>varB <span class="ot">&lt;-</span> <span class="fu">sum</span>(rB<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> prob) <span class="sc">-</span> expB<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb847-2"><a href="r-for-finance.html#cb847-2" aria-hidden="true" tabindex="-1"></a>varB</span></code></pre></div>
<pre><code>## [1] 0.013225</code></pre>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="r-for-finance.html#cb849-1" aria-hidden="true" tabindex="-1"></a>covAB <span class="ot">&lt;-</span> <span class="fu">sum</span>(rA <span class="sc">*</span> rB <span class="sc">*</span> prob) <span class="sc">-</span> expA <span class="sc">*</span> expB</span>
<span id="cb849-2"><a href="r-for-finance.html#cb849-2" aria-hidden="true" tabindex="-1"></a>covAB</span></code></pre></div>
<pre><code>## [1] -0.004875</code></pre>
<p>With the above quantities above at hand, we can now compute the expected return and variance of our portfolio:</p>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="r-for-finance.html#cb851-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.4</span>)</span>
<span id="cb851-2"><a href="r-for-finance.html#cb851-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb851-3"><a href="r-for-finance.html#cb851-3" aria-hidden="true" tabindex="-1"></a>exp_por <span class="ot">&lt;-</span> <span class="fu">sum</span>(w <span class="sc">*</span> <span class="fu">c</span>(expA, expB))</span>
<span id="cb851-4"><a href="r-for-finance.html#cb851-4" aria-hidden="true" tabindex="-1"></a>exp_por</span></code></pre></div>
<pre><code>## [1] 0.127</code></pre>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="r-for-finance.html#cb853-1" aria-hidden="true" tabindex="-1"></a>var_por <span class="ot">&lt;-</span> varA <span class="sc">*</span> w[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> varB <span class="sc">*</span> w[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> covAB <span class="sc">*</span> w[<span class="dv">1</span>] <span class="sc">*</span> w[<span class="dv">2</span>]</span>
<span id="cb853-2"><a href="r-for-finance.html#cb853-2" aria-hidden="true" tabindex="-1"></a>var_por</span></code></pre></div>
<pre><code>## [1] 0.023851</code></pre>
<p>Moreover, the standard deviation is given by</p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="r-for-finance.html#cb855-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(var_por)</span></code></pre></div>
<pre><code>## [1] 0.1544377</code></pre>
<p>On the other hand, note that the weighted average of the standard deviations of <span class="math inline">\(R_A\)</span> and <span class="math inline">\(R_B\)</span> is</p>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="r-for-finance.html#cb857-1" aria-hidden="true" tabindex="-1"></a>w[<span class="dv">1</span>] <span class="sc">*</span> <span class="fu">sqrt</span>(varA) <span class="sc">+</span> w[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">sqrt</span>(varB)</span></code></pre></div>
<pre><code>## [1] 0.2011612</code></pre>
<p>which is greater than the standard deviation of the portfolio. This is known as the <em>diversification effect</em>.</p>
<p><strong>Diversification Effect</strong>: The standard deviation of the portfolio is less than or equal to the weighted average of the standard deviations of the individual securities. Equality holds only if the correlation of the assets is 1.</p>
<p>So far, we have treated <span class="math inline">\(w_A\)</span> and <span class="math inline">\(w_B\)</span> as fixed constants. However, if <span class="math inline">\(w_A\)</span> and <span class="math inline">\(w_B\)</span> change in a way such that <span class="math inline">\(w_A + w_B = 1\)</span>, then <span class="math inline">\(\mathbb{E}[R_p]\)</span> and <span class="math inline">\(SD(R_p)\)</span> also change. This leads to the following definition of <em>opportunity set</em>.</p>
<div class="definition">
<p><span id="def:unlabeled-div-45" class="definition"><strong>Definition 3.1  (Opportunity set) </strong></span>The possible pairs of <span class="math inline">\(\mathbb{E}[R_p]\)</span> and <span class="math inline">\(SD(R_p)\)</span> that can be formed by varying <span class="math inline">\(w_A\)</span> (and hence <span class="math inline">\(w_B\)</span>) is called the <em>opportunity set</em> or <em>feasible set</em>.</p>
</div>
<div class="remark">
<p><span id="unlabeled-div-46" class="remark"><em>Remark</em>. </span>Note that in the definition above, we allow <span class="math inline">\(w_A &lt; 0\)</span> (this means we can borrow A) and <span class="math inline">\(w_A &gt; 1\)</span> (this means <span class="math inline">\(w_B\)</span> can be negative, and hence we can borrow B). However, it is common practice to restrict <span class="math inline">\(w_A\)</span> to <span class="math inline">\([0, 1]\)</span>.</p>
</div>
<p>We now want to picture the shape of the opportunity set for stocks A and B.
For computational purposes, it is convenient to write the expressions of <span class="math inline">\(\mathbb{E}[R_p]\)</span> and <span class="math inline">\(Var(R_p)\)</span> in terms of matrices operations (remember, R is quite efficient doing these types of operations). Thus, we first need to introduce further notation. Let <span class="math inline">\(\mathbf{R} = (R_A, R_B)\)</span> and <span class="math inline">\(\mathbf{w} = (w_A, w_B)\)</span>, then
<span class="math display">\[
\mathbb{E}[R_p] = \mathbb{E}[\mathbf{R}] \mathbf{w}^{\top} \,,
\]</span>
and
<span class="math display">\[
Var(R_p) =\mathbf{w} Var(\mathbf{R}) \mathbf{w}^{\top} \,,
\]</span>
where <span class="math inline">\(\mathbb{E}[\mathbf{R}]\)</span> is the mean vector of <span class="math inline">\(\mathbf{R}\)</span>, i.e., <span class="math inline">\(\mathbb{E}[\mathbf{R}] = (\mathbb{E}[R_A], \mathbb{E}[R_B])\)</span>, and <span class="math inline">\(Var(\mathbf{R})\)</span> is the covariance matrix of <span class="math inline">\(\mathbf{R}\)</span>, that is,
<span class="math display">\[
Var(\mathbf{R}) = \left( \begin{matrix}
  Var(R_A) &amp; Cov(R_A, R_B) \\
  Cov(R_A, R_B) &amp; Var(R_B)
\end{matrix}\right)
\,.
\]</span>
The following code plots the opportunity set for the stocks A and B described in Table <a href="r-for-finance.html#tab:abjoint">3.1</a>.</p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="r-for-finance.html#cb859-1" aria-hidden="true" tabindex="-1"></a>wa <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb859-2"><a href="r-for-finance.html#cb859-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">cbind</span>(wa, <span class="dv">1</span> <span class="sc">-</span> wa)</span>
<span id="cb859-3"><a href="r-for-finance.html#cb859-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-4"><a href="r-for-finance.html#cb859-4" aria-hidden="true" tabindex="-1"></a>exp_p <span class="ot">&lt;-</span> w <span class="sc">%*%</span> <span class="fu">c</span>(expA, expB)</span>
<span id="cb859-5"><a href="r-for-finance.html#cb859-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-6"><a href="r-for-finance.html#cb859-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(varA, covAB, covAB, varB), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb859-7"><a href="r-for-finance.html#cb859-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-8"><a href="r-for-finance.html#cb859-8" aria-hidden="true" tabindex="-1"></a>sd_portfolio <span class="ot">&lt;-</span> <span class="cf">function</span>(sigma, w) {</span>
<span id="cb859-9"><a href="r-for-finance.html#cb859-9" aria-hidden="true" tabindex="-1"></a>  sg <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(w))</span>
<span id="cb859-10"><a href="r-for-finance.html#cb859-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(w)) {</span>
<span id="cb859-11"><a href="r-for-finance.html#cb859-11" aria-hidden="true" tabindex="-1"></a>    sg[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(w[i, ]) <span class="sc">%*%</span> sigma <span class="sc">%*%</span> (w[i, ]))</span>
<span id="cb859-12"><a href="r-for-finance.html#cb859-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb859-13"><a href="r-for-finance.html#cb859-13" aria-hidden="true" tabindex="-1"></a>  sg</span>
<span id="cb859-14"><a href="r-for-finance.html#cb859-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb859-15"><a href="r-for-finance.html#cb859-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb859-16"><a href="r-for-finance.html#cb859-16" aria-hidden="true" tabindex="-1"></a>sd_p <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma, w)</span>
<span id="cb859-17"><a href="r-for-finance.html#cb859-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p, exp_p,</span>
<span id="cb859-18"><a href="r-for-finance.html#cb859-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb859-19"><a href="r-for-finance.html#cb859-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Opportunity set&quot;</span>,</span>
<span id="cb859-20"><a href="r-for-finance.html#cb859-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(Rp)&quot;</span>,</span>
<span id="cb859-21"><a href="r-for-finance.html#cb859-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(Rp)&quot;</span></span>
<span id="cb859-22"><a href="r-for-finance.html#cb859-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-347-1.png" width="672" /></p>
<p>In the picture above, we can observe that there is a point on the opportunity set such that <span class="math inline">\(SD(R_p)\)</span> is a minimum. This point corresponds to a portfolio that can be formed from mixing the assets and is known as the <strong>minimum variance portfolio</strong> (MV). In R, we can find the weights of such a portfolio as follows:</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="r-for-finance.html#cb860-1" aria-hidden="true" tabindex="-1"></a>wmin <span class="ot">&lt;-</span> w[<span class="fu">match</span>(<span class="fu">min</span>(sd_p), sd_p), ]</span>
<span id="cb860-2"><a href="r-for-finance.html#cb860-2" aria-hidden="true" tabindex="-1"></a>wmin</span></code></pre></div>
<pre><code>##  wa     
## 0.2 0.8</code></pre>
<p>The corresponding expected return and standard deviation of the minimum variance portfolio are then</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="r-for-finance.html#cb862-1" aria-hidden="true" tabindex="-1"></a>exp_mv <span class="ot">&lt;-</span> wmin <span class="sc">%*%</span> <span class="fu">c</span>(expA, expB)</span>
<span id="cb862-2"><a href="r-for-finance.html#cb862-2" aria-hidden="true" tabindex="-1"></a>exp_mv</span></code></pre></div>
<pre><code>##       [,1]
## [1,] 0.079</code></pre>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="r-for-finance.html#cb864-1" aria-hidden="true" tabindex="-1"></a>sd_mv <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma, <span class="fu">matrix</span>(wmin, <span class="dv">1</span>))</span>
<span id="cb864-2"><a href="r-for-finance.html#cb864-2" aria-hidden="true" tabindex="-1"></a>sd_mv</span></code></pre></div>
<pre><code>## [1] 0.09787237</code></pre>
<p>Suppose now that we want to create a portfolio by mixing assets such that the standard
deviation of the resulting portfolio is greater than the minimum standard deviation that can be achieved. For instance, the figure below shows that we have two options to pick a portfolio with a standard deviation of <span class="math inline">\(0.11\)</span>.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-350-1.png" width="672" /></p>
<p>Among these two portfolios, for sure, we would like to pick the one with higher <span class="math inline">\(\mathbb{E}(R_p)\)</span>, meaning the portfolio above the point MV. More generally, we can conclude that the part of the opportunity set below the point MV would never be selected. The opportunity set above the point MV is called the <strong>efficient frontier</strong>. The following plot shows the MV point and the efficient frontier for our example.</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="r-for-finance.html#cb866-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Efficient frontier</span></span>
<span id="cb866-2"><a href="r-for-finance.html#cb866-2" aria-hidden="true" tabindex="-1"></a>exp_ef <span class="ot">&lt;-</span> exp_p[exp_p <span class="sc">&gt;</span> <span class="fu">as.vector</span>(exp_mv)]</span>
<span id="cb866-3"><a href="r-for-finance.html#cb866-3" aria-hidden="true" tabindex="-1"></a>sd_ef <span class="ot">&lt;-</span> sd_p[exp_p <span class="sc">&gt;</span> <span class="fu">as.vector</span>(exp_mv)]</span>
<span id="cb866-4"><a href="r-for-finance.html#cb866-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb866-5"><a href="r-for-finance.html#cb866-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p, exp_p,</span>
<span id="cb866-6"><a href="r-for-finance.html#cb866-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb866-7"><a href="r-for-finance.html#cb866-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Opportunity set&quot;</span>,</span>
<span id="cb866-8"><a href="r-for-finance.html#cb866-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(Rp)&quot;</span>,</span>
<span id="cb866-9"><a href="r-for-finance.html#cb866-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(Rp)&quot;</span></span>
<span id="cb866-10"><a href="r-for-finance.html#cb866-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb866-11"><a href="r-for-finance.html#cb866-11" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sd_mv, exp_mv, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>) <span class="co"># MV</span></span>
<span id="cb866-12"><a href="r-for-finance.html#cb866-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sd_ef, exp_ef, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>) <span class="co"># Efficient frontier</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-351-1.png" width="672" /></p>
<p>Next, we want to illustrate how the shape of the opportunity changes according to the correlation of the risky assets. For that purpose, let us consider two stocks A and B with the following characteristic: <span class="math inline">\(\mathbb{E}[R_A] = 10\%\)</span>, <span class="math inline">\(\mathbb{E}[R_B] = 15\%\)</span>, <span class="math inline">\(SD(R_A) = 10\%\)</span>, and <span class="math inline">\(SD(R_B) = 12\%\)</span>. We also assume five different possibilities for the correlation between A and B: -1, -0.5, 0, 0.5, and 1.</p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb867-1"><a href="r-for-finance.html#cb867-1" aria-hidden="true" tabindex="-1"></a>wa <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb867-2"><a href="r-for-finance.html#cb867-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">cbind</span>(wa, <span class="dv">1</span> <span class="sc">-</span> wa)</span>
<span id="cb867-3"><a href="r-for-finance.html#cb867-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-4"><a href="r-for-finance.html#cb867-4" aria-hidden="true" tabindex="-1"></a>exp_p <span class="ot">&lt;-</span> w <span class="sc">%*%</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.15</span>)</span>
<span id="cb867-5"><a href="r-for-finance.html#cb867-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-6"><a href="r-for-finance.html#cb867-6" aria-hidden="true" tabindex="-1"></a>sd_A <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb867-7"><a href="r-for-finance.html#cb867-7" aria-hidden="true" tabindex="-1"></a>sd_B <span class="ot">&lt;-</span> <span class="fl">0.12</span></span>
<span id="cb867-8"><a href="r-for-finance.html#cb867-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-9"><a href="r-for-finance.html#cb867-9" aria-hidden="true" tabindex="-1"></a>sigma1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sd_A<span class="sc">^</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, sd_B<span class="sc">^</span><span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb867-10"><a href="r-for-finance.html#cb867-10" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sd_A<span class="sc">^</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, sd_B<span class="sc">^</span><span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb867-11"><a href="r-for-finance.html#cb867-11" aria-hidden="true" tabindex="-1"></a>sigma3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sd_A<span class="sc">^</span><span class="dv">2</span>, <span class="dv">0</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, <span class="dv">0</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, sd_B<span class="sc">^</span><span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb867-12"><a href="r-for-finance.html#cb867-12" aria-hidden="true" tabindex="-1"></a>sigma4 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sd_A<span class="sc">^</span><span class="dv">2</span>, <span class="fl">0.5</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, <span class="fl">0.5</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, sd_B<span class="sc">^</span><span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb867-13"><a href="r-for-finance.html#cb867-13" aria-hidden="true" tabindex="-1"></a>sigma5 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sd_A<span class="sc">^</span><span class="dv">2</span>, <span class="dv">1</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, <span class="dv">1</span> <span class="sc">*</span> sd_A <span class="sc">*</span> sd_B, sd_B<span class="sc">^</span><span class="dv">2</span>), <span class="dv">2</span>)</span>
<span id="cb867-14"><a href="r-for-finance.html#cb867-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-15"><a href="r-for-finance.html#cb867-15" aria-hidden="true" tabindex="-1"></a>sd_p1 <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma1, w)</span>
<span id="cb867-16"><a href="r-for-finance.html#cb867-16" aria-hidden="true" tabindex="-1"></a>sd_p2 <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma2, w)</span>
<span id="cb867-17"><a href="r-for-finance.html#cb867-17" aria-hidden="true" tabindex="-1"></a>sd_p3 <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma3, w)</span>
<span id="cb867-18"><a href="r-for-finance.html#cb867-18" aria-hidden="true" tabindex="-1"></a>sd_p4 <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma4, w)</span>
<span id="cb867-19"><a href="r-for-finance.html#cb867-19" aria-hidden="true" tabindex="-1"></a>sd_p5 <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma5, w)</span>
<span id="cb867-20"><a href="r-for-finance.html#cb867-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb867-21"><a href="r-for-finance.html#cb867-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p1, exp_p,</span>
<span id="cb867-22"><a href="r-for-finance.html#cb867-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb867-23"><a href="r-for-finance.html#cb867-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Opportunity set&quot;</span>,</span>
<span id="cb867-24"><a href="r-for-finance.html#cb867-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(Rp)&quot;</span>,</span>
<span id="cb867-25"><a href="r-for-finance.html#cb867-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(Rp)&quot;</span></span>
<span id="cb867-26"><a href="r-for-finance.html#cb867-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb867-27"><a href="r-for-finance.html#cb867-27" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sd_p2, exp_p, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb867-28"><a href="r-for-finance.html#cb867-28" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sd_p3, exp_p, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb867-29"><a href="r-for-finance.html#cb867-29" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sd_p4, exp_p, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb867-30"><a href="r-for-finance.html#cb867-30" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sd_p5, exp_p, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb867-31"><a href="r-for-finance.html#cb867-31" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb867-32"><a href="r-for-finance.html#cb867-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg =</span> <span class="fu">paste</span>(<span class="st">&quot;rho =&quot;</span>, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)),</span>
<span id="cb867-33"><a href="r-for-finance.html#cb867-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty =</span> <span class="dv">1</span>,</span>
<span id="cb867-34"><a href="r-for-finance.html#cb867-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;orange&quot;</span>)</span>
<span id="cb867-35"><a href="r-for-finance.html#cb867-35" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-352-1.png" width="672" /></p>
<p>The straight line (orange) corresponds to <span class="math inline">\(\rho = 1\)</span>, representing points that would have been generated if the two assets were perfectly positively correlated. When <span class="math inline">\(\rho \neq 1\)</span>, we see that the resulting opportunity set is always to the left of the straight line and hence the standard deviation of these portfolios is less than the ones of the case when <span class="math inline">\(\rho = 1\)</span> for the same values of <span class="math inline">\(\mathbb{E}[R_p]\)</span>. This illustrates the diversification effect. Since the curve bends towards the left more significantly as <span class="math inline">\(\rho\)</span> decreases, the impact of diversification increases with decreasing <span class="math inline">\(\rho\)</span>. Furthermore, in the particular case of negative correlations, we can think of this effect as one asset works as a safety net (or hedge) for the plunge in the price of another asset.</p>
<div id="multiple-risky-assets" class="section level4 unnumbered hasAnchor">
<h4>Multiple risky assets<a href="r-for-finance.html#multiple-risky-assets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We now introduce the more general setting with <span class="math inline">\(n\)</span> stocks in a portfolio. More specifically, suppose that we have <span class="math inline">\(n\)</span> risky assets with random returns <span class="math inline">\(R_1, R_2, \dots, R_n\)</span>. Then, if we construct a portfolio with portfolio weights <span class="math inline">\(w_1, w_2, \dots, w_n\)</span>, where <span class="math inline">\(w_1 + w_2 + \cdots + w_n= 1\)</span>, the portfolio return <span class="math inline">\(R_p\)</span> is given by
<span class="math display">\[
R_p = w_1 R_1 + w_2 R_2 + \cdots + w_n R_n = \sum_{i = 1}^n w_i R_i \,.
\]</span>
Thus, the mean and variance of <span class="math inline">\(R_p\)</span> are then given by</p>
<p><span class="math display">\[
\mathbb{E}[R_p] = \sum_{i = 1}^n w_i \mathbb{E}[R_i] \,,
\]</span></p>
<p><span class="math display">\[
Var(R_p) = \sum_{i = 1}^n w_i^2 Var(R_i) + 2 \sum_{i &lt; j} w_i w_j Cov(R_i, R_j) \,.
\]</span></p>
<p>By letting <span class="math inline">\(\mathbf{R} = (R_1, R_2\dots, R_n)\)</span> and <span class="math inline">\(\mathbf{w} = (w_1, w_2, \dots, w_n)\)</span>, we can rewrite the expressions above in terms of matrices as
<span class="math display">\[
\mathbb{E}[R_p] = \mathbb{E}[\mathbf{R}] \mathbf{w}^{\top} \,,
\]</span>
and
<span class="math display">\[
Var(R_p) =\mathbf{w} Var(\mathbf{R}) \mathbf{w}^{\top} \,,
\]</span></p>
<p>where <span class="math inline">\(\mathbb{E}[\mathbf{R}]\)</span> and <span class="math inline">\(Var(\mathbf{R})\)</span> are the mean vector and covariance matrix of <span class="math inline">\(\mathbf{R}\)</span>, receptively.</p>
<p>The following example shows how to construct the opportunity set when dealing with three risky assets.</p>
<div class="example">
<p><span id="exm:three" class="example"><strong>Example 3.1  </strong></span>Consider three stocks A, B and C with expected returns <span class="math inline">\(\mathbb{E}[R_A] = 0.105\)</span>, <span class="math inline">\(\mathbb{E}[R_B] = 0.18\)</span>, and <span class="math inline">\(\mathbb{E}[R_C] = 0.02\)</span>, respectively. The covariance matrix is the following:
<span class="math display">\[
Var(\mathbf{R})  = \left( \begin{matrix}
  0.15^2 &amp; -0.012 &amp; 0.002\\
  -0.012 &amp; 0.12^2 &amp; -0.002 \\
  0.002&amp; -0.002 &amp; 0.2^2
\end{matrix}\right)
\,.
\]</span>
Then, the following code plots the opportunity set available to any investor:</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="r-for-finance.html#cb868-1" aria-hidden="true" tabindex="-1"></a>exp_r <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.105</span>, <span class="fl">0.18</span>, <span class="fl">0.02</span>)</span>
<span id="cb868-2"><a href="r-for-finance.html#cb868-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb868-3"><a href="r-for-finance.html#cb868-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb868-4"><a href="r-for-finance.html#cb868-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.15</span><span class="sc">^</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.012</span>, <span class="fl">0.002</span>,</span>
<span id="cb868-5"><a href="r-for-finance.html#cb868-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.012</span>, <span class="fl">0.12</span><span class="sc">^</span><span class="dv">2</span>, <span class="sc">-</span><span class="fl">0.002</span>,</span>
<span id="cb868-6"><a href="r-for-finance.html#cb868-6" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.002</span>, <span class="sc">-</span><span class="fl">0.002</span>, <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb868-7"><a href="r-for-finance.html#cb868-7" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb868-8"><a href="r-for-finance.html#cb868-8" aria-hidden="true" tabindex="-1"></a><span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T</span>
<span id="cb868-9"><a href="r-for-finance.html#cb868-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb868-10"><a href="r-for-finance.html#cb868-10" aria-hidden="true" tabindex="-1"></a>sigma</span></code></pre></div>
<pre><code>##         [,1]    [,2]   [,3]
## [1,]  0.0225 -0.0120  0.002
## [2,] -0.0120  0.0144 -0.002
## [3,]  0.0020 -0.0020  0.040</code></pre>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="r-for-finance.html#cb870-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generates a grid of values for w1 and w2</span></span>
<span id="cb870-2"><a href="r-for-finance.html#cb870-2" aria-hidden="true" tabindex="-1"></a>w_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb870-3"><a href="r-for-finance.html#cb870-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wa =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb870-4"><a href="r-for-finance.html#cb870-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">wb =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb870-5"><a href="r-for-finance.html#cb870-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb870-6"><a href="r-for-finance.html#cb870-6" aria-hidden="true" tabindex="-1"></a>w_grid <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(w_grid)</span>
<span id="cb870-7"><a href="r-for-finance.html#cb870-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-8"><a href="r-for-finance.html#cb870-8" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">cbind</span>(w_grid, <span class="dv">1</span> <span class="sc">-</span> w_grid[, <span class="dv">1</span>] <span class="sc">-</span> w_grid[, <span class="dv">2</span>])</span>
<span id="cb870-9"><a href="r-for-finance.html#cb870-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-10"><a href="r-for-finance.html#cb870-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected return</span></span>
<span id="cb870-11"><a href="r-for-finance.html#cb870-11" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(w <span class="sc">%*%</span> exp_r)</span>
<span id="cb870-12"><a href="r-for-finance.html#cb870-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-13"><a href="r-for-finance.html#cb870-13" aria-hidden="true" tabindex="-1"></a>sd_p <span class="ot">&lt;-</span> <span class="fu">sd_portfolio</span>(sigma, w)</span>
<span id="cb870-14"><a href="r-for-finance.html#cb870-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p, rp,</span>
<span id="cb870-15"><a href="r-for-finance.html#cb870-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb870-16"><a href="r-for-finance.html#cb870-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Opportunity set&quot;</span>,</span>
<span id="cb870-17"><a href="r-for-finance.html#cb870-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(Rp)&quot;</span>,</span>
<span id="cb870-18"><a href="r-for-finance.html#cb870-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(Rp)&quot;</span></span>
<span id="cb870-19"><a href="r-for-finance.html#cb870-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-353-1.png" width="672" />
Note that we have several portfolios that lead to the same expected return but with different volatilities. This leads us to the idea of the <em>minimum variance frontier</em> which is the curve consisting of the smallest volatility for the same return. Thus, an investor will choose a portfolio corresponding to the upper-half side of the minimum variance frontier. Such an upper-half side of the minimum variance frontier is the <em>efficient frontier</em> described before.</p>
</div>
<p>To give an understanding of the effect of diversification in the case of <span class="math inline">\(n\)</span> risky assets, we assume for the moment the following:</p>
<ol style="list-style-type: lower-alpha">
<li>All securities have the same variance, i.e., <span class="math inline">\(Var(R_1) =\cdots = Var(R_n) = \mbox{var}\)</span>.</li>
<li>The same covariance for every pair of securities is the same, i.e., <span class="math inline">\(Cov(R_i, R_j) = \mbox{cov}\)</span> for all <span class="math inline">\(i \neq j\)</span>.</li>
<li>We have an equally weighted portfolio, i.e., <span class="math inline">\(w_1 =\cdots = w_n = 1/ n\)</span>.</li>
</ol>
<p>Under the above assumptions, it is easy to see that
<span class="math display">\[
Var(R_p) = \frac{1}{n}(\mbox{var} - \mbox{cov}) + \mbox{cov} \,,
\]</span>
In particular, we have that <span class="math inline">\(Var(R_p) \to \mbox{cov}\)</span> as <span class="math inline">\(n \to \infty\)</span>.</p>
<p>The essence of the equation above can be summarized into two main points:</p>
<ol style="list-style-type: decimal">
<li>When <span class="math inline">\(n\)</span> increases, <span class="math inline">\(Var(R_p)\)</span> decreases, and hence the diversification effect increases with <span class="math inline">\(n\)</span>.</li>
<li>Even if <span class="math inline">\(n\)</span> tends to infinity, <span class="math inline">\(Var(R_p)\)</span> does not drop to zero. There is a limit to the diversification effect: A diversified portfolio can eliminate some, but not all, of the risk of the individual securities.</li>
</ol>
<p>This leads us to the following definition of systematic and unsystematic risk.</p>
<div class="definition">
<p><span id="def:unlabeled-div-47" class="definition"><strong>Definition 3.2  </strong></span><span class="math inline">\(\,\)</span></p>
<ul>
<li><p><strong>Systematic risk</strong> (or market risk or non-diversifiable risk) is the portion of an assets risk that cannot be eliminated through diversification. Interest rates, recessions, and catastrophes are examples of systematic risks.</p></li>
<li><p><strong>Unsystematic risk</strong> (or specific risk or diversifiable risk) is the portion of an assets risk that can be eliminated by including the security as part of a well-diversified portfolio. It represents the component of a stocks return that is not correlated with general market moves.</p></li>
</ul>
</div>
</div>
</div>
<div id="capital-asset-pricing-model-capm" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Capital Asset Pricing Model (CAPM)<a href="r-for-finance.html#capital-asset-pricing-model-capm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Previously we have been dealing with portfolios consisting of two or more risky assets. Let us now incorporate a risk-free security into our analysis. More specifically, let <span class="math inline">\(R_p\)</span> be the return on a risky portfolio (a portfolio constituted of risky assets) and let <span class="math inline">\(R_f\)</span> be the risk-free interest rate (i.e., the return of a risk-free asset). Next, consider a (complete) portfolio consisting of <span class="math inline">\(w_p\)</span> parts of the risky portfolio and <span class="math inline">\(w_f\)</span> parts of the risk-free asset, <span class="math inline">\(w_p + w_f = 1\)</span>. Then, the return <span class="math inline">\(R\)</span> of this portfolio is given by
<span class="math display">\[
R = w_p R_p + w_fR_f = w_p R_p  + (1 - w_p)R_f \,.
\]</span></p>
<p>Taking the expectation in the expression above, we have
<span class="math display">\[\begin{align*}
\mathbb{E}[R] &amp;= w_p \mathbb{E}[R_p] + (1 - w_p)R_f \\
&amp; = w_p (\mathbb{E}[R_p] - R_f) + R_f\,.
\end{align*}\]</span>
On the other hand, the variance of <span class="math inline">\(R\)</span> is given by
<span class="math display">\[\begin{align*}
Var(R) = w_p^2 Var(R_p)\,,
\end{align*}\]</span>
which implies that the standard deviation of <span class="math inline">\(R\)</span> is
<span class="math display">\[\begin{align*}
SD(R) = w_p SD(R_p)\,.
\end{align*}\]</span>
This last equation implies that
<span class="math display">\[\begin{align*}
w_p = \frac{SD(R)}{SD(R_p)} \,.
\end{align*}\]</span></p>
<p>Thus, we obtain the following expression for the opportunity set of this portfolio
<span class="math display">\[
\mathbb{E}[R] = R_f + \frac{(\mathbb{E}[R_p] - R_f)}{SD(R_p)}SD(R)\,,
\]</span>
which corresponds to a straight line with intercept <span class="math inline">\(R_f\)</span> and slope
<span class="math display">\[
\frac{(\mathbb{E}[R_p] - R_f)}{SD(R_p)} \,.
\]</span>
The latter is also known as the <em>Sharpe ratio</em>.</p>
<p>For example, let us come back to Example <a href="r-for-finance.html#exm:three">3.1</a> and take a couple of portfolios there. If the risk-free interest rate is <span class="math inline">\(12\%\)</span>, we obtain the following picture</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="r-for-finance.html#cb871-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fl">0.12</span> <span class="co"># Risk-free rate</span></span>
<span id="cb871-2"><a href="r-for-finance.html#cb871-2" aria-hidden="true" tabindex="-1"></a>slope1 <span class="ot">&lt;-</span> (rp[<span class="dv">50</span>] <span class="sc">-</span> rf) <span class="sc">/</span> sd_p[<span class="dv">50</span>]</span>
<span id="cb871-3"><a href="r-for-finance.html#cb871-3" aria-hidden="true" tabindex="-1"></a>slope2 <span class="ot">&lt;-</span> (rp[<span class="dv">2500</span>] <span class="sc">-</span> rf) <span class="sc">/</span> sd_p[<span class="dv">2500</span>]</span>
<span id="cb871-4"><a href="r-for-finance.html#cb871-4" aria-hidden="true" tabindex="-1"></a>slope3 <span class="ot">&lt;-</span> (rp[<span class="dv">7500</span>] <span class="sc">-</span> rf) <span class="sc">/</span> sd_p[<span class="dv">7500</span>]</span>
<span id="cb871-5"><a href="r-for-finance.html#cb871-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb871-6"><a href="r-for-finance.html#cb871-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p, rp,</span>
<span id="cb871-7"><a href="r-for-finance.html#cb871-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb871-8"><a href="r-for-finance.html#cb871-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(R)&quot;</span>,</span>
<span id="cb871-9"><a href="r-for-finance.html#cb871-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(R)&quot;</span>,</span>
<span id="cb871-10"><a href="r-for-finance.html#cb871-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.23</span>)</span>
<span id="cb871-11"><a href="r-for-finance.html#cb871-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb871-12"><a href="r-for-finance.html#cb871-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, slope1 <span class="sc">*</span> x <span class="sc">+</span> rf)</span>
<span id="cb871-13"><a href="r-for-finance.html#cb871-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, slope2 <span class="sc">*</span> x <span class="sc">+</span> rf)</span>
<span id="cb871-14"><a href="r-for-finance.html#cb871-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, slope3 <span class="sc">*</span> x <span class="sc">+</span> rf)</span>
<span id="cb871-15"><a href="r-for-finance.html#cb871-15" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sd_p[<span class="dv">50</span>], rp[<span class="dv">50</span>], <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb871-16"><a href="r-for-finance.html#cb871-16" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sd_p[<span class="dv">2500</span>], rp[<span class="dv">2500</span>], <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span>
<span id="cb871-17"><a href="r-for-finance.html#cb871-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sd_p[<span class="dv">7500</span>], rp[<span class="dv">7500</span>], <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-354-1.png" width="672" /></p>
<p>Since every risky portfolio above can be used to combine with the risk-free security, the opportunity set of market securities is the region between the two lines picture below:</p>
<p><img src="_main_files/figure-html/unnamed-chunk-355-1.png" width="672" /></p>
<p>The efficient frontier that is formed from all securities is the straight line that:</p>
<ol style="list-style-type: decimal">
<li>passes through the risk-free rate, and</li>
<li>is tangential to the efficient frontier formed solely from risky securities.</li>
</ol>
<p>The efficient frontier described above is known as the <strong>capital market line</strong> (CML).</p>
<p>Every rational investor would pick a portfolio on the CML. Of course, the exact point they will pick depends on the investors risk preference. However, notice that every point on the CML is formed by mixing the risk-free security with the portfolio market denoted by a red dot in the above picture, the portfolio with the highest Sharpe ratio. This portfolio is known as the <strong>optimal risky portfolio</strong> or <strong>market portfolio</strong>.</p>
<p>The CML and market portfolio in the figure above were generated using the following code:</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="r-for-finance.html#cb872-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fl">0.12</span> <span class="co"># Risk-free rate</span></span>
<span id="cb872-2"><a href="r-for-finance.html#cb872-2" aria-hidden="true" tabindex="-1"></a>amax <span class="ot">&lt;-</span> <span class="fu">max</span>((rp <span class="sc">-</span> rf) <span class="sc">/</span> sd_p) <span class="co"># Slope of the CML</span></span>
<span id="cb872-3"><a href="r-for-finance.html#cb872-3" aria-hidden="true" tabindex="-1"></a>orp <span class="ot">&lt;-</span> <span class="fu">match</span>(amax, (rp <span class="sc">-</span> rf) <span class="sc">/</span> sd_p) <span class="co"># Optimal risky portfolio</span></span>
<span id="cb872-4"><a href="r-for-finance.html#cb872-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.01</span>)</span>
<span id="cb872-5"><a href="r-for-finance.html#cb872-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sd_p, rp,</span>
<span id="cb872-6"><a href="r-for-finance.html#cb872-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb872-7"><a href="r-for-finance.html#cb872-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;SD(R)&quot;</span>,</span>
<span id="cb872-8"><a href="r-for-finance.html#cb872-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;E(R)&quot;</span>,</span>
<span id="cb872-9"><a href="r-for-finance.html#cb872-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.23</span>)</span>
<span id="cb872-10"><a href="r-for-finance.html#cb872-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb872-11"><a href="r-for-finance.html#cb872-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, amax <span class="sc">*</span> x <span class="sc">+</span> rf)</span>
<span id="cb872-12"><a href="r-for-finance.html#cb872-12" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(sd_p[orp], rp[orp], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<p>Moreover, we can find the weights of the market portfolio easily by typing</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="r-for-finance.html#cb873-1" aria-hidden="true" tabindex="-1"></a>w[orp, ]</span></code></pre></div>
<pre><code>##         wa         wb            
##  0.4242424  0.9191919 -0.3434343</code></pre>
<p>Note that in the above, we generated a series of values for the weights of the risky portfolio, then computed the mean and standard deviation, and extracted from this set of values the market portfolio. However, the weights of the market portfolio can be computed algebraically by using the following result:</p>
<div class="proposition">
<p><span id="prp:unlabeled-div-48" class="proposition"><strong>Proposition 3.1  </strong></span>Suppose that we have <span class="math inline">\(n\)</span> risky assets, and that the market portfolio <span class="math inline">\(R_M\)</span> has weights <span class="math inline">\(w_i^M\)</span>, <span class="math inline">\(i = 1,\dots, n\)</span>. Then, for some constant <span class="math inline">\(c\)</span>,
<span class="math display">\[
\frac{\mathbb{E}[R_i] - R_f}{Cov(R_i, R_M)} = c\,, \quad i =1, \dots, n\,,
\]</span>
with <span class="math inline">\(Cov(R_i, R_M) = \sum_{k = 1}^n w_k^M Cov(R_i, R_k)\)</span>.</p>
</div>
<p>The result suggests that to derive the weights of the market portfolio, we can proceed as follows:</p>
<ol style="list-style-type: decimal">
<li>Find weights (they do not need to sum to 1) that make <span class="math inline">\(\mathbb{E}[R_i] - R_f= Cov(R_i, R_M)\)</span> hold for all <span class="math inline">\(i = 1, \dots, n\)</span>.</li>
<li>Rescale the weights to sum to 1.</li>
</ol>
<p>Note that this require us to solve a system of linear equation, which can be easily done in R by using <code>solve()</code>. For our particular example, we have</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="r-for-finance.html#cb875-1" aria-hidden="true" tabindex="-1"></a>unscaled_w <span class="ot">&lt;-</span> <span class="fu">solve</span>(sigma, exp_r <span class="sc">-</span> rf)</span>
<span id="cb875-2"><a href="r-for-finance.html#cb875-2" aria-hidden="true" tabindex="-1"></a>scaled_w <span class="ot">&lt;-</span> unscaled_w <span class="sc">/</span> <span class="fu">sum</span>(unscaled_w)</span>
<span id="cb875-3"><a href="r-for-finance.html#cb875-3" aria-hidden="true" tabindex="-1"></a>scaled_w</span></code></pre></div>
<pre><code>## [1]  0.4234973  0.9215102 -0.3450075</code></pre>
<p>Earlier in this section, we pointed out that the risk (or standard deviation) of a stock can be broken down into systematic and unsystematic risks. More specifically, we saw that the unsystematic risk can be diversified away in a large portfolio, but the systematic risk cannot. Thus, a diversified investor holding the market portfolio must worry about the systematic risk, but not the unsystematic risk, of every security in a portfolio. We now introduce the concept of <em>beta</em>, which gives a way to measure the systematic risk of a security. It turns out that beta is the best measure of the risk of an individual security from a diversified investors point of view.</p>
<p>The concept of beta can be better explained with a simple example. Let us assume that the following vectors represent the historical returns of the market portfolio (<code>r_m</code>) and a risky asset (<code>r_ra</code>)</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="r-for-finance.html#cb877-1" aria-hidden="true" tabindex="-1"></a>r_m <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb877-2"><a href="r-for-finance.html#cb877-2" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.000341</span>, <span class="fl">0.068962</span>, <span class="fl">0.046964</span>, <span class="fl">0.006922</span>,</span>
<span id="cb877-3"><a href="r-for-finance.html#cb877-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.029561</span>, <span class="fl">0.028035</span>, <span class="sc">-</span><span class="fl">0.027218</span>, <span class="sc">-</span><span class="fl">0.161576</span>,</span>
<span id="cb877-4"><a href="r-for-finance.html#cb877-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.060479</span>, <span class="fl">0.071397</span>, <span class="fl">0.058284</span></span>
<span id="cb877-5"><a href="r-for-finance.html#cb877-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb877-6"><a href="r-for-finance.html#cb877-6" aria-hidden="true" tabindex="-1"></a>r_ra <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb877-7"><a href="r-for-finance.html#cb877-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.050484</span>, <span class="fl">0.194222</span>, <span class="sc">-</span><span class="fl">0.021584</span>, <span class="sc">-</span><span class="fl">0.009475</span>,</span>
<span id="cb877-8"><a href="r-for-finance.html#cb877-8" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.070406</span>, <span class="sc">-</span><span class="fl">0.074354</span>, <span class="fl">0.078366</span>, <span class="sc">-</span><span class="fl">0.193192</span>,</span>
<span id="cb877-9"><a href="r-for-finance.html#cb877-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fl">0.059271</span>, <span class="fl">0.148521</span>, <span class="fl">0.11004</span></span>
<span id="cb877-10"><a href="r-for-finance.html#cb877-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>We now plot a graph of (<code>r_m</code>, <code>r_ra</code>) and draw a regression line that best fit the data</p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="r-for-finance.html#cb878-1" aria-hidden="true" tabindex="-1"></a>dat_beta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">r_m =</span> r_m, <span class="at">r_ra =</span> r_ra)</span>
<span id="cb878-2"><a href="r-for-finance.html#cb878-2" aria-hidden="true" tabindex="-1"></a>reg_line <span class="ot">&lt;-</span> <span class="fu">lm</span>(r_ra <span class="sc">~</span> r_m, <span class="at">data =</span> dat_beta)</span>
<span id="cb878-3"><a href="r-for-finance.html#cb878-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat_beta)</span>
<span id="cb878-4"><a href="r-for-finance.html#cb878-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(reg_line, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-360-1.png" width="672" />
The coefficients of this regression line are</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="r-for-finance.html#cb879-1" aria-hidden="true" tabindex="-1"></a>reg_line</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = r_ra ~ r_m, data = dat_beta)
## 
## Coefficients:
## (Intercept)          r_m  
##    0.005849     1.047370</code></pre>
<p>The slope of the regression is what is called the <strong>beta</strong> of the risky assets. The natural interpretation of beta is that the returns of the risky asset are magnified 1.047370 times over those of the market.</p>
<p>The actual definition of beta is:
<span class="math display">\[
\beta_i = \frac{Cov(R_i, R_M)}{\sigma^2(R_M)} \,,
\]</span>
where <span class="math inline">\(Cov(R_i, R_M)\)</span> is the covariance between the return on the <span class="math inline">\(i\)</span>th security and the return on the
market portfolio, and <span class="math inline">\(\sigma^2(R_M)\)</span> is the variance of the market.</p>
<p>In full generality, the beta of a security can be interpreted as follows: For a security with a beta greater than 1, its movement is an amplification of the movement of the market (as represented by the market portfolio). For a security with a beta between 0 and 1, its movements tend to be in the same direction as the market, but to a less extent. For negative values of beta, the security is expected to do against the market, meaning that it is expected to do well when the market does poorly and vice versa.</p>
<p>More generally, for any portfolio of <span class="math inline">\(n\)</span> risky assets, its beta <span class="math inline">\(\beta_p\)</span> can be computed as a weighted average of individual asset betas, that is,</p>
<p><span class="math display">\[
\beta_p = \frac{Cov(R_p, R_M)}{\sigma^2(R_M)} = \sum_{i = 1}^n w_i \beta_i \,.
\]</span>
From the definition, is clear that the beta of the market portfolio is 1.</p>
<p>We finish this section with the most important application of beta: the capital asset pricing model (CAPM).</p>
<p>The CAPM states that the expected return on a security with beta <span class="math inline">\(\beta\)</span> is
<span class="math display">\[
\mathbb{E}[R] = R_f + \beta(\overline{R}_M - R_f) \,,
\]</span>
where <span class="math inline">\(R_f\)</span> is the risk-free rate and <span class="math inline">\(\overline{R}_M\)</span> is the expected market return.</p>
<p>Keeping <span class="math inline">\(R_f\)</span> and <span class="math inline">\(R_M\)</span> fixed, we can plot a graph of <span class="math inline">\(\mathbb{E}[R]\)</span> versus <span class="math inline">\(\beta\)</span>. This line is know as the <strong>security market line</strong> (SML).</p>
</div>
</div>
<div id="the-binomial-model" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> The binomial model<a href="r-for-finance.html#the-binomial-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section introduces the binomial tree model and uses it to compute arbitrage-free prices for European-style options. Although the mathematical description of this model involves only simple algebra, it is a powerful tool to understand arbitrage pricing theory. The main idea of the binomial model is to break the time to maturity of an option into periods. Then, in each period, and given the underlying assets price at the beginning of the period, it assumes that the stock price will change to one of two possible values at the end of the period. Thus, we can then determine the value of the option recursively by starting at the maturity date, evaluating the options value under each possibility for the final prices of the stock, and then moving backward through the tree.</p>
<div id="one-period-binomial-model" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> One-period binomial model<a href="r-for-finance.html#one-period-binomial-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We start with the one-period version of the model. The model assumes that we have two assets: a risk-free asset (e.g., a treasury bond) and a stock. Here, we denote by <span class="math inline">\(B_t\)</span> and <span class="math inline">\(S_t\)</span> the bond and stock prices at time <span class="math inline">\(t\)</span>, respectively. Typically, time <span class="math inline">\(t = 0\)</span> represents the present time, and <span class="math inline">\(t = 1\)</span> denotes some future time.</p>
<p>Let us begin by describing the behavior of the stock prices. If at time <span class="math inline">\(t= 0\)</span> the price is <span class="math inline">\(S_0\)</span>, then the stock price at time <span class="math inline">\(t = 1\)</span>, <span class="math inline">\(S_1\)</span>, is given by the following random variable</p>
<span class="math display">\[
S_1 = \left\{ \begin{matrix}
  u S_0\,,  &amp; \text{with probability } p_u \,,\\
  d S_0 &amp; \text{with probability } p_d \,,
\end{matrix}\right.
\]</span>
where <span class="math inline">\(u\)</span>, <span class="math inline">\(d\)</span>, <span class="math inline">\(p_u\)</span>, and <span class="math inline">\(p_d\)</span> are positive positive constants satisfying <span class="math inline">\(d&lt;u\)</span>, and <span class="math inline">\(p_u+p_d =1\)</span>. Figure <a href="r-for-finance.html#fig:bintreeoneper">3.1</a> shows the development of the price of a stock under the above specification.
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bintreeoneper"></span>
<img src="figures/Bintreeoneper.jpg" alt="Stock prices in a one-period binomial tree." width="45%" />
<p class="caption">
Figure 3.1: Stock prices in a one-period binomial tree.
</p>
</div>
<p>It is often convenient to write instead
<span class="math display">\[
S_1 = S_0 Z \,,
\]</span>
where <span class="math inline">\(Z\)</span> is a random variable defined as
<span class="math display">\[
Z = \left\{ \begin{matrix}
  u \,,  &amp; \text{with probability } p_u \,,\\
  d \,,  &amp; \text{with probability } p_d \,.
\end{matrix}\right.
\]</span></p>
<p>On the other hand, the bond price is deterministic and given by
<span class="math display">\[\begin{align*}
&amp; B_0 = 1 \,, \\
&amp; B_1 = (1 + R) \,,
\end{align*}\]</span>
where R is the (risk-free) spot rate for the period.</p>
<div id="portfolios-and-arbitrage" class="section level4 unnumbered hasAnchor">
<h4>Portfolios and arbitrage<a href="r-for-finance.html#portfolios-and-arbitrage" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We will consider portfolios constituted of risky assets <span class="math inline">\(S\)</span> and bonds <span class="math inline">\(B\)</span>. More specifically, we will denote by <span class="math inline">\(x\)</span> the number of bonds we hold in our portfolio, <span class="math inline">\(y\)</span> the number of stock units held, and let <span class="math inline">\(h = (x,y)\)</span>. Consider now a fixed portfolio <span class="math inline">\(h = (x, y)\)</span>. Then, the value of the portfolio at time <span class="math inline">\(t\)</span>, <span class="math inline">\(V_{t}^h\)</span>, is given by
<span class="math display">\[
V_{t}^h = x B_t + y S_t \,.
\]</span>
Note that this portfolio has a deterministic value at <span class="math inline">\(t = 0\)</span> and a stochastic value at <span class="math inline">\(t = 1\)</span>.</p>
<p>We now introduce one of the central concepts of the theory in this section: arbitrage portfolio.</p>
<div class="definition">
<p><span id="def:unlabeled-div-49" class="definition"><strong>Definition 3.3  </strong></span>An <strong>arbitrage</strong> portfolio is a portfolio <span class="math inline">\(h\)</span> with the properties
<span class="math display">\[\begin{align*}
&amp;V_{0}^h = 0 \,,\\
&amp; V_{1}^h &gt;0 \quad \text{with probability } 1 \,.
\end{align*}\]</span></p>
</div>
<p>Essentially an arbitrage portfolio is a deterministic money-making machine. Hence, we can interpret the existence of an arbitrage portfolio as a severe case of mispricing on the market. Therefore, it is natural to investigate when a given market model is arbitrage-free.</p>
<p>It turns out that our binomial model above is free of arbitrage if and only if the following conditions hold:
<span class="math display">\[
d \leq (1 + R) \leq u \,.
\]</span>
Moreover, the above condition is equivalent to saying that <span class="math inline">\(1 + R\)</span> is a convex combination of <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span>, i.e.,
<span class="math display">\[
1 + R = u q_u + d q_d \,.
\]</span>
where <span class="math inline">\(q_u, q_d \geq0\)</span> and <span class="math inline">\(q_u + q_d = 1\)</span>. In particular, the weights <span class="math inline">\(q_u\)</span> and <span class="math inline">\(q_d\)</span> can be interpreted as probabilities for a new probability measure <span class="math inline">\(Q\)</span> with the property <span class="math inline">\(Q(Z = u) = q_u\)</span>, <span class="math inline">\(Q(Z = d) = q_d\)</span>. Denoting expectation w.r.t. this measure by <span class="math inline">\(\mathbb{E}^Q\)</span>, it is easy to see that
<span class="math display">\[
S_0 = \frac{1}{1+R} \mathbb{E}^Q[S_1] \,.
\]</span>
<span class="math inline">\(Q\)</span> is known as the <strong>risk-neutral measure</strong>. Furthermore, <span class="math inline">\(q_u\)</span> and <span class="math inline">\(q_d\)</span> are explicit and given by
<span class="math display">\[\begin{align*}
&amp; q_u = \frac{(1 +R) - d}{u - d} \,, \\
&amp; q_d = \frac{u - (1 +R)}{u - d} \,,
\end{align*}\]</span>
These are known as the <strong>risk-neutral probabilities</strong> and will play an essential role in option pricing.</p>
<p>The above motivates the concept of <strong>risk-neutral valuation</strong>: The price of an asset is the expectation at time 1, calculated using the risk-neutral probabilities, and then discounted using the risk-free rate of interest.</p>
</div>
<div id="risk-neutral-pricing" class="section level4 unnumbered hasAnchor">
<h4>Risk-neutral pricing<a href="r-for-finance.html#risk-neutral-pricing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="definition">
<p><span id="def:unlabeled-div-50" class="definition"><strong>Definition 3.4  </strong></span>A <strong>contingent claim</strong> (financial derivative) is any random variable <span class="math inline">\(X\)</span> of the form <span class="math inline">\(X = \Phi(S_1)\)</span>, where <span class="math inline">\(\Phi\)</span> is some given real valued function known as the <em>contract function</em>.</p>
</div>
<p>The interpretation is that the contract holder receives the stochastic amount <span class="math inline">\(X\)</span> at time <span class="math inline">\(t = 1\)</span>. Two important examples are the European call and put options. For an European call option with strike <span class="math inline">\(K\)</span>, we have that the <span class="math inline">\(X = \max(S_1 -K, 0)\)</span>, while for the European put option with same strike <span class="math inline">\(K\)</span>, the claim is <span class="math inline">\(X = \max(K -S_1, 0)\)</span>. In what follows, we will denote by <span class="math inline">\(\Phi(u)\)</span> and <span class="math inline">\(\Phi(d)\)</span>, the evaluations <span class="math inline">\(\Phi(u S_0)\)</span> and <span class="math inline">\(\Phi(d S_0)\)</span>, respectively.</p>
<p>Our main problem is now determining the fair price for a given contingent claim <span class="math inline">\(X\)</span>. If we denote the price of
<span class="math inline">\(X\)</span> at time <span class="math inline">\(t\)</span> by <span class="math inline">\(\Pi(t; X)\)</span>, then, in order to avoid arbitrage, we must have
<span class="math display">\[
\Pi(1;X) = X \,.
\]</span>
However, the hard part of the problem is determining <span class="math inline">\(\Pi(0;X)\)</span>. The way to solve this problem is to find a portfolio <span class="math inline">\(h\)</span> such that
<span class="math display">\[
V_{1}^h = X \,.
\]</span>
We call this a <strong>hedging</strong> portfolio or a <strong>replicating</strong> portfolio. Then, any price at <span class="math inline">\(t = 0\)</span> of the claim <span class="math inline">\(X\)</span>, different to <span class="math inline">\(V_0^h\)</span> (the price of the replicating portfolio), will lead to an arbitrage possibility. In other words, the price at <span class="math inline">\(t = 0\)</span> of the claim must be given by
<span class="math display">\[
\Pi(0;X) = V_0^h \,.
\]</span>
Let us now find the replicating portfolio <span class="math inline">\(h = (x, y)\)</span> for a fix and arbitrary contingent claim <span class="math inline">\(X\)</span> with contract function <span class="math inline">\(\Phi\)</span>. This portfolio should satisfy that</p>
<p><span class="math display">\[\begin{align*}
&amp; V_1^h = \Phi(u) \quad \text{if} \quad Z = u \,, \\
&amp; V_1^h = \Phi(d) \quad \text{if} \quad Z = d \,.
\end{align*}\]</span></p>
<p>Substituting the expression for the value of the portfolio, we obtain the following system of equations:</p>
<p><span class="math display">\[\begin{align*}
&amp; x (1 +R) + y u S_0 = \Phi(u)\,,  \\
&amp; x (1 +R) + y d S_0 = \Phi(d) \,.
\end{align*}\]</span></p>
<p>Solving for <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> in the above system gives
<span class="math display">\[\begin{align*}
&amp; x  = \frac{1}{1 + R} \frac{u\Phi(d) - d \Phi(u)}{u- d}\,,  \\
&amp; y  = \frac{1}{S_0} \frac{\Phi(u) - \Phi(d)}{u- d} \,.
\end{align*}\]</span></p>
<p>Then, the price at <span class="math inline">\(t = 0\)</span> of the claim <span class="math inline">\(X\)</span>, <span class="math inline">\(\Pi(0;X)\)</span>, is given by
<span class="math display">\[\begin{align*}
\Pi(0;X) &amp; =  x + y S_0   \\
&amp; = \frac{1}{1 + R} \left( \frac{(1+R) - d }{u- d}\Phi(u) + \frac{u - (1+R) }{u- d}\Phi(d) \right) \,.
\end{align*}\]</span>
Here, we recognize the risk-neutral probabilities <span class="math inline">\(q_u\)</span> and <span class="math inline">\(q_d\)</span>, and we can rewrite the pricing formula above as</p>
<p><span class="math display">\[\begin{align*}
\Pi(0;X)  = \frac{1}{1 + R} \left( \Phi(u) q_u + \Phi(d) q_d \right) \,.
\end{align*}\]</span></p>
<p>Thus, the right-hand side can now be interpreted as an expected value under the risk-neutral probability measure <span class="math inline">\(Q\)</span>. More specifically, we have that
<span class="math display">\[\begin{align*}
\Pi(0;X)  = \frac{1}{1 + R} \mathbb{E}^Q[X]\,.
\end{align*}\]</span></p>
<div class="example">
<p><span id="exm:unlabeled-div-51" class="example"><strong>Example 3.2  </strong></span>Consider a stock currently with current price <span class="math inline">\(S_0 = 50\)</span>. The Stocks price is expected to increase to 60 or decrease to 40 during the next year. The risk-free interest rate is 5% compounded annually. Compute the price of a 1-year European call option with a strike price of 55.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-52" class="solution"><em>Solution</em>. </span><span class="math inline">\(\,\)</span></p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="r-for-finance.html#cb881-1" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb881-2"><a href="r-for-finance.html#cb881-2" aria-hidden="true" tabindex="-1"></a>su <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb881-3"><a href="r-for-finance.html#cb881-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb881-4"><a href="r-for-finance.html#cb881-4" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb881-5"><a href="r-for-finance.html#cb881-5" aria-hidden="true" tabindex="-1"></a>strike <span class="ot">&lt;-</span> <span class="dv">55</span></span>
<span id="cb881-6"><a href="r-for-finance.html#cb881-6" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> su <span class="sc">/</span> s0</span>
<span id="cb881-7"><a href="r-for-finance.html#cb881-7" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> sd <span class="sc">/</span> s0</span>
<span id="cb881-8"><a href="r-for-finance.html#cb881-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb881-9"><a href="r-for-finance.html#cb881-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that d &lt;= (1 + R) &lt;= u is satisfied</span></span>
<span id="cb881-10"><a href="r-for-finance.html#cb881-10" aria-hidden="true" tabindex="-1"></a>u</span></code></pre></div>
<pre><code>## [1] 1.2</code></pre>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="r-for-finance.html#cb883-1" aria-hidden="true" tabindex="-1"></a>d</span></code></pre></div>
<pre><code>## [1] 0.8</code></pre>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="r-for-finance.html#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk-neutral probabilities</span></span>
<span id="cb885-2"><a href="r-for-finance.html#cb885-2" aria-hidden="true" tabindex="-1"></a>qu <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> rf <span class="sc">-</span> d) <span class="sc">/</span> (u <span class="sc">-</span> d)</span>
<span id="cb885-3"><a href="r-for-finance.html#cb885-3" aria-hidden="true" tabindex="-1"></a>qu</span></code></pre></div>
<pre><code>## [1] 0.625</code></pre>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="r-for-finance.html#cb887-1" aria-hidden="true" tabindex="-1"></a>qd <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> qu</span>
<span id="cb887-2"><a href="r-for-finance.html#cb887-2" aria-hidden="true" tabindex="-1"></a>qd</span></code></pre></div>
<pre><code>## [1] 0.375</code></pre>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="r-for-finance.html#cb889-1" aria-hidden="true" tabindex="-1"></a>phiu <span class="ot">&lt;-</span> <span class="fu">max</span>(su <span class="sc">-</span> strike, <span class="dv">0</span>)</span>
<span id="cb889-2"><a href="r-for-finance.html#cb889-2" aria-hidden="true" tabindex="-1"></a>phiu</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="r-for-finance.html#cb891-1" aria-hidden="true" tabindex="-1"></a>phid <span class="ot">&lt;-</span> <span class="fu">max</span>(sd <span class="sc">-</span> strike, <span class="dv">0</span>)</span>
<span id="cb891-2"><a href="r-for-finance.html#cb891-2" aria-hidden="true" tabindex="-1"></a>phid</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="r-for-finance.html#cb893-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Derivative price</span></span>
<span id="cb893-2"><a href="r-for-finance.html#cb893-2" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> (phiu <span class="sc">*</span> qu <span class="sc">+</span> phid <span class="sc">*</span> qd) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb893-3"><a href="r-for-finance.html#cb893-3" aria-hidden="true" tabindex="-1"></a>price</span></code></pre></div>
<pre><code>## [1] 2.97619</code></pre>
</div>
</div>
</div>
<div id="multiperiod-binomial-model" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Multiperiod binomial model<a href="r-for-finance.html#multiperiod-binomial-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We now extend the one-period binomial model to multiperiod. To do so, we now let the time index <span class="math inline">\(t\)</span> run from <span class="math inline">\(t = 0\)</span> to <span class="math inline">\(t = T\)</span>, where <span class="math inline">\(T\)</span> is fixed. Here, <span class="math inline">\(T\)</span> will denote the number of periods. As previously, we have a bond with price <span class="math inline">\(B_t\)</span> and a stock with price <span class="math inline">\(S_t\)</span> at time <span class="math inline">\(t\)</span>.</p>
<p>More specifically, the bond prices are deterministic and given by
<span class="math display">\[\begin{align*}
&amp; B_0 = 1 \,, \\
&amp; B_{n+1} = (1 + R) B_n \,, \quad n = 0, \dots, T-1
\end{align*}\]</span>
On the other hand, if at time <span class="math inline">\(t= 0\)</span> the price is of the stock is <span class="math inline">\(S_0\)</span>, then the future stock prices are random and given by
<span class="math display">\[\begin{align*}
S_{n+1} = Z_n S_n \,, \quad n = 0, \dots, T-1
\end{align*}\]</span>
where <span class="math inline">\(Z_{0}, . . . , Z_{T-1}\)</span> are iid random variables, taking only the two values <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> with probabilities
<span class="math display">\[\begin{align*}
\mathbb{P}(Z_n =u)=p_u \,, \quad
\mathbb{P}(Z_n = d) = p_d \,.
\end{align*}\]</span>
In other words, during each time step, the stock price either moves up to <span class="math inline">\(u\)</span> times its initial value or moves down to <span class="math inline">\(d\)</span> times its initial value. Figure <a href="r-for-finance.html#fig:bintree">3.2</a> shows the behavior of the stock price for <span class="math inline">\(T = 2\)</span>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bintree"></span>
<img src="figures/bintree.jpg" alt="Multiperiod binomial tree." width="65%" />
<p class="caption">
Figure 3.2: Multiperiod binomial tree.
</p>
</div>
<p>Note that the prices of the stock at time <span class="math inline">\(t\)</span> can be written as
<span class="math display">\[S_t = u^{k}d^{t-k} S_0 \,, \quad k = 0,\dots,t\,,\]</span>
where <span class="math inline">\(k\)</span> denotes the number of up-moves that have occurred. Thus each node in the binomial tree can be represented by a pair <span class="math inline">\((t,k)\)</span> with <span class="math inline">\(k = 0,\dots,t\)</span>. Figure <a href="r-for-finance.html#fig:bintreestr">3.3</a> shows the representation of of the nodes of a binomial tree for <span class="math inline">\(T = 2\)</span>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bintreestr"></span>
<img src="figures/Bintree_str.jpg" alt="Nodes of a multiperiod binomial tree." width="65%" />
<p class="caption">
Figure 3.3: Nodes of a multiperiod binomial tree.
</p>
</div>
<p>Recall that the main aim is to find the arbitrage-free price of a given contingent claim (financial derivative). In particular, we will only work with contingent claims of the form
<span class="math display">\[X = \Phi (S_T) \,,\]</span>
that is, claims whose value only depends on the stock price at the final time <span class="math inline">\(T\)</span>, <span class="math inline">\(S_T\)</span>. This type of contingent claims is typically called <em>simple</em>. Note that the European Call and Put options are examples of simple claims.</p>
<p>As in the one-period model, the problem is solved by finding a portfolio <span class="math inline">\(h\)</span> that replicates the final value of the contingent claim, that is, if <span class="math inline">\(V_t^h\)</span> denotes the value of the portfolio at time <span class="math inline">\(t\)</span>, we require that
<span class="math display">\[
V_T^h = X \,.
\]</span>
Then, the price of the derivative <span class="math inline">\(\Pi(0;X)\)</span> at time <span class="math inline">\(t = 0\)</span> must be the price of the portfolio <span class="math inline">\(V_0^h\)</span> to avoid arbitrage opportunities. More specifically,
<span class="math display">\[
\Pi(0;X) = V_0^h \,.
\]</span></p>
<p>It turns out that to find the price of this portfolio (and hence of the claim), we only need to repeatedly and recursively apply the principles of the one-step binomial model. We illustrate this in a binomial model with <span class="math inline">\(T = 2\)</span>. First, we need to introduce further notation. We denote by <span class="math inline">\(V_t(k)\)</span> the value of the replicating portfolio of the claim at the node <span class="math inline">\((t,k)\)</span>. Next, we need to split the tree in Figure <a href="r-for-finance.html#fig:bintreestr">3.3</a> into two (one-period) subtrees as shown in Figure <a href="r-for-finance.html#fig:bintreesep">3.4</a>.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bintreesep"></span>
<img src="figures/Bintree1.jpg" alt="One-period subtrees." width="45%" /><img src="figures/Bintree2.jpg" alt="One-period subtrees." width="45%" />
<p class="caption">
Figure 3.4: One-period subtrees.
</p>
</div>
<p>Then, we can apply the principles of the one-period binomial model to compute <span class="math inline">\(V_1(1)\)</span> and <span class="math inline">\(V_1(0)\)</span> as follows
<span class="math display">\[\begin{align*}
&amp; V_1(1) = \frac{1}{(1 +R)}(q_u \Phi(u^{2} S_0 ) + q_d \Phi(ud S_0 )  ) \,, \\
&amp; V_1(0) = \frac{1}{(1 +R)}(q_u \Phi(u d S_0 )  + q_d \Phi(d^{2} S_0 )  ) \,,
\end{align*}\]</span>
where <span class="math inline">\(q_u\)</span> and <span class="math inline">\(q_d\)</span> are the risk neutral probabilities given by
<span class="math display">\[\begin{align*}
&amp; q_u = \frac{(1 +R) - d}{u - d} \,, \\
&amp; q_d = \frac{u - (1 +R)}{u - d} \,.
\end{align*}\]</span></p>
Thus, we now obtain the one-period binomial tree given in Figure <a href="r-for-finance.html#fig:bintreesep0">3.5</a>.
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:bintreesep0"></span>
<img src="figures/Bintree0.jpg" alt="One-period subtree." width="45%" />
<p class="caption">
Figure 3.5: One-period subtree.
</p>
</div>
<p>Finally, using the same idea, we compute the initial price of the portfolio <span class="math inline">\(V_0(0)\)</span> as shown below
<span class="math display">\[
V_0(0) = \frac{1}{(1 +R)}(q_u V_{1}(1) + q_d V_{1}(0) )
\]</span></p>
<div class="example">
<p><span id="exm:mulbin" class="example"><strong>Example 3.3  </strong></span>Consider a stock currently with current price <span class="math inline">\(S_0 = 50\)</span>. The Stocks price is expected to increase to 10% or decrease 8% during the next two six-month periods. The risk-free interest rate is 5% compounded annually. Compute the price of a 1-year European put option with a strike price of 55.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-53" class="solution"><em>Solution</em>. </span><span class="math inline">\(\,\)</span></p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="r-for-finance.html#cb895-1" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb895-2"><a href="r-for-finance.html#cb895-2" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fl">1.1</span></span>
<span id="cb895-3"><a href="r-for-finance.html#cb895-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fl">0.92</span></span>
<span id="cb895-4"><a href="r-for-finance.html#cb895-4" aria-hidden="true" tabindex="-1"></a>strike <span class="ot">&lt;-</span> <span class="dv">55</span></span>
<span id="cb895-5"><a href="r-for-finance.html#cb895-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-6"><a href="r-for-finance.html#cb895-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk-free rate for the period of six months</span></span>
<span id="cb895-7"><a href="r-for-finance.html#cb895-7" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.05</span>)<span class="sc">^</span>(<span class="dv">6</span> <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb895-8"><a href="r-for-finance.html#cb895-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-9"><a href="r-for-finance.html#cb895-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of periods</span></span>
<span id="cb895-10"><a href="r-for-finance.html#cb895-10" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb895-11"><a href="r-for-finance.html#cb895-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb895-12"><a href="r-for-finance.html#cb895-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Future stock prices</span></span>
<span id="cb895-13"><a href="r-for-finance.html#cb895-13" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb895-14"><a href="r-for-finance.html#cb895-14" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> u<span class="sc">^</span>k <span class="sc">*</span> d<span class="sc">^</span>(n <span class="sc">-</span> k) <span class="sc">*</span> s0</span>
<span id="cb895-15"><a href="r-for-finance.html#cb895-15" aria-hidden="true" tabindex="-1"></a>s</span></code></pre></div>
<pre><code>## [1] 42.32 50.60 60.50</code></pre>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="r-for-finance.html#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Value of the contingent claim at maturity</span></span>
<span id="cb897-2"><a href="r-for-finance.html#cb897-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">pmax</span>(strike <span class="sc">-</span> s, <span class="dv">0</span>)</span>
<span id="cb897-3"><a href="r-for-finance.html#cb897-3" aria-hidden="true" tabindex="-1"></a>phi</span></code></pre></div>
<pre><code>## [1] 12.68  4.40  0.00</code></pre>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="r-for-finance.html#cb899-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Risk-neutral probability qu</span></span>
<span id="cb899-2"><a href="r-for-finance.html#cb899-2" aria-hidden="true" tabindex="-1"></a>qu <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> rf <span class="sc">-</span> d) <span class="sc">/</span> (u <span class="sc">-</span> d)</span>
<span id="cb899-3"><a href="r-for-finance.html#cb899-3" aria-hidden="true" tabindex="-1"></a>qu</span></code></pre></div>
<pre><code>## [1] 0.5816393</code></pre>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="r-for-finance.html#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Price of the option</span></span>
<span id="cb901-2"><a href="r-for-finance.html#cb901-2" aria-hidden="true" tabindex="-1"></a>vu <span class="ot">&lt;-</span> (qu <span class="sc">*</span> phi[<span class="dv">3</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> qu) <span class="sc">*</span> phi[<span class="dv">2</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb901-3"><a href="r-for-finance.html#cb901-3" aria-hidden="true" tabindex="-1"></a>vu</span></code></pre></div>
<pre><code>## [1] 1.796424</code></pre>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="r-for-finance.html#cb903-1" aria-hidden="true" tabindex="-1"></a>vd <span class="ot">&lt;-</span> (qu <span class="sc">*</span> phi[<span class="dv">2</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> qu) <span class="sc">*</span> phi[<span class="dv">1</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb903-2"><a href="r-for-finance.html#cb903-2" aria-hidden="true" tabindex="-1"></a>vd</span></code></pre></div>
<pre><code>## [1] 7.674504</code></pre>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="r-for-finance.html#cb905-1" aria-hidden="true" tabindex="-1"></a>v0 <span class="ot">&lt;-</span> (qu <span class="sc">*</span> vu <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> qu) <span class="sc">*</span> vd) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb905-2"><a href="r-for-finance.html#cb905-2" aria-hidden="true" tabindex="-1"></a>v0</span></code></pre></div>
<pre><code>## [1] 4.153022</code></pre>
</div>
<p>We now give the general binomial algorithm.</p>
<div class="proposition">
<p><span id="prp:binalg" class="proposition"><strong>Proposition 3.2  </strong></span>Consider a claim <span class="math inline">\(X = \Phi(S_T)\)</span>. Then <span class="math inline">\(V_t(k)\)</span> can be computed recursively as
<span class="math display">\[\begin{align*}
&amp; V_t(k) = \frac{1}{(1 +R)}(q_u V_{t + 1}(k+1) + q_d V_{t + 1}(k) ) \,, \\
&amp; V_T(k) = \Phi(u^{k}d^{T-k} S_0 ) \,.
\end{align*}\]</span></p>
</div>
<p>In other words, the binomial algorithm consists of the following steps:</p>
<ol style="list-style-type: decimal">
<li>Generate the tree of stock prices.</li>
<li>Calculate the value of the claim at each final node.</li>
<li>Calculate the claim values sequentially at each preceding node.</li>
</ol>
<p>To generate the tree of stock prices (1.), we can employ the following code:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="r-for-finance.html#cb907-1" aria-hidden="true" tabindex="-1"></a>build_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(s0, u, d, n) {</span>
<span id="cb907-2"><a href="r-for-finance.html#cb907-2" aria-hidden="true" tabindex="-1"></a>  tree <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> n <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb907-3"><a href="r-for-finance.html#cb907-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n <span class="sc">+</span> <span class="dv">1</span>)) {</span>
<span id="cb907-4"><a href="r-for-finance.html#cb907-4" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>(t <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb907-5"><a href="r-for-finance.html#cb907-5" aria-hidden="true" tabindex="-1"></a>    tree[t, <span class="dv">1</span><span class="sc">:</span>t] <span class="ot">&lt;-</span> u<span class="sc">^</span>k <span class="sc">*</span> d<span class="sc">^</span>(t <span class="sc">-</span> <span class="dv">1</span> <span class="sc">-</span> k) <span class="sc">*</span> s0</span>
<span id="cb907-6"><a href="r-for-finance.html#cb907-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb907-7"><a href="r-for-finance.html#cb907-7" aria-hidden="true" tabindex="-1"></a>  tree</span>
<span id="cb907-8"><a href="r-for-finance.html#cb907-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>If we consider the same input data as in Example <a href="r-for-finance.html#exm:mulbin">3.3</a>, we obtain the following tree</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="r-for-finance.html#cb908-1" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">build_tree</span>(<span class="dv">50</span>, <span class="fl">1.1</span>, <span class="fl">0.92</span>, <span class="dv">2</span>)</span>
<span id="cb908-2"><a href="r-for-finance.html#cb908-2" aria-hidden="true" tabindex="-1"></a>tree</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3]
## [1,] 50.00  0.0  0.0
## [2,] 46.00 55.0  0.0
## [3,] 42.32 50.6 60.5</code></pre>
<p>With the above tree at hand, we can evaluate the claim at the final nodes (2.) by simply taking the last row of the matrix. For instance,</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="r-for-finance.html#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pmax</span>(strike <span class="sc">-</span> tree[<span class="fu">nrow</span>(tree), ], <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 12.68  4.40  0.00</code></pre>
<p>Finally, for the recursive computations (3.) we can use the following code:</p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="r-for-finance.html#cb912-1" aria-hidden="true" tabindex="-1"></a>value_bin_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(qu, rf, tree, strike) {</span>
<span id="cb912-2"><a href="r-for-finance.html#cb912-2" aria-hidden="true" tabindex="-1"></a>  val_tree <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(tree), <span class="at">ncol =</span> <span class="fu">ncol</span>(tree))</span>
<span id="cb912-3"><a href="r-for-finance.html#cb912-3" aria-hidden="true" tabindex="-1"></a>  val_tree[<span class="fu">nrow</span>(tree), ] <span class="ot">&lt;-</span> <span class="fu">pmax</span>(strike <span class="sc">-</span> tree[<span class="fu">nrow</span>(tree), ], <span class="dv">0</span>) <span class="co"># European put</span></span>
<span id="cb912-4"><a href="r-for-finance.html#cb912-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (<span class="fu">nrow</span>(tree) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb912-5"><a href="r-for-finance.html#cb912-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>t) {</span>
<span id="cb912-6"><a href="r-for-finance.html#cb912-6" aria-hidden="true" tabindex="-1"></a>      val_tree[t, k] <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">-</span> qu) <span class="sc">*</span> val_tree[t <span class="sc">+</span> <span class="dv">1</span>, k]</span>
<span id="cb912-7"><a href="r-for-finance.html#cb912-7" aria-hidden="true" tabindex="-1"></a>        <span class="sc">+</span> qu <span class="sc">*</span> val_tree[t <span class="sc">+</span> <span class="dv">1</span>, k <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb912-8"><a href="r-for-finance.html#cb912-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb912-9"><a href="r-for-finance.html#cb912-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb912-10"><a href="r-for-finance.html#cb912-10" aria-hidden="true" tabindex="-1"></a>  val_tree</span>
<span id="cb912-11"><a href="r-for-finance.html#cb912-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Applying the above code to our example we obtain:</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="r-for-finance.html#cb913-1" aria-hidden="true" tabindex="-1"></a>opt_price <span class="ot">&lt;-</span> <span class="fu">value_bin_mod</span>(qu, rf, tree, strike)</span>
<span id="cb913-2"><a href="r-for-finance.html#cb913-2" aria-hidden="true" tabindex="-1"></a>opt_price</span></code></pre></div>
<pre><code>##           [,1]     [,2] [,3]
## [1,]  4.153022 0.000000    0
## [2,]  7.674504 1.796424    0
## [3,] 12.680000 4.400000    0</code></pre>
<p>Note that the price at time <span class="math inline">\(t = 0\)</span> is given by the entry <code>[1, 1]</code>, that is,</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="r-for-finance.html#cb915-1" aria-hidden="true" tabindex="-1"></a>opt_price[<span class="dv">1</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 4.153022</code></pre>
<div class="remark">
<p><span id="unlabeled-div-54" class="remark"><em>Remark</em>. </span>The above code for performing the binomial algorithm was presented using a European put option as an example. However, it can be easily modified to price any other simple derivative.</p>
</div>
<p>It turns out that Proposition <a href="r-for-finance.html#prp:binalg">3.2</a>, implies the following risk-neutral valuation formula.</p>
<div class="proposition">
<p><span id="prp:riskfreeform" class="proposition"><strong>Proposition 3.3  </strong></span>The arbitrage-free price at <span class="math inline">\(t = 0\)</span> of a claim <span class="math inline">\(X\)</span> with maturity <span class="math inline">\(T\)</span> is given by
<span class="math display">\[
\Pi(0;X) = \frac{1}{(1+R)^T} \sum_{k = 0}^{T}\left( \begin{matrix}
  T \\
  k
\end{matrix} \right) q^k_uq^{T-k}_d \Phi(S_0 u^k d^{T-k}) \,.
\]</span></p>
</div>
<p>Thus, an alternative solution to Example <a href="r-for-finance.html#exm:mulbin">3.3</a> using the above result is the following:</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="r-for-finance.html#cb917-1" aria-hidden="true" tabindex="-1"></a>pi0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">choose</span>(n, k) <span class="sc">*</span> qu<span class="sc">^</span>k <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> qu)<span class="sc">^</span>(n <span class="sc">-</span> k) <span class="sc">*</span> phi) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)<span class="sc">^</span>n</span>
<span id="cb917-2"><a href="r-for-finance.html#cb917-2" aria-hidden="true" tabindex="-1"></a>pi0</span></code></pre></div>
<pre><code>## [1] 4.153022</code></pre>
<p>Sometimes, instead of <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> a volatility of the stock <span class="math inline">\(\sigma\)</span> is provided. This stocks volatility is defined as the annualized standard deviation of the stock return. Luckily, given the volatility <span class="math inline">\(\sigma\)</span>, we can calculate <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> by using
<span class="math display">\[u=\exp(\sigma/ n) \quad \mbox{and} \quad d=\exp(-\sigma/ n) = 1 / u \,,\]</span>
where <span class="math inline">\(n\)</span> is the number of intervals over one year. One can show that when <span class="math inline">\(n\)</span> tends to infinity, the binomial model converges to the Black-Scholes model.</p>
<div id="r-packages-for-the-binomial-model" class="section level4 unnumbered hasAnchor">
<h4>R packages for the binomial model<a href="r-for-finance.html#r-packages-for-the-binomial-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There are several R packages that have implementations for the binomial model. For instance, <code>derivmkts</code> and <code>fOptions</code>. However, only important examples such as call and put options are available. Thus, when dealing with less standard derivatives, the previous analysis is highly relevant. We will come back to more complex examples shortly, but first let us illustrate the use of the <code>derivmkts</code> package.</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="r-for-finance.html#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(derivmkts)</span></code></pre></div>
<p>To compute prices of European (and American) call and put options we make use of the function <code>binomopt()</code>. Let us solve Example <a href="r-for-finance.html#exm:mulbin">3.3</a> using this function. We need to note the following about <code>binomopt()</code>: the risk-free rate (<code>r</code>) must be an annual continuously compounded rate. To price an European option we need to change the default value of the argument <code>american = TRUE</code> to <code>FALSE</code>. By default, the function works with a volatility, hence we need to use <code>specifyupdn = TRUE</code> to indicate that we will provide <span class="math inline">\(u\)</span> and <span class="math inline">\(d\)</span> through the arguments <code>up</code> and <code>dn</code>. We describe the rest of the arguments needed in the following code:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="r-for-finance.html#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binomopt</span>(</span>
<span id="cb920-2"><a href="r-for-finance.html#cb920-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> <span class="dv">50</span>, <span class="co"># Initial stock price</span></span>
<span id="cb920-3"><a href="r-for-finance.html#cb920-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">55</span>, <span class="co"># Strike price</span></span>
<span id="cb920-4"><a href="r-for-finance.html#cb920-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">r =</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.05</span>), <span class="co"># Continuously-compounded risk-free rate</span></span>
<span id="cb920-5"><a href="r-for-finance.html#cb920-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">tt =</span> <span class="dv">1</span>, <span class="co"># Time to maturity</span></span>
<span id="cb920-6"><a href="r-for-finance.html#cb920-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="dv">0</span>, <span class="co"># Dividends, in our case, we do not work with dividends, hence 0.</span></span>
<span id="cb920-7"><a href="r-for-finance.html#cb920-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nstep =</span> <span class="dv">2</span>, <span class="co"># Number of periods</span></span>
<span id="cb920-8"><a href="r-for-finance.html#cb920-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">american =</span> <span class="cn">FALSE</span>, <span class="co"># To indicate European</span></span>
<span id="cb920-9"><a href="r-for-finance.html#cb920-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">putopt =</span> <span class="cn">TRUE</span>, <span class="co"># To indicate a Put option</span></span>
<span id="cb920-10"><a href="r-for-finance.html#cb920-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">specifyupdn =</span> <span class="cn">TRUE</span>, <span class="co"># Tells the function to use u and d</span></span>
<span id="cb920-11"><a href="r-for-finance.html#cb920-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">up =</span> <span class="fl">1.1</span>, <span class="co"># Value of u</span></span>
<span id="cb920-12"><a href="r-for-finance.html#cb920-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">dn =</span> <span class="fl">0.92</span> <span class="co"># Value of d</span></span>
<span id="cb920-13"><a href="r-for-finance.html#cb920-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##    price 
## 4.153022</code></pre>
<p>Moreover, <code>derivmkts</code> contains the function <code>binomplot()</code> which plots the development of the stock price and shows graphically the probability of being at each node (represented as the area of the circle at that price). The following is the plot for our example:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="r-for-finance.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binomplot</span>(</span>
<span id="cb922-2"><a href="r-for-finance.html#cb922-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">s =</span> <span class="dv">50</span>, <span class="at">k =</span> <span class="dv">55</span>, <span class="at">r =</span> <span class="fu">log</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.05</span>), <span class="at">tt =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">0</span>, <span class="at">nstep =</span> <span class="dv">2</span>,</span>
<span id="cb922-3"><a href="r-for-finance.html#cb922-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">american =</span> <span class="cn">FALSE</span>, <span class="at">putopt =</span> <span class="cn">TRUE</span>, <span class="at">specifyupdn =</span> <span class="cn">TRUE</span>, <span class="at">up =</span> <span class="fl">1.1</span>, <span class="at">dn =</span> <span class="fl">0.92</span>,</span>
<span id="cb922-4"><a href="r-for-finance.html#cb922-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">v =</span> <span class="dv">0</span>, <span class="co"># A value of the volatility must be provided, although not used</span></span>
<span id="cb922-5"><a href="r-for-finance.html#cb922-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotarrows =</span> <span class="cn">TRUE</span>, <span class="co"># Plots arrows that connect the nodes of the tree</span></span>
<span id="cb922-6"><a href="r-for-finance.html#cb922-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">plotvalues =</span> <span class="cn">TRUE</span> <span class="co"># Plots the values of the stock prices at each node</span></span>
<span id="cb922-7"><a href="r-for-finance.html#cb922-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-373-1.png" width="672" />
Note that a horizontal line with the strike value is included in the plot. This can also be omitted by using <code>drawstrike = FALSE</code>. Finally, the green and red colors indicate whether or not the option is optimally exercised there (green if yes, red if no). However, this is mainly relevant when working with American options.</p>
<p>We finish our discussion of the binomial model with the following more complicated example, which cannot be solved directly with the functions in <code>derivmkts</code>. Hence the importance of our early discussion.</p>
<div class="example">
<p><span id="exm:unlabeled-div-55" class="example"><strong>Example 3.4  </strong></span>A stock price is currently 40. Over each of the next three 5-month periods, it is expected to go up by 10% or down by 5%. The risk-free interest rate is 6% per annum with continuous compounding.</p>
<ol style="list-style-type: decimal">
<li>Use a three-step binomial model to find the value of a European style derivative that pays off <span class="math inline">\(X = [\max(K - S_T, 0)]^3\)</span>, where <span class="math inline">\(S_T\)</span> is the stock price in <span class="math inline">\(15\)</span> months and <span class="math inline">\(K = 44\)</span>.</li>
<li>Use a three-step binomial model to find the value of a European-style derivative that pays off <span class="math inline">\(X =\min(S^2_T,K)\)</span>, where <span class="math inline">\(S_T\)</span> is the stock price in <span class="math inline">\(15\)</span> months and <span class="math inline">\(K = 2000\)</span>.</li>
</ol>
</div>
<div class="solution">
<p><span id="unlabeled-div-56" class="solution"><em>Solution</em>. </span>We will solve 1. using Proposition <a href="r-for-finance.html#prp:binalg">3.2</a>, and 2. using Proposition <a href="r-for-finance.html#prp:riskfreeform">3.3</a>:</p>
<ol style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="r-for-finance.html#cb923-1" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="dv">40</span></span>
<span id="cb923-2"><a href="r-for-finance.html#cb923-2" aria-hidden="true" tabindex="-1"></a>kk <span class="ot">&lt;-</span> <span class="dv">44</span></span>
<span id="cb923-3"><a href="r-for-finance.html#cb923-3" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fl">1.1</span></span>
<span id="cb923-4"><a href="r-for-finance.html#cb923-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb923-5"><a href="r-for-finance.html#cb923-5" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.06</span> <span class="sc">*</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb923-6"><a href="r-for-finance.html#cb923-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb923-7"><a href="r-for-finance.html#cb923-7" aria-hidden="true" tabindex="-1"></a>tree <span class="ot">&lt;-</span> <span class="fu">build_tree</span>(s0, u, d, <span class="dv">3</span>)</span>
<span id="cb923-8"><a href="r-for-finance.html#cb923-8" aria-hidden="true" tabindex="-1"></a>tree</span></code></pre></div>
<pre><code>##        [,1]  [,2]  [,3]  [,4]
## [1,] 40.000  0.00  0.00  0.00
## [2,] 38.000 44.00  0.00  0.00
## [3,] 36.100 41.80 48.40  0.00
## [4,] 34.295 39.71 45.98 53.24</code></pre>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="r-for-finance.html#cb925-1" aria-hidden="true" tabindex="-1"></a>qu <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> rf <span class="sc">-</span> d) <span class="sc">/</span> (u <span class="sc">-</span> d)</span>
<span id="cb925-2"><a href="r-for-finance.html#cb925-2" aria-hidden="true" tabindex="-1"></a>qu</span></code></pre></div>
<pre><code>## [1] 0.5021008</code></pre>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="r-for-finance.html#cb927-1" aria-hidden="true" tabindex="-1"></a>value_bin_mod <span class="ot">&lt;-</span> <span class="cf">function</span>(qu, rf, tree, kk) {</span>
<span id="cb927-2"><a href="r-for-finance.html#cb927-2" aria-hidden="true" tabindex="-1"></a>  val_tree <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(tree), <span class="at">ncol =</span> <span class="fu">ncol</span>(tree))</span>
<span id="cb927-3"><a href="r-for-finance.html#cb927-3" aria-hidden="true" tabindex="-1"></a>  val_tree[<span class="fu">nrow</span>(tree), ] <span class="ot">&lt;-</span> (<span class="fu">pmax</span>(kk <span class="sc">-</span> tree[<span class="fu">nrow</span>(tree), ], <span class="dv">0</span>))<span class="sc">^</span><span class="dv">3</span> <span class="co"># Given claim</span></span>
<span id="cb927-4"><a href="r-for-finance.html#cb927-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> (<span class="fu">nrow</span>(tree) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb927-5"><a href="r-for-finance.html#cb927-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>t) {</span>
<span id="cb927-6"><a href="r-for-finance.html#cb927-6" aria-hidden="true" tabindex="-1"></a>      val_tree[t, k] <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">-</span> qu) <span class="sc">*</span> val_tree[t <span class="sc">+</span> <span class="dv">1</span>, k]</span>
<span id="cb927-7"><a href="r-for-finance.html#cb927-7" aria-hidden="true" tabindex="-1"></a>        <span class="sc">+</span> qu <span class="sc">*</span> val_tree[t <span class="sc">+</span> <span class="dv">1</span>, k <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)</span>
<span id="cb927-8"><a href="r-for-finance.html#cb927-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb927-9"><a href="r-for-finance.html#cb927-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb927-10"><a href="r-for-finance.html#cb927-10" aria-hidden="true" tabindex="-1"></a>  val_tree</span>
<span id="cb927-11"><a href="r-for-finance.html#cb927-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb927-12"><a href="r-for-finance.html#cb927-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb927-13"><a href="r-for-finance.html#cb927-13" aria-hidden="true" tabindex="-1"></a>opt_price <span class="ot">&lt;-</span> <span class="fu">value_bin_mod</span>(qu, rf, tree, kk)</span>
<span id="cb927-14"><a href="r-for-finance.html#cb927-14" aria-hidden="true" tabindex="-1"></a>opt_price</span></code></pre></div>
<pre><code>##          [,1]     [,2] [,3] [,4]
## [1,] 132.0264  0.00000    0    0
## [2,] 253.1042 18.61830    0    0
## [3,] 482.5491 38.34034    0    0
## [4,] 914.0851 78.95359    0    0</code></pre>
<p>Thus, the price of the option is</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="r-for-finance.html#cb929-1" aria-hidden="true" tabindex="-1"></a>opt_price[<span class="dv">1</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 132.0264</code></pre>
<ol start="2" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="r-for-finance.html#cb931-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb931-2"><a href="r-for-finance.html#cb931-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span>n</span>
<span id="cb931-3"><a href="r-for-finance.html#cb931-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb931-4"><a href="r-for-finance.html#cb931-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prices after 15 months</span></span>
<span id="cb931-5"><a href="r-for-finance.html#cb931-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> u<span class="sc">^</span>k <span class="sc">*</span> d<span class="sc">^</span>(n <span class="sc">-</span> k) <span class="sc">*</span> s0</span>
<span id="cb931-6"><a href="r-for-finance.html#cb931-6" aria-hidden="true" tabindex="-1"></a>s</span></code></pre></div>
<pre><code>## [1] 34.295 39.710 45.980 53.240</code></pre>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="r-for-finance.html#cb933-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Value of the contingent claim at maturity</span></span>
<span id="cb933-2"><a href="r-for-finance.html#cb933-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fu">pmin</span>(s<span class="sc">^</span><span class="dv">2</span>, <span class="dv">2000</span>)</span>
<span id="cb933-3"><a href="r-for-finance.html#cb933-3" aria-hidden="true" tabindex="-1"></a>phi</span></code></pre></div>
<pre><code>## [1] 1176.147 1576.884 2000.000 2000.000</code></pre>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="r-for-finance.html#cb935-1" aria-hidden="true" tabindex="-1"></a>pi0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">choose</span>(n, k) <span class="sc">*</span> qu<span class="sc">^</span>k <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> qu)<span class="sc">^</span>(n <span class="sc">-</span> k) <span class="sc">*</span> phi) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> rf)<span class="sc">^</span>n</span>
<span id="cb935-2"><a href="r-for-finance.html#cb935-2" aria-hidden="true" tabindex="-1"></a>pi0</span></code></pre></div>
<pre><code>## [1] 1614.563</code></pre>
</div>
</div>
</div>
</div>
<div id="the-black-and-scholes-model" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> The Black and Scholes model<a href="r-for-finance.html#the-black-and-scholes-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The binomial model discussed in the previous section is a discrete-time model: the stock price changes at the end of each time period. Another commonly used model for option pricing is the Black-Scholes model, which assumes that the stock price moves continuously on time. The assumptions behind the Black-Scholes model are deep, and in fact, an entire course can be dedicated to the development of this model. In this course, it is sufficient for you to know how to price the options using simulations and the closed-form Black-Scholes formula. We start with a review of the Brownian motion, which will be used to describe the price movements of a stock.</p>
<div id="preliminars-brownian-motion" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Preliminars: Brownian motion<a href="r-for-finance.html#preliminars-brownian-motion" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="definition">
<p><span id="def:unlabeled-div-57" class="definition"><strong>Definition 3.5  (Standard Brownian motion) </strong></span>A <em>standard Brownian motion</em> is an stochastic process <span class="math inline">\(W = (W(t))_{t \geq0}\)</span> satisfying:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(W(0) = 0\)</span>.</li>
<li>The process has <em>independent increments</em>, i.e., for any <span class="math inline">\(0 \leq t_1 &lt; t_2 &lt; \cdots &lt; t_n\)</span>, <span class="math inline">\(W(t_2) - W(t_{1}), \dots,W(t_n) - W(t_{n-1})\)</span> are independent random variables.</li>
<li>For <span class="math inline">\(s &lt; t\)</span>, <span class="math inline">\(W(t) - W(s) \sim N(0, t -s)\)</span>.</li>
<li><span class="math inline">\(W\)</span> has continuous trajectories.</li>
</ol>
</div>
<p>To generate trajectories of a standard Brownian motion over a time period <span class="math inline">\([0, T]\)</span>, we consider a small time increment <span class="math inline">\(\delta t &gt;0\)</span>. Then, consider the independent increments
<span class="math display">\[\begin{align*}
&amp; W(\delta t) - W(0) \,,\\
&amp; W(2\delta t) - W(\delta t) \,.
\end{align*}\]</span>
Note that these increments are <span class="math inline">\(N(0, \delta t)\)</span> distributed. Moreover, we can compute <span class="math inline">\(W(2\delta t)\)</span> as
<span class="math display">\[
W(2\delta t) = (W(2\delta t) - W(\delta t)) + (W(\delta t) - W(0)) \,.
\]</span>
Thus, we can repeat the same logic as above to simulate a whole process trajectory. The following code implements this idea:</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="r-for-finance.html#cb937-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb937-2"><a href="r-for-finance.html#cb937-2" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fl">0.001</span> <span class="co"># Increment</span></span>
<span id="cb937-3"><a href="r-for-finance.html#cb937-3" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> delta) <span class="co"># Time interval</span></span>
<span id="cb937-4"><a href="r-for-finance.html#cb937-4" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(t) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fu">sqrt</span>(delta)) <span class="co"># iid normal distributed r.v.s</span></span>
<span id="cb937-5"><a href="r-for-finance.html#cb937-5" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(w)) <span class="co"># Cumulative sum - 0 is the initial value</span></span>
<span id="cb937-6"><a href="r-for-finance.html#cb937-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, w,</span>
<span id="cb937-7"><a href="r-for-finance.html#cb937-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb937-8"><a href="r-for-finance.html#cb937-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb937-9"><a href="r-for-finance.html#cb937-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;W(t)&quot;</span>,</span>
<span id="cb937-10"><a href="r-for-finance.html#cb937-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Simulated trajectory of a standard Brownian motion&quot;</span>,</span>
<span id="cb937-11"><a href="r-for-finance.html#cb937-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-377-1.png" width="672" /></p>
<p>We now modify the code above to generate multiple trajectories:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="r-for-finance.html#cb938-1" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># Number of simulated trajectories</span></span>
<span id="cb938-2"><a href="r-for-finance.html#cb938-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb938-3"><a href="r-for-finance.html#cb938-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(<span class="at">n =</span> nsim <span class="sc">*</span> (<span class="fu">length</span>(t) <span class="sc">-</span> <span class="dv">1</span>), <span class="at">sd =</span> <span class="fu">sqrt</span>(delta)),</span>
<span id="cb938-4"><a href="r-for-finance.html#cb938-4" aria-hidden="true" tabindex="-1"></a>  nsim, <span class="co"># Each row is one simulated trajectory</span></span>
<span id="cb938-5"><a href="r-for-finance.html#cb938-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(t) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb938-6"><a href="r-for-finance.html#cb938-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb938-7"><a href="r-for-finance.html#cb938-7" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, nsim), <span class="fu">t</span>(<span class="fu">apply</span>(w, <span class="dv">1</span>, cumsum))) <span class="co"># matrix with trajectories</span></span>
<span id="cb938-8"><a href="r-for-finance.html#cb938-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, w[<span class="dv">1</span>, ], <span class="co"># Plots the first trajectory</span></span>
<span id="cb938-9"><a href="r-for-finance.html#cb938-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb938-10"><a href="r-for-finance.html#cb938-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span>),</span>
<span id="cb938-11"><a href="r-for-finance.html#cb938-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb938-12"><a href="r-for-finance.html#cb938-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;W(t)&quot;</span>,</span>
<span id="cb938-13"><a href="r-for-finance.html#cb938-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Simulation of standard Brownian motion&quot;</span></span>
<span id="cb938-14"><a href="r-for-finance.html#cb938-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb938-15"><a href="r-for-finance.html#cb938-15" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(w[<span class="sc">-</span><span class="dv">1</span>, ], <span class="dv">1</span>, <span class="cf">function</span>(x, t) <span class="fu">lines</span>(t, x), <span class="at">t =</span> t) <span class="co"># Plots the remaining trajectories</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-378-1.png" width="672" /></p>
<pre><code>## NULL</code></pre>
<p>The standard Brownian motion can be generalized to the <em>arithmetic Brownian motion</em>, which scales and shifts the former. More specifically, <span class="math inline">\(X(t)\)</span> is an arithmetic Brownian motion if
<span class="math display">\[X(t) = \mu t + \sigma W(t)\]</span>
where <span class="math inline">\(W(t)\)</span> is a standard Brownian motion and <span class="math inline">\(\mu \in \mathbb{R}\)</span> and <span class="math inline">\(\sigma&gt;0\)</span>. Here, <span class="math inline">\(\mu\)</span> is called the <em>drift</em>, and <span class="math inline">\(\sigma\)</span> is called the <em>volatility</em> of the process. Moreover, note that for <span class="math inline">\(s &lt; t\)</span>, <span class="math inline">\(X(t)-X(s)\sim N(\mu (t - s), \sigma^2(t - s))\)</span>. There are two straightforward ways to simulate from the arithmetic Brownian motion. One would be to simulate from a standard Brownian motion and then use the relationship above. The second, and perhaps easier to modify in our code above, is to generate independent <span class="math inline">\(N(\mu \delta t, \sigma^2\delta t)\)</span> random variables. The next code implements the later:</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="r-for-finance.html#cb940-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb940-2"><a href="r-for-finance.html#cb940-2" aria-hidden="true" tabindex="-1"></a>sigma2 <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb940-3"><a href="r-for-finance.html#cb940-3" aria-hidden="true" tabindex="-1"></a>nsim <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb940-4"><a href="r-for-finance.html#cb940-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb940-5"><a href="r-for-finance.html#cb940-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(<span class="at">n =</span> nsim <span class="sc">*</span> (<span class="fu">length</span>(t) <span class="sc">-</span> <span class="dv">1</span>), <span class="at">mean =</span> mu <span class="sc">*</span> delta, <span class="at">sd =</span> <span class="fu">sqrt</span>(delta <span class="sc">*</span> sigma2)),</span>
<span id="cb940-6"><a href="r-for-finance.html#cb940-6" aria-hidden="true" tabindex="-1"></a>  nsim,</span>
<span id="cb940-7"><a href="r-for-finance.html#cb940-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(t) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb940-8"><a href="r-for-finance.html#cb940-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb940-9"><a href="r-for-finance.html#cb940-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">0</span>, nsim), <span class="fu">t</span>(<span class="fu">apply</span>(x, <span class="dv">1</span>, cumsum)))</span>
<span id="cb940-10"><a href="r-for-finance.html#cb940-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, x[<span class="dv">1</span>, ],</span>
<span id="cb940-11"><a href="r-for-finance.html#cb940-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb940-12"><a href="r-for-finance.html#cb940-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb940-13"><a href="r-for-finance.html#cb940-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb940-14"><a href="r-for-finance.html#cb940-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;X(t)&quot;</span>,</span>
<span id="cb940-15"><a href="r-for-finance.html#cb940-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Simulation of arithmetic Brownian motion&quot;</span></span>
<span id="cb940-16"><a href="r-for-finance.html#cb940-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb940-17"><a href="r-for-finance.html#cb940-17" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(x[<span class="sc">-</span><span class="dv">1</span>, ], <span class="dv">1</span>, <span class="cf">function</span>(x, t) <span class="fu">lines</span>(t, x), <span class="at">t =</span> t)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-379-1.png" width="672" /></p>
<pre><code>## NULL</code></pre>
<p>Note that the arithmetic Brownian motion can take negative values. Hence, using it for modeling stock prices is questionable. Instead, we now introduce the so-called called <em>geometric Brownian motion</em>, which can only take non-negative values. More precisely, a geometric Brownian motion <span class="math inline">\(S(t)\)</span> is a stochastic process of the form
<span class="math display">\[S(t) = S(0)\exp \left( X(t) \right) = S(0)\exp \left( \mu t + \sigma W(t) \right)  \,,\]</span>
where <span class="math inline">\(S(0)&gt;0\)</span> is the starting value, and <span class="math inline">\(X(t)\)</span> is an arithmetic Brownian motion with drift <span class="math inline">\(\mu\)</span> and volatility <span class="math inline">\(\sigma\)</span>. The following code generates some trajectories of this process using the previous implementation:</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="r-for-finance.html#cb942-1" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb942-2"><a href="r-for-finance.html#cb942-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s0 <span class="sc">*</span> <span class="fu">exp</span>(x)</span>
<span id="cb942-3"><a href="r-for-finance.html#cb942-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, s[<span class="dv">1</span>, ],</span>
<span id="cb942-4"><a href="r-for-finance.html#cb942-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb942-5"><a href="r-for-finance.html#cb942-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>),</span>
<span id="cb942-6"><a href="r-for-finance.html#cb942-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb942-7"><a href="r-for-finance.html#cb942-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;S(t)&quot;</span>,</span>
<span id="cb942-8"><a href="r-for-finance.html#cb942-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Simulation of geometric Brownian motion&quot;</span></span>
<span id="cb942-9"><a href="r-for-finance.html#cb942-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb942-10"><a href="r-for-finance.html#cb942-10" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(s[<span class="sc">-</span><span class="dv">1</span>, ], <span class="dv">1</span>, <span class="cf">function</span>(x, t) <span class="fu">lines</span>(t, x), <span class="at">t =</span> t)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-380-1.png" width="672" /></p>
<pre><code>## NULL</code></pre>
<p>Note that in particular, <span class="math inline">\(S(t)/ S(0)\sim LN(\mu t, \sigma^2 t)\)</span>, and more generally, for <span class="math inline">\(s &lt; t\)</span>, <span class="math inline">\(S(t)/S(s)\sim LN(\mu (t - s), \sigma^2(t - s))\)</span>.</p>
<p>Finally, one can show that a geometric Brownian motion of the form</p>
<p><span class="math display">\[S(t) = S(0)\exp \left( \left( \mu - \frac{\sigma^2}{2}\right) t + \sigma W(t) \right)  \,,\]</span>
satisfies the <em>stochastic differential equation</em> (SDE)
<span class="math display">\[
dS(t) = \mu S(t) dt + \sigma dW(t) \,.
\]</span></p>
</div>
<div id="the-black-and-scholes-formula" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> The Black and Scholes formula<a href="r-for-finance.html#the-black-and-scholes-formula" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As in the binomial model, we consider two assets: a risk-free asset with prices <span class="math inline">\(B(t)\)</span> and a stock with prices <span class="math inline">\(S(t)\)</span>. The BlackScholes model assumes that the prices of these two assets satisfy</p>
<p><span class="math display">\[\begin{align*}
&amp; dB(t) = r B(t) dt \,, \\
&amp; dS(t) = \alpha S(t) dt + \sigma d\tilde{W}(t) \,,
\end{align*}\]</span>
where <span class="math inline">\(r\)</span>, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\sigma\)</span> are deterministic constants and <span class="math inline">\(\tilde{W}\)</span> is a standard Brownian motion. Next, we consider a simple contingent claim of the form
<span class="math display">\[X = \Phi(S(T)) \,.\]</span>
It can be shown that the arbitrage-free price <span class="math inline">\(\Pi(0;X)\)</span> of this simple claim <span class="math inline">\(X\)</span> is given by the risk-neutral evaluation formula</p>
<p><span class="math display" id="eq:rneva">\[\begin{equation}
\Pi(0;X) = e^{- r T} \mathbb{E}^{Q}\left[ \Phi(S(T)) \right] \,,
  \tag{3.1}
\end{equation}\]</span></p>
<p>where the behavior of <span class="math inline">\(S\)</span> under <span class="math inline">\(Q\)</span> is described by the SDE
<span class="math display">\[
dS(t) = r S(t) dt + \sigma dW(t) \,,
\]</span>
whose solution is the geometric Brownian motion. In particular, we have that <span class="math inline">\(S(T)\)</span> is explicit and given by</p>
<p><span class="math display" id="eq:gmb">\[\begin{equation}
S(T) = S(0)\exp \left( \left( r - \frac{\sigma^2}{2}\right) T + \sigma W(T) \right)  \,.
  \tag{3.2}
\end{equation}\]</span></p>
<p>When considering a European call option, that is, <span class="math inline">\(\Phi(x) = \max(x - K, 0)\)</span>, <a href="r-for-finance.html#eq:rneva">(3.1)</a> and <a href="r-for-finance.html#eq:gmb">(3.2)</a> and lead to the famous BlackScholes formula.</p>
<div class="proposition">
<p><span id="prp:unlabeled-div-58" class="proposition"><strong>Proposition 3.4  </strong></span>The price of a European call option <span class="math inline">\(C(0)\)</span> with strike price <span class="math inline">\(K\)</span> and time of maturity <span class="math inline">\(T\)</span> is given by
<span class="math display" id="eq:bscall">\[\begin{equation}
C(0) = S(0) N(d_1) - K e^{-T}N(d_2) \,,
  \tag{3.3}
\end{equation}\]</span>
where N is the cumulative distribution function for the <span class="math inline">\(N(0, 1)\)</span> distribution and
<span class="math display">\[\begin{align*}
&amp; d_1 = \frac{1}{\sigma \sqrt{T}}\left( \log\left(\frac{S(0)}{K}\right) + \left( r + \frac{1}{2} \sigma^2 \right) T \right) \,,\\
&amp; d_2 = d_1 - \sigma \sqrt{T} \,.
\end{align*}\]</span></p>
</div>
<p>Similarly, the price of a European put option <span class="math inline">\(P(0)\)</span> with strike price <span class="math inline">\(K\)</span> and time of maturity <span class="math inline">\(T\)</span> is given by
<span class="math display">\[
P(0) = K e^{-T}N(-d_2) - S(0) N(-d_1) \,,
\]</span>
with <span class="math inline">\(d_1\)</span> and <span class="math inline">\(d_2\)</span> as above.</p>
<p>In R, the BlackScholes formula to price European call and put option is available in the <code>derivmkts</code> package under the functions <code>bscall()</code> and <code>bsput()</code>, receptively. We illustrate its use with an example.</p>
<div class="example">
<p><span id="exm:bs" class="example"><strong>Example 3.5  </strong></span>Consider a European call option over a stock with a current price S(0) = 50 and volatility 0.25. Moreover, the risk-free interest rate with continuous compounding is 6% per annum, the strike price is 45, and the options time to maturity is 6 months. Find the price of the option.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-59" class="solution"><em>Solution</em>. </span><span class="math inline">\(\,\)</span></p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb944-1"><a href="r-for-finance.html#cb944-1" aria-hidden="true" tabindex="-1"></a>s0 <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb944-2"><a href="r-for-finance.html#cb944-2" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb944-3"><a href="r-for-finance.html#cb944-3" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb944-4"><a href="r-for-finance.html#cb944-4" aria-hidden="true" tabindex="-1"></a>maturity <span class="ot">&lt;-</span> <span class="dv">6</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb944-5"><a href="r-for-finance.html#cb944-5" aria-hidden="true" tabindex="-1"></a>strike <span class="ot">&lt;-</span> <span class="dv">45</span></span>
<span id="cb944-6"><a href="r-for-finance.html#cb944-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># No dividends</span></span>
<span id="cb944-7"><a href="r-for-finance.html#cb944-7" aria-hidden="true" tabindex="-1"></a><span class="fu">bscall</span>(s0, strike, sigma, rf, maturity, d)</span></code></pre></div>
<pre><code>## [1] 7.381939</code></pre>
</div>
<p>Note that <a href="r-for-finance.html#eq:rneva">(3.1)</a> suggest that we can approximate the price of an option by simulating values of <span class="math inline">\(S(T)\)</span>. Moreover, the simulation can be done easily by using the function <code>simprice()</code> in <code>derivmkts</code> For example, for the previous example, we can approximate the price as follows:</p>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb946-1"><a href="r-for-finance.html#cb946-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb946-2"><a href="r-for-finance.html#cb946-2" aria-hidden="true" tabindex="-1"></a>st <span class="ot">&lt;-</span> <span class="fu">simprice</span>(s0, sigma, rf, maturity, d, <span class="at">trials =</span> <span class="dv">10000</span>, <span class="at">periods =</span> <span class="dv">1</span>)</span>
<span id="cb946-3"><a href="r-for-finance.html#cb946-3" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="sc">-</span>rf <span class="sc">*</span> maturity) <span class="sc">*</span> <span class="fu">mean</span>(<span class="fu">pmax</span>(st[st<span class="sc">$</span>period <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>price <span class="sc">-</span> strike, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] 7.377834</code></pre>
</div>
<div id="greeks" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Greeks<a href="r-for-finance.html#greeks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Greeks represent sensitivities of a derivative value to changes in the underlying parameters used to determine its price. More specifically, if we denote by <span class="math inline">\(V\)</span> be the price of a derivative, which depends on the underlying stock price <span class="math inline">\(S\)</span>, a risk-free rate <span class="math inline">\(r\)</span>, a volatility <span class="math inline">\(\sigma\)</span> and with maturity <span class="math inline">\(T\)</span>, then the Greeks are defined as follows:</p>
<div class="definition">
<p><span id="def:unlabeled-div-60" class="definition"><strong>Definition 3.6  (Greeks) </strong></span><span class="math inline">\(\,\)</span></p>
<p><em>Delta</em> (<span class="math inline">\(\Delta\)</span>): Measures the rate of change of the option price with respect to changes in the underlying stock price.</p>
<p><span class="math display">\[\Delta=\frac{\partial V}{\partial S}\,.\]</span></p>
<p><em>Gamma</em> (<span class="math inline">\(\Gamma\)</span>): Measures the rate of change in <span class="math inline">\(\Delta\)</span> with respect to changes in the underlying stock price.</p>
<p><span class="math display">\[\Gamma=\frac{\partial^2 V}{\partial S^2}=\frac{\partial \Delta}{\partial S}\,.\]</span></p>
<p><em>Vega</em> (<span class="math inline">\(\nu\)</span>): Measures sensitivity with respect to changes in the volatility <span class="math inline">\(\sigma\)</span>.</p>
<p><span class="math display">\[\nu = \frac{\partial V}{\partial \sigma}\,.\]</span></p>
<p><em>Rho</em> (<span class="math inline">\(\rho\)</span>): Measures sensitivity with respect to changes in the risk-free interest rate.</p>
<p><span class="math display">\[\rho=\frac{\partial V}{\partial r}\,.\]</span></p>
<p><em>Theta</em> (<span class="math inline">\(\Theta\)</span>): Measures the sensitivity of the value of the derivative to the passage of time.</p>
<p><span class="math display">\[\Theta=-\frac{\partial V}{\partial T }\,.\]</span></p>
<p><em>Elasticity or Lambda</em> (<span class="math inline">\(\lambda\)</span>): Is the percentage change in option value per percentage change in the underlying price (a measure of leverage).</p>
<p><span class="math display">\[\lambda=\frac{\partial V}{\partial S} \frac{S}{V}=\Delta \times \frac{S}{V}\,.\]</span></p>
<p><em>Psi</em> (<span class="math inline">\(\psi\)</span>): Is the percentage change in option value per percentage change in the underlying dividend yield (<span class="math inline">\(q\)</span>).</p>
<p><span class="math display">\[\psi =\frac {\partial V}{\partial q}\,.\]</span></p>
</div>
<p>In particular, for a European call option with strike price <span class="math inline">\(K\)</span> and time of maturity <span class="math inline">\(T\)</span> we have the following explicit expressions:</p>
<p><span class="math display">\[\begin{align*}
&amp;\Delta=N(d_1)\,, \\
&amp;\Gamma=\frac{N^\prime(d_1)}{S\sigma \sqrt{T}}\,,\\
&amp;\nu =S\sqrt{T}N^\prime(d_1) \,, \\
&amp;\rho=KTe^{-rT}N(d_2)\,, \\
&amp;\Theta=-\frac{S(0)N^\prime(d_1)\sigma}{2\sqrt{T}}-rKe^{-rT}N(d_2)\,.
\end{align*}\]</span></p>
<p>The <code>derivmkts</code> R package allows us to compute the Greeks for a financial derivative via the function <code>greeks()</code>. For instance, the Greeks for the option in Exercise <a href="r-for-finance.html#exm:bs">3.5</a> can be computed as follows:</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb948-1"><a href="r-for-finance.html#cb948-1" aria-hidden="true" tabindex="-1"></a><span class="fu">greeks</span>(<span class="fu">bscall</span>(s0, strike, sigma, rf, maturity, <span class="at">d =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>##                 bscall
## Premium     7.38193911
## Delta       0.80347605
## Gamma       0.03134062
## Vega        0.09793950
## Rho         0.16395932
## Theta      -0.01209863
## Psi        -0.20086901
## Elasticity  5.44217476</code></pre>
<p>Furthermore, <code>greeks()</code> accepts vector inputs, which in particular allow us to visualize the Greeks.</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb950-1"><a href="r-for-finance.html#cb950-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">5</span>, <span class="dv">80</span>, <span class="at">by =</span> .<span class="dv">5</span>)</span>
<span id="cb950-2"><a href="r-for-finance.html#cb950-2" aria-hidden="true" tabindex="-1"></a>call_greeks <span class="ot">&lt;-</span> <span class="fu">greeks</span>(<span class="fu">bscall</span>(s, strike, sigma, rf, maturity, <span class="at">d =</span> <span class="dv">0</span>))</span>
<span id="cb950-3"><a href="r-for-finance.html#cb950-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rownames</span>(call_greeks)) {</span>
<span id="cb950-4"><a href="r-for-finance.html#cb950-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(s, call_greeks[i, ], <span class="at">main =</span> <span class="fu">paste</span>(i), <span class="at">ylab =</span> i, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb950-5"><a href="r-for-finance.html#cb950-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-384-1.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-2.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-3.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-4.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-5.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-6.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-7.png" width="50%" /><img src="_main_files/figure-html/unnamed-chunk-384-8.png" width="50%" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="r-for-statistical-inference.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-for-insurance.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
